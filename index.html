<!doctype html>
<html lang="de" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Professional Trading Journal</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script><!-- Firebase SDK v9 -->
  <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, setDoc, getDoc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        window.firebaseModules = { initializeApp, getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, setDoc, getDoc, query, orderBy };
    </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        * {
            scrollbar-width: thin;
            scrollbar-color: #6366f1 #1a1f3a;
        }
        
        *::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        *::-webkit-scrollbar-track {
            background: #1a1f3a;
        }
        
        *::-webkit-scrollbar-thumb {
            background: #6366f1;
            border-radius: 4px;
        }
        
        body {
            background: linear-gradient(135deg, #0a0e27 0%, #1e1b4b 25%, #312e81 50%, #1e1b4b 75%, #0a0e27 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .glass-card {
            background: rgba(26, 31, 58, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }
        
        .modal-overlay {
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(10px);
        }
        
        .emotion-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full text-white">
  <div class="min-h-full w-full flex flex-col overflow-auto"><!-- Login Screen -->
   <div id="loginScreen" class="flex-1 flex items-center justify-center px-4">
    <div class="glass-card rounded-3xl p-10 max-w-md w-full">
     <div class="text-center mb-10">
      <div class="text-7xl mb-6">
       ğŸ“Š
      </div>
      <h1 class="text-4xl font-bold mb-3 bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">Trading Journal Pro</h1>
      <p class="text-gray-400 text-lg">Professionelles Trade Management</p>
     </div>
     <form id="loginForm" class="space-y-5 mb-6">
      <div><label class="block text-sm font-bold mb-3 text-purple-300">E-Mail Adresse</label> <input type="email" id="loginEmail" class="w-full px-5 py-4 rounded-xl text-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="deine@email.de" required>
      </div>
      <div><label class="block text-sm font-bold mb-3 text-purple-300">Passwort</label> <input type="password" id="loginPassword" class="w-full px-5 py-4 rounded-xl text-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
      </div><button type="submit" class="w-full py-4 rounded-xl font-bold text-white text-lg bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 transition"> ğŸ” Anmelden </button>
     </form>
     <div class="text-center"><button id="showRegisterBtn" class="text-purple-400 hover:text-purple-300 font-semibold"> Noch kein Konto? Jetzt registrieren â†’ </button>
     </div>
    </div>
   </div><!-- Register Screen -->
   <div id="registerScreen" class="flex-1 flex items-center justify-center px-4 hidden">
    <div class="glass-card rounded-3xl p-10 max-w-md w-full">
     <div class="text-center mb-10">
      <div class="text-7xl mb-6">
       ğŸš€
      </div>
      <h1 class="text-4xl font-bold mb-3 bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">Registrierung</h1>
      <p class="text-gray-400 text-lg">Erstelle dein Trading Journal</p>
     </div>
     <form id="registerForm" class="space-y-5 mb-6">
      <div><label class="block text-sm font-bold mb-3 text-purple-300">E-Mail Adresse</label> <input type="email" id="registerEmail" class="w-full px-5 py-4 rounded-xl text-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="deine@email.de" required>
      </div>
      <div><label class="block text-sm font-bold mb-3 text-purple-300">Passwort (min. 6 Zeichen)</label> <input type="password" id="registerPassword" class="w-full px-5 py-4 rounded-xl text-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
      </div><button type="submit" class="w-full py-4 rounded-xl font-bold text-white text-lg bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 transition"> âœ¨ Konto erstellen </button>
     </form>
     <div class="text-center"><button id="showLoginBtn" class="text-purple-400 hover:text-purple-300 font-semibold"> â† Bereits registriert? Jetzt anmelden </button>
     </div>
    </div>
   </div><!-- Main App -->
   <div id="mainApp" class="flex-1 flex flex-col w-full hidden">
    <header class="bg-gradient-to-r from-purple-600 to-blue-600 shadow-2xl w-full sticky top-0 z-50">
     <div class="max-w-7xl mx-auto px-6 py-6">
      <div class="flex items-center justify-between flex-wrap gap-4">
       <h1 class="text-2xl sm:text-3xl font-bold text-white flex items-center gap-3"><span class="text-4xl">ğŸ’</span> <span>Trading Journal Pro</span></h1>
       <div class="flex items-center gap-4">
        <div class="bg-white bg-opacity-10 px-4 py-2 rounded-xl">
         <div class="text-xs text-purple-100">
          Kapital
         </div>
         <div class="text-xl font-bold" id="headerCapital">
          â‚¬0.00
         </div>
        </div><button id="logoutBtn" class="bg-red-500 hover:bg-red-600 px-5 py-3 rounded-xl font-bold transition"> ğŸšª Abmelden </button>
       </div>
      </div>
     </div>
    </header>
    <div class="flex flex-1 overflow-hidden w-full">
     <aside class="w-64 bg-slate-800 border-r border-slate-700 overflow-y-auto flex-shrink-0">
      <nav class="p-4 space-y-2"><button class="nav-button active w-full text-left px-5 py-4 rounded-xl font-bold bg-purple-600 text-white flex items-center gap-3 transition" data-tab="dashboard"> <span class="text-xl">ğŸ“Š</span> <span>Dashboard</span> </button> <button class="nav-button w-full text-left px-5 py-4 rounded-xl font-bold text-gray-400 hover:text-white hover:bg-slate-700 flex items-center gap-3 transition" data-tab="newtrade"> <span class="text-xl">â•</span> <span>Neuer Trade</span> </button> <button class="nav-button w-full text-left px-5 py-4 rounded-xl font-bold text-gray-400 hover:text-white hover:bg-slate-700 flex items-center gap-3 transition" data-tab="history"> <span class="text-xl">ğŸ“œ</span> <span>Historie</span> </button> <button class="nav-button w-full text-left px-5 py-4 rounded-xl font-bold text-gray-400 hover:text-white hover:bg-slate-700 flex items-center gap-3 transition" data-tab="performance"> <span class="text-xl">ğŸ“ˆ</span> <span>Performance</span> </button> <button class="nav-button w-full text-left px-5 py-4 rounded-xl font-bold text-gray-400 hover:text-white hover:bg-slate-700 flex items-center gap-3 transition" data-tab="emotions"> <span class="text-xl">ğŸ˜Š</span> <span>Emotionen</span> </button> <button class="nav-button w-full text-left px-5 py-4 rounded-xl font-bold text-gray-400 hover:text-white hover:bg-slate-700 flex items-center gap-3 transition" data-tab="compound"> <span class="text-xl">ğŸ’°</span> <span>Zinseszins</span> </button> <button class="nav-button w-full text-left px-5 py-4 rounded-xl font-bold text-gray-400 hover:text-white hover:bg-slate-700 flex items-center gap-3 transition" data-tab="calendar"> <span class="text-xl">     </span> <span>Kalender</span> </button> <button class="nav-button w-full text-left px-5 py-4 rounded-xl font-bold text-gray-400 hover:text-white hover:bg-slate-700 flex items-center gap-3 transition" data-tab="withdrawals"> <span class="text-xl">ğŸ’¸</span> <span>Auszahlungen</span> </button> <button class="nav-button w-full text-left px-5 py-4 rounded-xl font-bold text-gray-400 hover:text-white hover:bg-slate-700 flex items-center gap-3 transition" data-tab="deposits"> <span class="text-xl">ğŸ’µ</span> <span>Einzahlungen</span> </button> <button class="nav-button w-full text-left px-5 py-4 rounded-xl font-bold text-gray-400 hover:text-white hover:bg-slate-700 flex items-center gap-3 transition" data-tab="calculator"> <span class="text-xl">ğŸ§®</span> <span>Rechner</span> </button>
      </nav>
     </aside>
     <main class="flex-1 overflow-auto w-full">
      <div class="max-w-7xl mx-auto px-6 py-8"><!-- Dashboard Tab -->
       <div id="dashboardTab" class="tab-content"><!-- Startkapital festlegen -->
        <div class="glass-card rounded-2xl p-8 mb-8">
         <h2 class="text-3xl font-bold mb-6 flex items-center gap-3"><span>ğŸ’¼</span> <span>Startkapital festlegen</span></h2>
         <form id="startCapitalForm" class="flex gap-4 flex-wrap"><input type="number" id="startCapital" step="0.01" class="flex-1 min-w-[200px] px-5 py-4 rounded-xl text-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="z.B. 10000" required> <button type="submit" class="px-8 py-4 rounded-xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 transition"> ğŸ’¾ Speichern </button>
         </form>
         <div id="startCapitalDisplay" class="mt-6 hidden">
          <div class="text-sm text-gray-400 font-bold">
           Startkapital
          </div>
          <div class="text-4xl font-bold text-purple-400 mt-2" id="startCapitalValue">
           â‚¬0.00
          </div>
         </div>
        </div><!-- FinanzÃ¼bersicht -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
         <div class="glass-card rounded-2xl p-6 text-center transform hover:scale-105 transition">
          <div class="text-4xl mb-3">
           ğŸ’°
          </div>
          <div class="text-sm text-gray-400 mb-2">
           Aktuelles Kapital
          </div>
          <div class="text-3xl font-bold text-purple-400" id="currentCapital">
           â‚¬0.00
          </div>
         </div>
         <div class="glass-card rounded-2xl p-6 text-center transform hover:scale-105 transition">
          <div class="text-4xl mb-3">
           ğŸ“Š
          </div>
          <div class="text-sm text-gray-400 mb-2">
           Gesamt P/L
          </div>
          <div class="text-3xl font-bold" id="totalPL">
           â‚¬0.00
          </div>
         </div>
         <div class="glass-card rounded-2xl p-6 text-center transform hover:scale-105 transition">
          <div class="text-4xl mb-3">
           ğŸ¯
          </div>
          <div class="text-sm text-gray-400 mb-2">
           Winrate
          </div>
          <div class="text-3xl font-bold" id="winRate">
           0%
          </div>
         </div>
         <div class="glass-card rounded-2xl p-6 text-center transform hover:scale-105 transition">
          <div class="text-4xl mb-3">
           ğŸ“
          </div>
          <div class="text-sm text-gray-400 mb-2">
           Trades
          </div>
          <div class="text-3xl font-bold" id="totalTrades">
           0
          </div>
         </div>
        </div><!-- Equity Curve -->
        <div class="glass-card rounded-2xl p-8 mb-8">
         <h3 class="text-2xl font-bold mb-6 flex items-center gap-3"><span>ğŸ“ˆ</span> <span>Equity Curve</span></h3>
         <div class="h-96">
          <canvas id="dashboardEquityChart"></canvas>
         </div>
        </div><!-- Deine aktuelle Performance -->
        <div class="glass-card rounded-2xl p-8">
         <h3 class="text-2xl font-bold mb-6 flex items-center gap-3"><span>ğŸ¯</span> <span>Deine aktuelle Performance</span></h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="currentPerformanceGrid"><!-- Dynamisch gefÃ¼llt -->
         </div>
        </div>
       </div><!-- Neuer Trade Tab -->
       <div id="newtradeTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-8">
         <h2 class="text-3xl font-bold mb-6 flex items-center gap-3"><span>â•</span> <span>Neuen Trade hinzufÃ¼gen</span></h2>
         <form id="newTradeForm" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
           <div><label class="block text-sm font-bold mb-3 text-purple-300">Datum *</label> <input type="date" id="tradeDate" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" required>
           </div>
           <div><label class="block text-sm font-bold mb-3 text-purple-300">Asset</label> <select id="tradeAsset" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="">-- Bitte wÃ¤hlen --</option> <option value="EUR/USD">EUR/USD</option> <option value="GBP/USD">GBP/USD</option> <option value="USD/JPY">USD/JPY</option> <option value="USD/CHF">USD/CHF</option> <option value="AUD/USD">AUD/USD</option> <option value="USD/CAD">USD/CAD</option> <option value="NZD/USD">NZD/USD</option> <option value="EUR/GBP">EUR/GBP</option> <option value="EUR/JPY">EUR/JPY</option> <option value="GBP/JPY">GBP/JPY</option> <option value="Gold (XAU/USD)">Gold (XAU/USD)</option> <option value="Silver (XAG/USD)">Silver (XAG/USD)</option> <option value="Oil (WTI)">Oil (WTI)</option> <option value="Bitcoin">Bitcoin</option> <option value="Ethereum">Ethereum</option> </select>
           </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
           <div><label class="block text-sm font-bold mb-3 text-purple-300">Ergebnis</label> <select id="tradeResult" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="win">Win</option> <option value="loss">Loss</option> <option value="breakeven">Break Even</option> </select>
           </div>
           <div><label class="block text-sm font-bold mb-3 text-purple-300">Profit/Loss (â‚¬)</label> <input type="number" id="tradeProfitLoss" step="0.01" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="0.00">
           </div>
           <div><label class="block text-sm font-bold mb-3 text-purple-300">Position</label> <select id="tradePosition" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="Long">Long</option> <option value="Short">Short</option> </select>
           </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
           <div><label class="block text-sm font-bold mb-3 text-purple-300">Strategie</label> <input type="text" id="tradeStrategy" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="z.B. Breakout">
           </div>
           <div><label class="block text-sm font-bold mb-3 text-purple-300">Emotion</label> <select id="tradeEmotion" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="">-- Keine --</option> <option value="ğŸ˜Š Zufrieden">ğŸ˜Š Zufrieden</option> <option value="ğŸ˜ƒ Euphorisch">ğŸ˜ƒ Euphorisch</option> <option value="ğŸ˜Œ Ruhig">ğŸ˜Œ Ruhig</option> <option value="ğŸ˜ Neutral">ğŸ˜ Neutral</option> <option value="ğŸ˜Ÿ Unsicher">ğŸ˜Ÿ Unsicher</option> <option value="ğŸ˜° NervÃ¶s">ğŸ˜° NervÃ¶s</option> <option value="ğŸ˜¡ Frustriert">ğŸ˜¡ Frustriert</option> <option value="ğŸ˜± FOMO">ğŸ˜± FOMO</option> <option value="ğŸ˜¤ Rachetrading">ğŸ˜¤ Rachetrading</option> </select>
           </div>
          </div>
          <div><label class="block text-sm font-bold mb-3 text-purple-300">Notizen</label> <textarea id="tradeNotes" rows="4" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="Details zum Trade, Setup, Fehler, Learnings..."></textarea>
          </div><button type="submit" class="w-full py-5 rounded-xl font-bold text-white text-lg bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 transition transform hover:scale-105"> ğŸ’¾ Trade speichern </button>
         </form>
        </div>
       </div><!-- Historie Tab -->
       <div id="historyTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-8 mb-6">
         <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
          <h2 class="text-3xl font-bold flex items-center gap-3"><span>ğŸ“œ</span> <span>Trade Historie</span></h2>
          <div class="flex gap-3 flex-wrap"><select id="filterAsset" class="px-4 py-2 rounded-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white text-sm focus:border-purple-500 outline-none"> <option value="all">Alle Assets</option> </select> <select id="filterResult" class="px-4 py-2 rounded-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white text-sm focus:border-purple-500 outline-none"> <option value="all">Alle Ergebnisse</option> <option value="win">Wins</option> <option value="loss">Loss</option> <option value="breakeven">Break Even</option> </select>
          </div>
         </div>
         <div id="tradeHistoryList" class="space-y-4"></div>
        </div>
       </div><!-- Auszahlungen Tab -->
       <div id="withdrawalsTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-8 mb-8">
         <h2 class="text-3xl font-bold mb-6 flex items-center gap-3"><span>ğŸ’¸</span> <span>Auszahlung erfassen</span></h2>
         <form id="withdrawalForm" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
           <div><label class="block text-sm font-bold mb-3 text-purple-300">Betrag (â‚¬)</label> <input type="number" id="withdrawalAmount" step="0.01" class="w-full px-5 py-4 rounded-xl text-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="z.B. 5000" required>
           </div>
           <div><label class="block text-sm font-bold mb-3 text-purple-300">Datum</label> <input type="date" id="withdrawalDate" class="w-full px-5 py-4 rounded-xl text-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" required>
           </div>
          </div>
          <div><label class="block text-sm font-bold mb-3 text-purple-300">Notiz (optional)</label> <textarea id="withdrawalNote" rows="3" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="z.B. GewinnausschÃ¼ttung Q1"></textarea>
          </div><button type="submit" class="w-full py-5 rounded-xl font-bold text-white text-lg bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 transition transform hover:scale-105"> ğŸ’¸ Auszahlung speichern </button>
         </form>
        </div>
        <div class="glass-card rounded-2xl p-8">
         <h3 class="text-2xl font-bold mb-6 flex items-center gap-3"><span>ğŸ“œ</span> <span>Auszahlungs-Historie</span></h3>
         <div id="withdrawalsList" class="space-y-4"><!-- Dynamisch gefÃ¼llt -->
         </div>
        </div>
       </div><!-- Einzahlungen Tab -->
       <div id="depositsTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-8 mb-8">
         <h2 class="text-3xl font-bold mb-6 flex items-center gap-3"><span>ğŸ’µ</span> <span>NachtrÃ¤gliche Einzahlung</span></h2>
         <form id="depositForm" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
           <div><label class="block text-sm font-bold mb-3 text-purple-300">Betrag (â‚¬)</label> <input type="number" id="depositAmount" step="0.01" class="w-full px-5 py-4 rounded-xl text-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="z.B. 10000" required>
           </div>
           <div><label class="block text-sm font-bold mb-3 text-purple-300">Datum</label> <input type="date" id="depositDate" class="w-full px-5 py-4 rounded-xl text-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" required>
           </div>
          </div>
          <div><label class="block text-sm font-bold mb-3 text-purple-300">Notiz (optional)</label> <textarea id="depositNote" rows="3" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="z.B. KapitalerhÃ¶hung"></textarea>
          </div><button type="submit" class="w-full py-5 rounded-xl font-bold text-white text-lg bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 transition transform hover:scale-105"> ğŸ’µ Einzahlung speichern </button>
         </form>
        </div>
        <div class="glass-card rounded-2xl p-8">
         <h3 class="text-2xl font-bold mb-6 flex items-center gap-3"><span>ğŸ“œ</span> <span>Einzahlungs-Historie</span></h3>
         <div id="depositsList" class="space-y-4"><!-- Dynamisch gefÃ¼llt -->
         </div>
        </div>
       </div><!-- Performance Tab -->
       <div id="performanceTab" class="tab-content hidden"><!-- Statistiken -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
         <div class="glass-card rounded-2xl p-6 text-center">
          <div class="text-4xl mb-3">
           ğŸ†
          </div>
          <div class="text-sm text-gray-400 mb-2">
           Bester Trade
          </div>
          <div class="text-2xl font-bold text-green-400" id="perfBestTrade">
           â‚¬0.00
          </div>
         </div>
         <div class="glass-card rounded-2xl p-6 text-center">
          <div class="text-4xl mb-3">
           ğŸ’”
          </div>
          <div class="text-sm text-gray-400 mb-2">
           Schlechtester Trade
          </div>
          <div class="text-2xl font-bold text-red-400" id="perfWorstTrade">
           â‚¬0.00
          </div>
         </div>
         <div class="glass-card rounded-2xl p-6 text-center">
          <div class="text-4xl mb-3">
           ğŸ”¥
          </div>
          <div class="text-sm text-gray-400 mb-2">
           Win Streak
          </div>
          <div class="text-2xl font-bold text-green-400" id="perfWinStreak">
           0
          </div>
         </div>
         <div class="glass-card rounded-2xl p-6 text-center">
          <div class="text-4xl mb-3">
           â„ï¸
          </div>
          <div class="text-sm text-gray-400 mb-2">
           Loss Streak
          </div>
          <div class="text-2xl font-bold text-red-400" id="perfLossStreak">
           0
          </div>
         </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
         <div class="glass-card rounded-2xl p-6 text-center">
          <div class="text-4xl mb-3">
           ğŸ“ˆ
          </div>
          <div class="text-sm text-gray-400 mb-2">
           Ã˜ Gewinn
          </div>
          <div class="text-2xl font-bold text-green-400" id="perfAvgWin">
           â‚¬0.00
          </div>
         </div>
         <div class="glass-card rounded-2xl p-6 text-center">
          <div class="text-4xl mb-3">
           ğŸ“‰
          </div>
          <div class="text-sm text-gray-400 mb-2">
           Ã˜ Verlust
          </div>
          <div class="text-2xl font-bold text-red-400" id="perfAvgLoss">
           â‚¬0.00
          </div>
         </div>
        </div><!-- Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
         <div class="glass-card rounded-2xl p-8">
          <h3 class="text-xl font-bold mb-4">ğŸ“Š Gewinn/Verlust StrÃ¤hnen</h3>
          <div class="h-64">
           <canvas id="streakChart"></canvas>
          </div>
         </div>
         <div class="glass-card rounded-2xl p-8">
          <h3 class="text-xl font-bold mb-4">ğŸ¯ Gewinn/Verlust Verteilung</h3>
          <div class="h-64">
           <canvas id="distributionChart"></canvas>
          </div>
         </div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
         <div class="glass-card rounded-2xl p-8">
          <h3 class="text-xl font-bold mb-4">ğŸ² Performance nach Strategie</h3>
          <div class="h-64">
           <canvas id="strategyChart"></canvas>
          </div>
         </div>
         <div class="glass-card rounded-2xl p-8">
          <h3 class="text-xl font-bold mb-4">ğŸ“… Monatliche Performance</h3>
          <div class="h-64">
           <canvas id="monthlyChart"></canvas>
          </div>
         </div>
        </div>
        <div class="glass-card rounded-2xl p-8 mb-8">
         <h3 class="text-xl font-bold mb-4">ğŸ’± Performance nach Asset</h3>
         <div class="h-96">
          <canvas id="assetChart"></canvas>
         </div>
        </div>
        <div class="glass-card rounded-2xl p-8">
         <h3 class="text-xl font-bold mb-4">ğŸ¯ Deine aktuelle Performance</h3>
         <div class="h-96">
          <canvas id="currentPerfChart"></canvas>
         </div>
        </div>
       </div><!-- Emotionen Tab -->
       <div id="emotionsTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-8 mb-8">
         <h2 class="text-3xl font-bold mb-6 flex items-center gap-3"><span>ğŸ˜Š</span> <span>Emotions-Analyse</span></h2>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="h-64">
           <canvas id="emotionChart"></canvas>
          </div>
          <div id="emotionStats" class="space-y-4"><!-- Dynamisch gefÃ¼llt -->
          </div>
         </div>
        </div>
        <div class="glass-card rounded-2xl p-8">
         <h3 class="text-xl font-bold mb-4">ğŸ“Š Performance pro Emotion</h3>
         <div id="emotionPerformanceList" class="space-y-3"><!-- Dynamisch gefÃ¼llt -->
         </div>
        </div>
       </div><!-- Zinseszins Tab -->
       <div id="compoundTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-8 mb-8">
         <h2 class="text-3xl font-bold mb-6 flex items-center gap-3"><span>ğŸ’°</span> <span>Zinseszins-Rechner</span></h2>
         <form id="compoundForm" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
           <div><label class="block text-sm font-bold mb-3 text-purple-300">Ziel Summe (â‚¬)</label> <input type="number" id="compoundTarget" step="0.01" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="100000" required>
           </div>
           <div><label class="block text-sm font-bold mb-3 text-purple-300">Monatliche Rendite (%)</label> <input type="number" id="compoundRate" step="0.01" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="5" required>
           </div>
           <div class="flex items-end"><button type="submit" class="w-full py-4 rounded-xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 transition"> ğŸ§® Berechnen </button>
           </div>
          </div>
         </form>
         <div id="compoundResults" class="mt-8 hidden">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
           <div class="bg-slate-800 rounded-xl p-6 text-center">
            <div class="text-sm text-gray-400 mb-2">
             BenÃ¶tigte Monate
            </div>
            <div class="text-3xl font-bold text-purple-400" id="compoundMonths">
             0
            </div>
           </div>
           <div class="bg-slate-800 rounded-xl p-6 text-center">
            <div class="text-sm text-gray-400 mb-2">
             Mit aktueller Performance
            </div>
            <div class="text-3xl font-bold text-blue-400" id="compoundCurrentMonths">
             0
            </div>
           </div>
           <div class="bg-slate-800 rounded-xl p-6 text-center">
            <div class="text-sm text-gray-400 mb-2">
             Differenz
            </div>
            <div class="text-3xl font-bold" id="compoundDiff">
             0
            </div>
           </div>
          </div>
          <div class="h-96">
           <canvas id="compoundChart"></canvas>
          </div>
         </div>
        </div>
       </div><!-- Kalender Tab -->
       <div id="calendarTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-8 mb-8">
         <div class="flex justify-between items-center mb-6">
          <h2 class="text-3xl font-bold flex items-center gap-3"><span>ğŸ“…</span> <span id="calendarMonth">Kalender</span></h2>
          <div class="flex gap-2"><button id="prevMonth" class="px-4 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 transition">â—€</button> <button id="todayBtn" class="px-4 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 transition">Heute</button> <button id="nextMonth" class="px-4 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 transition">â–¶</button>
          </div>
         </div>
         <div class="grid grid-cols-7 gap-2 mb-4">
          <div class="text-center font-bold text-gray-400 py-2">
           Mo
          </div>
          <div class="text-center font-bold text-gray-400 py-2">
           Di
          </div>
          <div class="text-center font-bold text-gray-400 py-2">
           Mi
          </div>
          <div class="text-center font-bold text-gray-400 py-2">
           Do
          </div>
          <div class="text-center font-bold text-gray-400 py-2">
           Fr
          </div>
          <div class="text-center font-bold text-gray-400 py-2">
           Sa
          </div>
          <div class="text-center font-bold text-gray-400 py-2">
           So
          </div>
         </div>
         <div id="calendarGrid" class="grid grid-cols-7 gap-2"><!-- Dynamisch gef  llt -->
         </div>
        </div>
        <div class="glass-card rounded-2xl p-8">
         <h3 class="text-2xl font-bold mb-6 flex items-center gap-3"><span>ğŸ“</span> <span>Termin hinzufÃ¼gen</span></h3>
         <form id="eventForm" class="space-y-4"><input type="date" id="eventDate" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" required> <input type="text" id="eventTitle" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="Termin Titel" required> <textarea id="eventDescription" rows="3" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="Beschreibung (optional)"></textarea> <button type="submit" class="w-full py-4 rounded-xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 transition"> ğŸ“… Termin speichern </button>
         </form>
        </div>
       </div><!-- Rechner Tab -->
       <div id="calculatorTab" class="tab-content hidden">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><!-- PositionsgrÃ¶ÃŸen-Rechner -->
         <div class="glass-card rounded-2xl p-8">
          <h3 class="text-2xl font-bold mb-6 flex items-center gap-3"><span>ğŸ“</span> <span>PositionsgrÃ¶ÃŸen-Rechner</span></h3>
          <form id="positionSizeForm" class="space-y-4">
           <div><label class="block text-sm font-bold mb-2 text-purple-300">Kontostand (â‚¬)</label> <input type="number" id="psBalance" step="0.01" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none">
           </div>
           <div><label class="block text-sm font-bold mb-2 text-purple-300">Risiko pro Trade (%)</label> <input type="number" id="psRisk" step="0.1" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="1">
           </div>
           <div><label class="block text-sm font-bold mb-2 text-purple-300">Stop Loss (Pips)</label> <input type="number" id="psStopLoss" step="0.1" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="50">
           </div>
           <div><label class="block text-sm font-bold mb-2 text-purple-300">Pip-Wert (â‚¬)</label> <input type="number" id="psPipValue" step="0.01" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="10">
           </div><button type="submit" class="w-full py-4 rounded-xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 transition"> ğŸ§® Berechnen </button>
           <div id="positionSizeResult" class="mt-6 p-6 bg-slate-800 rounded-xl hidden">
            <div class="text-sm text-gray-400 mb-2">
             Empfohlene PositionsgrÃ¶ÃŸe
            </div>
            <div class="text-3xl font-bold text-purple-400" id="positionSizeValue">
             0
            </div>
            <div class="text-sm text-gray-400 mt-2">
             Lots
            </div>
           </div>
          </form>
         </div><!-- Pip-Rechner -->
         <div class="glass-card rounded-2xl p-8">
          <h3 class="text-2xl font-bold mb-6 flex items-center gap-3"><span>ğŸ“Š</span> <span>Pip-Rechner</span></h3>
          <form id="pipCalculatorForm" class="space-y-4">
           <div><label class="block text-sm font-bold mb-2 text-purple-300">WÃ¤hrungspaar</label> <select id="pipPair" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="EUR/USD">EUR/USD</option> <option value="GBP/USD">GBP/USD</option> <option value="USD/JPY">USD/JPY</option> <option value="USD/CHF">USD/CHF</option> <option value="AUD/USD">AUD/USD</option> </select>
           </div>
           <div><label class="block text-sm font-bold mb-2 text-purple-300">Lot-GrÃ¶ÃŸe</label> <input type="number" id="pipLots" step="0.01" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="1">
           </div>
           <div><label class="block text-sm font-bold mb-2 text-purple-300">Anzahl Pips</label> <input type="number" id="pipAmount" step="0.1" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="50">
           </div>
           <div><label class="block text-sm font-bold mb-2 text-purple-300">Konvertierung nach</label> <select id="pipCurrency" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="EUR">EUR</option> <option value="USD">USD</option> <option value="GBP">GBP</option> </select>
           </div><button type="submit" class="w-full py-4 rounded-xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 transition"> ğŸ§® Berechnen </button>
           <div id="pipResult" class="mt-6 p-6 bg-slate-800 rounded-xl hidden">
            <div class="text-sm text-gray-400 mb-2">
             Pip-Wert
            </div>
            <div class="text-3xl font-bold text-purple-400" id="pipValue">
             â‚¬0.00
            </div>
            <div class="text-sm text-gray-400 mt-4 mb-2">
             Gesamtwert
            </div>
            <div class="text-2xl font-bold text-blue-400" id="pipTotal">
             â‚¬0.00
            </div>
           </div>
          </form>
         </div>
        </div>
       </div>
      </div>
     </main>
    </div>
   </div>
  </div><!-- Edit Trade Modal -->
  <div id="editModal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay">
   <div class="glass-card rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90%] overflow-y-auto">
    <h3 class="text-2xl font-bold mb-6">Trade bearbeiten</h3>
    <form id="editTradeForm" class="space-y-4"><input type="hidden" id="editTradeId">
     <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div><label class="block text-sm font-bold mb-2 text-purple-300">Datum</label> <input type="date" id="editDate" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" required>
      </div>
      <div><label class="block text-sm font-bold mb-2 text-purple-300">Asset</label> <select id="editAsset" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="">-- Bitte wÃ¤hlen --</option> <option value="EUR/USD">EUR/USD</option> <option value="GBP/USD">GBP/USD</option> <option value="USD/JPY">USD/JPY</option> <option value="USD/CHF">USD/CHF</option> <option value="AUD/USD">AUD/USD</option> <option value="USD/CAD">USD/CAD</option> <option value="NZD/USD">NZD/USD</option> <option value="EUR/GBP">EUR/GBP</option> <option value="EUR/JPY">EUR/JPY</option> <option value="GBP/JPY">GBP/JPY</option> <option value="Gold (XAU/USD)">Gold (XAU/USD)</option> <option value="Silver (XAG/USD)">Silver (XAG/USD)</option> <option value="Oil (WTI)">Oil (WTI)</option> <option value="Bitcoin">Bitcoin</option> <option value="Ethereum">Ethereum</option> </select>
      </div>
     </div>
     <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div><label class="block text-sm font-bold mb-2 text-purple-300">Ergebnis</label> <select id="editResult" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="win">Win</option> <option value="loss">Loss</option> <option value="breakeven">Break Even</option> </select>
      </div>
      <div><label class="block text-sm font-bold mb-2 text-purple-300">P/L (â‚¬)</label> <input type="number" id="editProfitLoss" step="0.01" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none">
      </div>
      <div><label class="block text-sm font-bold mb-2 text-purple-300">Position</label> <select id="editPosition" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="Long">Long</option> <option value="Short">Short</option> </select>
      </div>
     </div>
     <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div><label class="block text-sm font-bold mb-2 text-purple-300">Strategie</label> <input type="text" id="editStrategy" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none">
      </div>
      <div><label class="block text-sm font-bold mb-2 text-purple-300">Emotion</label> <select id="editEmotion" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="">-- Keine --</option> <option value="ğŸ˜Š Zufrieden">ğŸ˜Š Zufrieden</option> <option value="ğŸ˜ƒ Euphorisch">ğŸ˜ƒ Euphorisch</option> <option value="ğŸ˜Œ Ruhig">ğŸ˜Œ Ruhig</option> <option value="ğŸ˜ Neutral">ğŸ˜ Neutral</option> <option value="ğŸ˜Ÿ Unsicher">ğŸ˜Ÿ Unsicher</option> <option value="ğŸ˜° NervÃ¶s">ğŸ˜° NervÃ¶s</option> <option value="ğŸ˜¡ Frustriert">ğŸ˜¡ Frustriert</option> <option value="ğŸ˜± FOMO">ğŸ˜± FOMO</option> <option value="ğŸ˜¤ Rachetrading">ğŸ˜¤ Rachetrading</option> </select>
      </div>
     </div>
     <div><label class="block text-sm font-bold mb-2 text-purple-300">Notizen</label> <textarea id="editNotes" rows="3" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"></textarea>
     </div>
     <div class="flex gap-4"><button type="submit" class="flex-1 py-4 rounded-xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 transition"> ğŸ’¾ Speichern </button> <button type="button" id="cancelEdit" class="flex-1 py-4 rounded-xl font-bold bg-slate-700 hover:bg-slate-600 transition"> âŒ Abbrechen </button>
     </div>
    </form>
   </div>
  </div>
  <script type="module">
        const { initializeApp, getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, setDoc, getDoc, query, orderBy } = window.firebaseModules;

        // ERSETZE DIESE WERTE MIT DEINER FIREBASE CONFIG:
        const firebaseConfig = {
  apiKey: "AIzaSyAYpUD2SFyviiHDJSKvei_TtCqnhsM2sBA",
  authDomain: "trading-journal-pro-8212f.firebaseapp.com",
  projectId: "trading-journal-pro-8212f",
  storageBucket: "trading-journal-pro-8212f.firebasestorage.app",
  messagingSenderId: "927047992152",
  appId: "1:927047992152:web:2269467aa95689e0955b2d",
  measurementId: "G-36WT75DLEL"
};

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let trades = [];
        let events = [];
        let transactions = [];
        let startCapitalData = null;
        let currentCalendarDate = new Date();
        
        const charts = {};

        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = 'position:fixed;bottom:32px;right:32px;background:rgba(0,0,0,0.9);color:white;padding:16px 24px;border-radius:12px;z-index:10000;box-shadow:0 4px 12px rgba(0,0,0,0.5);';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function formatCurrency(value) {
            return 'â‚¬' + value.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('de-DE', { day: '2-digit', month: '2-digit', year: 'numeric' });
        }

        async function loadAllData() {
            if (!currentUser) return;

            try {
                const [tradesSnap, eventsSnap, transactionsSnap, settingsDoc] = await Promise.all([
                    getDocs(query(collection(db, 'users', currentUser.uid, 'trades'), orderBy('date', 'desc'))),
                    getDocs(collection(db, 'users', currentUser.uid, 'events')),
                    getDocs(query(collection(db, 'users', currentUser.uid, 'transactions'), orderBy('date', 'desc'))),
                    getDoc(doc(db, 'users', currentUser.uid, 'settings', 'capital'))
                ]);

                trades = tradesSnap.docs.map(d => ({ id: d.id, ...d.data() }));
                events = eventsSnap.docs.map(d => ({ id: d.id, ...d.data() }));
                transactions = transactionsSnap.docs.map(d => ({ id: d.id, ...d.data() }));

                if (settingsDoc.exists()) {
                    startCapitalData = settingsDoc.data();
                }

                updateDashboard();
                renderHistory();
                renderTransactions();
                renderPerformance();
                renderEmotions();
                renderCalendar();
                updateAssetFilter();

            } catch (error) {
                console.error('Fehler beim Laden:', error);
                showToast('âŒ Fehler beim Laden der Daten');
            }
        }

        function updateDashboard() {
            const startCapital = startCapitalData?.startCapital || 0;
            let currentCapital = startCapital;

            // Berechne mit Trades
            trades.forEach(t => {
                currentCapital += (t.profitLoss || 0);
            });

            // BerÃ¼cksichtige Transaktionen
            transactions.forEach(t => {
                if (t.type === 'withdrawal') {
                    currentCapital -= t.amount;
                } else if (t.type === 'deposit') {
                    currentCapital += t.amount;
                }
            });

            if (startCapital > 0) {
                document.getElementById('startCapitalDisplay').classList.remove('hidden');
                document.getElementById('startCapitalValue').textContent = formatCurrency(startCapital);
                document.getElementById('startCapital').value = startCapital;
            }

            const totalPL = trades.reduce((sum, t) => sum + (t.profitLoss || 0), 0);

            document.getElementById('headerCapital').textContent = formatCurrency(currentCapital);
            document.getElementById('currentCapital').textContent = formatCurrency(currentCapital);
            document.getElementById('totalPL').textContent = formatCurrency(totalPL);
            document.getElementById('totalPL').className = totalPL >= 0 ? 'text-3xl font-bold text-green-400' : 'text-3xl font-bold text-red-400';
            document.getElementById('totalTrades').textContent = trades.length;

            const wins = trades.filter(t => t.result === 'win');
            const winRate = trades.length > 0 ? (wins.length / trades.length * 100) : 0;
            document.getElementById('winRate').textContent = winRate.toFixed(1) + '%';

            // Equity Curve
            const canvas = document.getElementById('dashboardEquityChart');
            if (canvas) {
                const sortedTrades = [...trades].sort((a, b) => new Date(a.date) - new Date(b.date));
                const equityData = [startCapital];
                const labels = ['Start'];

                let runningCapital = startCapital;
                sortedTrades.forEach(t => {
                    runningCapital += (t.profitLoss || 0);
                    equityData.push(runningCapital);
                    labels.push(formatDate(t.date));
                });

                // Transaktionen einbeziehen
                transactions.forEach(trans => {
                    if (trans.type === 'withdrawal') {
                        runningCapital -= trans.amount;
                    } else {
                        runningCapital += trans.amount;
                    }
                });

                if (charts.dashboardEquity) {
                    charts.dashboardEquity.destroy();
                }

                const ctx = canvas.getContext('2d');
                charts.dashboardEquity = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Kapital',
                            data: equityData,
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { labels: { color: '#ffffff', font: { size: 14, weight: 'bold' } } }
                        },
                        scales: {
                            x: { ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
                            y: { ticks: { color: '#9ca3af', callback: (v) => 'â‚¬' + v.toFixed(0) }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }
                        }
                    }
                });
            }

            // Aktuelle Performance
            const perfGrid = document.getElementById('currentPerformanceGrid');
            if (perfGrid) {
                const profitLosses = trades.map(t => t.profitLoss || 0);
                const best = profitLosses.length > 0 ? Math.max(...profitLosses) : 0;
                const worst = profitLosses.length > 0 ? Math.min(...profitLosses) : 0;
                const avg = profitLosses.length > 0 ? profitLosses.reduce((a, b) => a + b, 0) / profitLosses.length : 0;

                perfGrid.innerHTML = `
                    <div class="bg-slate-800 rounded-xl p-6">
                        <div class="text-sm text-gray-400 mb-2">Bester Trade</div>
                        <div class="text-2xl font-bold text-green-400">${formatCurrency(best)}</div>
                    </div>
                    <div class="bg-slate-800 rounded-xl p-6">
                        <div class="text-sm text-gray-400 mb-2">Schlechtester Trade</div>
                        <div class="text-2xl font-bold text-red-400">${formatCurrency(worst)}</div>
                    </div>
                    <div class="bg-slate-800 rounded-xl p-6">
                        <div class="text-sm text-gray-400 mb-2">Ã˜ Trade</div>
                        <div class="text-2xl font-bold ${avg >= 0 ? 'text-green-400' : 'text-red-400'}">${formatCurrency(avg)}</div>
                    </div>
                    <div class="bg-slate-800 rounded-xl p-6">
                        <div class="text-sm text-gray-400 mb-2">Total Trades</div>
                        <div class="text-2xl font-bold text-purple-400">${trades.length}</div>
                    </div>
                `;
            }

            // Update calculator balance
            if (document.getElementById('psBalance')) {
                document.getElementById('psBalance').value = currentCapital.toFixed(2);
            }
        }

        function updateAssetFilter() {
            const filter = document.getElementById('filterAsset');
            if (!filter) return;

            const assets = [...new Set(trades.map(t => t.asset).filter(a => a))];
            filter.innerHTML = '<option value="all">Alle Assets</option>';
            assets.forEach(asset => {
                const opt = document.createElement('option');
                opt.value = asset;
                opt.textContent = asset;
                filter.appendChild(opt);
            });
        }

        function renderHistory() {
            const assetFilter = document.getElementById('filterAsset')?.value || 'all';
            const resultFilter = document.getElementById('filterResult')?.value || 'all';

            let filtered = trades;

            if (assetFilter !== 'all') {
                filtered = filtered.filter(t => t.asset === assetFilter);
            }

            if (resultFilter !== 'all') {
                filtered = filtered.filter(t => t.result === resultFilter);
            }

            const container = document.getElementById('tradeHistoryList');
            if (!container) return;

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-20">
                        <div class="text-6xl mb-4">ğŸ“œ</div>
                        <p class="text-gray-400 text-lg">Keine Trades gefunden</p>
                    </div>
                `;
                return;
            }

            let html = '';
            filtered.forEach(trade => {
                const plValue = trade.profitLoss || 0;
                const plColor = plValue > 0 ? 'text-green-400' : plValue < 0 ? 'text-red-400' : 'text-yellow-400';
                const resultBadge = trade.result === 'win' ? 'bg-green-500' : trade.result === 'loss' ? 'bg-red-500' : 'bg-yellow-500';
                const positionBadge = trade.position === 'Long' ? 'bg-blue-500' : 'bg-orange-500';

                html += `
                    <div class="glass-card rounded-xl p-6 hover:scale-[1.02] transition">
                        <div class="flex justify-between items-start mb-3 flex-wrap gap-3">
                            <div>
                                <div class="flex items-center gap-3 mb-2 flex-wrap">
                                    <span class="text-2xl font-bold">${trade.asset || 'N/A'}</span>
                                    <span class="text-xs font-bold px-3 py-1 rounded-full ${resultBadge}">${trade.result?.toUpperCase() || 'N/A'}</span>
                                    <span class="text-xs font-bold px-3 py-1 rounded-full ${positionBadge}">${trade.position || 'N/A'}</span>
                                    ${trade.emotion ? `<span class="emotion-badge bg-purple-500">${trade.emotion}</span>` : ''}
                                </div>
                                <div class="text-sm text-gray-400">${formatDate(trade.date)}</div>
                                ${trade.strategy ? `<div class="text-sm text-gray-300 mt-1">ğŸ“Š ${trade.strategy}</div>` : ''}
                            </div>
                            <div class="text-3xl font-bold ${plColor}">
                                ${formatCurrency(plValue)}
                            </div>
                        </div>
                        ${trade.notes ? `<div class="text-sm text-gray-300 mt-3 p-3 bg-slate-800 rounded-lg">${trade.notes}</div>` : ''}
                        <div class="flex gap-3 mt-4">
                            <button onclick="editTrade('${trade.id}')" class="flex-1 bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg text-sm font-bold transition">
                                âœï¸ Bearbeiten
                            </button>
                            <button onclick="deleteTrade('${trade.id}')" class="flex-1 bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg text-sm font-bold transition">
                                ğŸ—‘ï¸ LÃ¶schen
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function renderTransactions() {
            const withdrawals = transactions.filter(t => t.type === 'withdrawal');
            const deposits = transactions.filter(t => t.type === 'deposit');

            // Render Withdrawals
            const withdrawalsList = document.getElementById('withdrawalsList');
            if (withdrawalsList) {
                if (withdrawals.length === 0) {
                    withdrawalsList.innerHTML = `
                        <div class="text-center py-20">
                            <div class="text-6xl mb-4">ğŸ’¸</div>
                            <p class="text-gray-400 text-lg">Noch keine Auszahlungen</p>
                        </div>
                    `;
                } else {
                    let html = '';
                    withdrawals.forEach(withdrawal => {
                        html += `
                            <div class="glass-card rounded-xl p-6 hover:scale-[1.02] transition">
                                <div class="flex justify-between items-center flex-wrap gap-3">
                                    <div>
                                        <div class="text-sm text-gray-400">${formatDate(withdrawal.date)}</div>
                                        ${withdrawal.note ? `<div class="text-sm text-gray-300 mt-2">${withdrawal.note}</div>` : ''}
                                    </div>
                                    <div class="text-3xl font-bold text-red-400">
                                        -${formatCurrency(withdrawal.amount)}
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <button onclick="deleteTransaction('${withdrawal.id}')" class="w-full bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg text-sm font-bold transition">
                                        ğŸ—‘ï¸ LÃ¶schen
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    withdrawalsList.innerHTML = html;
                }
            }

            // Render Deposits
            const depositsList = document.getElementById('depositsList');
            if (depositsList) {
                if (deposits.length === 0) {
                    depositsList.innerHTML = `
                        <div class="text-center py-20">
                            <div class="text-6xl mb-4">ğŸ’µ</div>
                            <p class="text-gray-400 text-lg">Noch keine Einzahlungen</p>
                        </div>
                    `;
                } else {
                    let html = '';
                    deposits.forEach(deposit => {
                        html += `
                            <div class="glass-card rounded-xl p-6 hover:scale-[1.02] transition">
                                <div class="flex justify-between items-center flex-wrap gap-3">
                                    <div>
                                        <div class="text-sm text-gray-400">${formatDate(deposit.date)}</div>
                                        ${deposit.note ? `<div class="text-sm text-gray-300 mt-2">${deposit.note}</div>` : ''}
                                    </div>
                                    <div class="text-3xl font-bold text-green-400">
                                        +${formatCurrency(deposit.amount)}
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <button onclick="deleteTransaction('${deposit.id}')" class="w-full bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg text-sm font-bold transition">
                                        ğŸ—‘ï¸ LÃ¶schen
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    depositsList.innerHTML = html;
                }
            }
        }

        function renderPerformance() {
            const profitLosses = trades.map(t => t.profitLoss || 0);
            const best = profitLosses.length > 0 ? Math.max(...profitLosses) : 0;
            const worst = profitLosses.length > 0 ? Math.min(...profitLosses) : 0;

            document.getElementById('perfBestTrade').textContent = formatCurrency(best);
            document.getElementById('perfWorstTrade').textContent = formatCurrency(worst);

            // Win/Loss Streaks
            let currentStreak = 0;
            let maxWinStreak = 0;
            let maxLossStreak = 0;
            let streaks = [];

            trades.slice().reverse().forEach(t => {
                if (t.result === 'win') {
                    if (currentStreak >= 0) {
                        currentStreak++;
                    } else {
                        streaks.push(currentStreak);
                        currentStreak = 1;
                    }
                    maxWinStreak = Math.max(maxWinStreak, currentStreak);
                } else if (t.result === 'loss') {
                    if (currentStreak <= 0) {
                        currentStreak--;
                    } else {
                        streaks.push(currentStreak);
                        currentStreak = -1;
                    }
                    maxLossStreak = Math.max(maxLossStreak, Math.abs(currentStreak));
                }
            });

            document.getElementById('perfWinStreak').textContent = maxWinStreak;
            document.getElementById('perfLossStreak').textContent = maxLossStreak;

            // Avg Win/Loss
            const wins = trades.filter(t => t.result === 'win');
            const losses = trades.filter(t => t.result === 'loss');
            const avgWin = wins.length > 0 ? wins.reduce((sum, t) => sum + (t.profitLoss || 0), 0) / wins.length : 0;
            const avgLoss = losses.length > 0 ? losses.reduce((sum, t) => sum + (t.profitLoss || 0), 0) / losses.length : 0;

            document.getElementById('perfAvgWin').textContent = formatCurrency(avgWin);
            document.getElementById('perfAvgLoss').textContent = formatCurrency(avgLoss);

            // Streak Chart
            if (charts.streak) charts.streak.destroy();
            const streakCanvas = document.getElementById('streakChart');
            if (streakCanvas) {
                charts.streak = new Chart(streakCanvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: streaks.map((_, i) => `StrÃ¤hne ${i + 1}`),
                        datasets: [{
                            label: 'Gewinn/Verlust StrÃ¤hnen',
                            data: streaks,
                            backgroundColor: streaks.map(s => s > 0 ? 'rgba(34, 197, 94, 0.8)' : 'rgba(239, 68, 68, 0.8)')
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: '#ffffff' } } },
                        scales: {
                            x: { ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
                            y: { ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }
                        }
                    }
                });
            }

            // Distribution Chart
            if (charts.distribution) charts.distribution.destroy();
            const distCanvas = document.getElementById('distributionChart');
            if (distCanvas) {
                const winCount = wins.length;
                const lossCount = losses.length;
                const beCount = trades.filter(t => t.result === 'breakeven').length;

                charts.distribution = new Chart(distCanvas.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: ['Wins', 'Losses', 'Break Even'],
                        datasets: [{
                            data: [winCount, lossCount, beCount],
                            backgroundColor: ['rgba(34, 197, 94, 0.8)', 'rgba(239, 68, 68, 0.8)', 'rgba(234, 179, 8, 0.8)']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: '#ffffff' } } }
                    }
                });
            }

            // Strategy Chart
            if (charts.strategy) charts.strategy.destroy();
            const strategyCanvas = document.getElementById('strategyChart');
            if (strategyCanvas) {
                const strategyPerf = {};
                trades.forEach(t => {
                    const strat = t.strategy || 'Keine Strategie';
                    if (!strategyPerf[strat]) strategyPerf[strat] = 0;
                    strategyPerf[strat] += (t.profitLoss || 0);
                });

                charts.strategy = new Chart(strategyCanvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(strategyPerf),
                        datasets: [{
                            label: 'P/L pro Strategie',
                            data: Object.values(strategyPerf),
                            backgroundColor: Object.values(strategyPerf).map(v => v >= 0 ? 'rgba(139, 92, 246, 0.8)' : 'rgba(239, 68, 68, 0.8)')
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: '#ffffff' } } },
                        scales: {
                            x: { ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
                            y: { ticks: { color: '#9ca3af', callback: (v) => 'â‚¬' + v }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }
                        }
                    }
                });
            }

            // Monthly Chart
            if (charts.monthly) charts.monthly.destroy();
            const monthlyCanvas = document.getElementById('monthlyChart');
            if (monthlyCanvas) {
                const monthlyPerf = {};
                trades.forEach(t => {
                    const date = new Date(t.date);
                    const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                    if (!monthlyPerf[key]) monthlyPerf[key] = 0;
                    monthlyPerf[key] += (t.profitLoss || 0);
                });

                charts.monthly = new Chart(monthlyCanvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(monthlyPerf).sort(),
                        datasets: [{
                            label: 'Monatliche Performance',
                            data: Object.keys(monthlyPerf).sort().map(k => monthlyPerf[k]),
                            backgroundColor: Object.keys(monthlyPerf).sort().map(k => monthlyPerf[k] >= 0 ? 'rgba(34, 197, 94, 0.8)' : 'rgba(239, 68, 68, 0.8)')
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: '#ffffff' } } },
                        scales: {
                            x: { ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
                            y: { ticks: { color: '#9ca3af', callback: (v) => 'â‚¬' + v }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }
                        }
                    }
                });
            }

            // Asset Chart
            if (charts.asset) charts.asset.destroy();
            const assetCanvas = document.getElementById('assetChart');
            if (assetCanvas) {
                const assetPerf = {};
                trades.forEach(t => {
                    const asset = t.asset || 'Unbekannt';
                    if (!assetPerf[asset]) assetPerf[asset] = 0;
                    assetPerf[asset] += (t.profitLoss || 0);
                });

                charts.asset = new Chart(assetCanvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(assetPerf),
                        datasets: [{
                            label: 'P/L pro Asset',
                            data: Object.values(assetPerf),
                            backgroundColor: 'rgba(99, 102, 241, 0.8)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: '#ffffff' } } },
                        scales: {
                            x: { ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
                            y: { ticks: { color: '#9ca3af', callback: (v) => 'â‚¬' + v }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }
                        }
                    }
                });
            }

            // Current Performance Chart
            if (charts.currentPerf) charts.currentPerf.destroy();
            const currentPerfCanvas = document.getElementById('currentPerfChart');
            if (currentPerfCanvas) {
                const last10 = trades.slice(0, 10).reverse();
                charts.currentPerf = new Chart(currentPerfCanvas.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: last10.map((t, i) => `Trade ${i + 1}`),
                        datasets: [{
                            label: 'Letzte 10 Trades',
                            data: last10.map(t => t.profitLoss || 0),
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: '#ffffff' } } },
                        scales: {
                            x: { ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
                            y: { ticks: { color: '#9ca3af', callback: (v) => 'â‚¬' + v }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }
                        }
                    }
                });
            }
        }

        function renderEmotions() {
            const emotionCounts = {};
            const emotionPL = {};

            trades.forEach(t => {
                if (t.emotion) {
                    emotionCounts[t.emotion] = (emotionCounts[t.emotion] || 0) + 1;
                    emotionPL[t.emotion] = (emotionPL[t.emotion] || 0) + (t.profitLoss || 0);
                }
            });

            // Emotion Chart
            if (charts.emotion) charts.emotion.destroy();
            const emotionCanvas = document.getElementById('emotionChart');
            if (emotionCanvas) {
                charts.emotion = new Chart(emotionCanvas.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(emotionCounts),
                        datasets: [{
                            data: Object.values(emotionCounts),
                            backgroundColor: [
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(139, 92, 246, 0.8)',
                                'rgba(234, 179, 8, 0.8)',
                                'rgba(249, 115, 22, 0.8)',
                                'rgba(239, 68, 68, 0.8)',
                                'rgba(236, 72, 153, 0.8)',
                                'rgba(20, 184, 166, 0.8)',
                                'rgba(251, 146, 60, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: '#ffffff' } } }
                    }
                });
            }

            // Emotion Stats
            const emotionStats = document.getElementById('emotionStats');
            if (emotionStats) {
                let html = '<div class="text-xl font-bold mb-4">HÃ¤ufigste Emotionen</div>';
                Object.entries(emotionCounts).sort((a, b) => b[1] - a[1]).slice(0, 5).forEach(([emotion, count]) => {
                    html += `
                        <div class="flex justify-between items-center p-3 bg-slate-800 rounded-lg">
                            <span class="font-bold">${emotion}</span>
                            <span class="text-purple-400 font-bold">${count}x</span>
                        </div>
                    `;
                });
                emotionStats.innerHTML = html;
            }

            // Performance pro Emotion
            const emotionPerfList = document.getElementById('emotionPerformanceList');
            if (emotionPerfList) {
                let html = '';
                Object.entries(emotionPL).sort((a, b) => b[1] - a[1]).forEach(([emotion, pl]) => {
                    const color = pl >= 0 ? 'text-green-400' : 'text-red-400';
                    html += `
                        <div class="flex justify-between items-center p-3 bg-slate-800 rounded-lg">
                            <span class="font-bold">${emotion}</span>
                            <span class="font-bold ${color}">${formatCurrency(pl)}</span>
                        </div>
                    `;
                });
                emotionPerfList.innerHTML = html || '<div class="text-center text-gray-400 py-8">Keine Emotionsdaten</div>';
            }
        }

        function renderCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();

            document.getElementById('calendarMonth').textContent = new Date(year, month).toLocaleDateString('de-DE', { month: 'long', year: 'numeric' });

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            // Empty cells
            const startDay = firstDay === 0 ? 6 : firstDay - 1;
            for (let i = 0; i < startDay; i++) {
                const cell = document.createElement('div');
                cell.className = 'p-2 bg-slate-800 rounded-lg opacity-50';
                grid.appendChild(cell);
            }

            // Days
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayTrades = trades.filter(t => t.date === dateStr);
                const dayEvents = events.filter(e => e.date === dateStr);

                const cell = document.createElement('div');
                cell.className = 'p-2 bg-slate-800 rounded-lg hover:bg-slate-700 cursor-pointer transition min-h-[80px]';

                let content = `<div class="font-bold mb-1">${day}</div>`;

                if (dayTrades.length > 0) {
                    const totalPL = dayTrades.reduce((sum, t) => sum + (t.profitLoss || 0), 0);
                    const color = totalPL > 0 ? 'text-green-400' : totalPL < 0 ? 'text-red-400' : 'text-yellow-400';
                    content += `<div class="text-xs ${color} font-bold">${formatCurrency(totalPL)}</div>`;
                }

                if (dayEvents.length > 0) {
                    dayEvents.forEach(e => {
                        content += `<div class="text-xs text-purple-300 mt-1 truncate">ğŸ“… ${e.title}</div>`;
                    });
                }

                cell.innerHTML = content;
                grid.appendChild(cell);
            }
        }

        window.editTrade = function(tradeId) {
            const trade = trades.find(t => t.id === tradeId);
            if (!trade) return;

            document.getElementById('editTradeId').value = tradeId;
            document.getElementById('editDate').value = trade.date || '';
            document.getElementById('editAsset').value = trade.asset || '';
            document.getElementById('editResult').value = trade.result || 'win';
            document.getElementById('editProfitLoss').value = trade.profitLoss || 0;
            document.getElementById('editPosition').value = trade.position || 'Long';
            document.getElementById('editStrategy').value = trade.strategy || '';
            document.getElementById('editEmotion').value = trade.emotion || '';
            document.getElementById('editNotes').value = trade.notes || '';

            document.getElementById('editModal').classList.remove('hidden');
            document.getElementById('editModal').classList.add('flex');
        };

        window.deleteTrade = async function(tradeId) {
            if (!currentUser) return;

            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 z-50 flex items-center justify-center modal-overlay';
            confirmDiv.innerHTML = `
                <div class="glass-card rounded-2xl p-8 max-w-md mx-4">
                    <h3 class="text-2xl font-bold mb-4">Trade lÃ¶schen?</h3>
                    <p class="text-gray-400 mb-6">MÃ¶chtest du diesen Trade wirklich lÃ¶schen?</p>
                    <div class="flex gap-4">
                        <button id="confirmDeleteYes" class="flex-1 py-3 rounded-xl font-bold bg-red-600 hover:bg-red-700 transition">Ja, lÃ¶schen</button>
                        <button id="confirmDeleteNo" class="flex-1 py-3 rounded-xl font-bold bg-slate-700 hover:bg-slate-600 transition">Abbrechen</button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDiv);

            document.getElementById('confirmDeleteNo').onclick = () => confirmDiv.remove();
            document.getElementById('confirmDeleteYes').onclick = async () => {
                try {
                    await deleteDoc(doc(db, 'users', currentUser.uid, 'trades', tradeId));
                    showToast('âœ… Trade gelÃ¶scht');
                    await loadAllData();
                    confirmDiv.remove();
                } catch (error) {
                    console.error('Fehler:', error);
                    showToast('âŒ Fehler beim LÃ¶schen');
                }
            };
        };

        window.deleteTransaction = async function(transactionId) {
            if (!currentUser) return;

            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 z-50 flex items-center justify-center modal-overlay';
            confirmDiv.innerHTML = `
                <div class="glass-card rounded-2xl p-8 max-w-md mx-4">
                    <h3 class="text-2xl font-bold mb-4">Transaktion lÃ¶schen?</h3>
                    <p class="text-gray-400 mb-6">MÃ¶chtest du diese Transaktion wirklich lÃ¶schen?</p>
                    <div class="flex gap-4">
                        <button id="confirmDeleteYes" class="flex-1 py-3 rounded-xl font-bold bg-red-600 hover:bg-red-700 transition">Ja, lÃ¶schen</button>
                        <button id="confirmDeleteNo" class="flex-1 py-3 rounded-xl font-bold bg-slate-700 hover:bg-slate-600 transition">Abbrechen</button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDiv);

            document.getElementById('confirmDeleteNo').onclick = () => confirmDiv.remove();
            document.getElementById('confirmDeleteYes').onclick = async () => {
                try {
                    await deleteDoc(doc(db, 'users', currentUser.uid, 'transactions', transactionId));
                    showToast('âœ… Transaktion gelÃ¶scht');
                    await loadAllData();
                    confirmDiv.remove();
                } catch (error) {
                    console.error('Fehler:', error);
                    showToast('âŒ Fehler beim LÃ¶schen');
                }
            };
        };

        // Auth handlers
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                await signInWithEmailAndPassword(auth, document.getElementById('loginEmail').value, document.getElementById('loginPassword').value);
            } catch (error) {
                showToast('âŒ Login fehlgeschlagen: ' + error.message);
            }
        });

        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                await createUserWithEmailAndPassword(auth, document.getElementById('registerEmail').value, document.getElementById('registerPassword').value);
                showToast('âœ… Registrierung erfolgreich!');
            } catch (error) {
                showToast('âŒ Registrierung fehlgeschlagen: ' + error.message);
            }
        });

        document.getElementById('showRegisterBtn').addEventListener('click', () => {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.remove('hidden');
        });

        document.getElementById('showLoginBtn').addEventListener('click', () => {
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        });

        document.getElementById('logoutBtn').addEventListener('click', () => signOut(auth));

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('registerScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                loadAllData();
            } else {
                currentUser = null;
                document.getElementById('mainApp').classList.add('hidden');
                document.getElementById('registerScreen').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
            }
        });

        // Tab Navigation
        document.querySelectorAll('.nav-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.dataset.tab;

                document.querySelectorAll('.nav-button').forEach(btn => {
                    btn.classList.remove('active', 'bg-purple-600', 'text-white');
                    btn.classList.add('text-gray-400');
                });
                button.classList.add('active', 'bg-purple-600', 'text-white');
                button.classList.remove('text-gray-400');

                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(tabName + 'Tab').classList.remove('hidden');
            });
        });

        // Forms
        document.getElementById('startCapitalForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) return;

            const amount = parseFloat(document.getElementById('startCapital').value);
            if (isNaN(amount) || amount <= 0) {
                showToast('âŒ Bitte gÃ¼ltigen Betrag eingeben');
                return;
            }

            try {
                await setDoc(doc(db, 'users', currentUser.uid, 'settings', 'capital'), {
                    startCapital: amount
                });
                showToast('âœ… Startkapital gespeichert!');
                await loadAllData();
            } catch (error) {
                showToast('âŒ Fehler beim Speichern');
            }
        });

        const today = new Date().toISOString().split('T')[0];
        document.getElementById('tradeDate').value = today;
        document.getElementById('withdrawalDate').value = today;
        document.getElementById('depositDate').value = today;
        document.getElementById('eventDate').value = today;

        document.getElementById('newTradeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) return;

            const result = document.getElementById('tradeResult').value;
            let profitLoss = parseFloat(document.getElementById('tradeProfitLoss').value) || 0;

            // Bei Loss negativ machen
            if (result === 'loss' && profitLoss > 0) {
                profitLoss = -Math.abs(profitLoss);
            } else if (result === 'loss') {
                profitLoss = Math.abs(profitLoss) * -1;
            }

            const trade = {
                date: document.getElementById('tradeDate').value,
                asset: document.getElementById('tradeAsset').value,
                result: result,
                profitLoss: profitLoss,
                position: document.getElementById('tradePosition').value,
                strategy: document.getElementById('tradeStrategy').value,
                emotion: document.getElementById('tradeEmotion').value,
                notes: document.getElementById('tradeNotes').value
            };

            try {
                await addDoc(collection(db, 'users', currentUser.uid, 'trades'), trade);
                showToast('âœ… Trade gespeichert!');
                document.getElementById('newTradeForm').reset();
                document.getElementById('tradeDate').value = today;
                await loadAllData();

                // Switch to history
                document.querySelectorAll('.nav-button').forEach(btn => {
                    btn.classList.remove('active', 'bg-purple-600', 'text-white');
                    btn.classList.add('text-gray-400');
                });
                document.querySelector('[data-tab="history"]').classList.add('active', 'bg-purple-600', 'text-white');
                document.querySelector('[data-tab="history"]').classList.remove('text-gray-400');
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById('historyTab').classList.remove('hidden');
            } catch (error) {
                showToast('âŒ Fehler beim Speichern');
            }
        });

        document.getElementById('editTradeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) return;

            const tradeId = document.getElementById('editTradeId').value;
            const result = document.getElementById('editResult').value;
            let profitLoss = parseFloat(document.getElementById('editProfitLoss').value) || 0;

            if (result === 'loss' && profitLoss > 0) {
                profitLoss = -Math.abs(profitLoss);
            } else if (result === 'loss') {
                profitLoss = Math.abs(profitLoss) * -1;
            }

            const trade = {
                date: document.getElementById('editDate').value,
                asset: document.getElementById('editAsset').value,
                result: result,
                profitLoss: profitLoss,
                position: document.getElementById('editPosition').value,
                strategy: document.getElementById('editStrategy').value,
                emotion: document.getElementById('editEmotion').value,
                notes: document.getElementById('editNotes').value
            };

            try {
                await updateDoc(doc(db, 'users', currentUser.uid, 'trades', tradeId), trade);
                showToast('âœ… Trade aktualisiert!');
                document.getElementById('editModal').classList.add('hidden');
                document.getElementById('editModal').classList.remove('flex');
                await loadAllData();
            } catch (error) {
                showToast('âŒ Fehler beim Aktualisieren');
            }
        });

        document.getElementById('cancelEdit').addEventListener('click', () => {
            document.getElementById('editModal').classList.add('hidden');
            document.getElementById('editModal').classList.remove('flex');
        });

        document.getElementById('withdrawalForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) return;

            const amount = parseFloat(document.getElementById('withdrawalAmount').value);
            const date = document.getElementById('withdrawalDate').value;
            const note = document.getElementById('withdrawalNote').value;

            try {
                await addDoc(collection(db, 'users', currentUser.uid, 'transactions'), {
                    type: 'withdrawal',
                    amount: amount,
                    date: date,
                    note: note
                });
                showToast('âœ… Auszahlung erfasst!');
                document.getElementById('withdrawalForm').reset();
                document.getElementById('withdrawalDate').value = today;
                await loadAllData();
            } catch (error) {
                showToast('âŒ Fehler beim Speichern');
            }
        });

        document.getElementById('depositForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) return;

            const amount = parseFloat(document.getElementById('depositAmount').value);
            const date = document.getElementById('depositDate').value;
            const note = document.getElementById('depositNote').value;

            try {
                await addDoc(collection(db, 'users', currentUser.uid, 'transactions'), {
                    type: 'deposit',
                    amount: amount,
                    date: date,
                    note: note
                });
                showToast('âœ… Einzahlung erfasst!');
                document.getElementById('depositForm').reset();
                document.getElementById('depositDate').value = today;
                await loadAllData();
            } catch (error) {
                showToast('âŒ Fehler beim Speichern');
            }
        });

        document.getElementById('filterAsset')?.addEventListener('change', renderHistory);
        document.getElementById('filterResult')?.addEventListener('change', renderHistory);

        document.getElementById('compoundForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const target = parseFloat(document.getElementById('compoundTarget').value);
            const rate = parseFloat(document.getElementById('compoundRate').value) / 100;
            const startCapital = startCapitalData?.startCapital || 0;

            if (startCapital === 0) {
                showToast('âŒ Bitte zuerst Startkapital festlegen');
                return;
            }

            // Berechne Monate bis Ziel
            let capital = startCapital;
            let months = 0;
            const maxMonths = 1000;

            while (capital < target && months < maxMonths) {
                capital += capital * rate;
                months++;
            }

            // Mit aktueller Performance
            const totalPL = trades.reduce((sum, t) => sum + (t.profitLoss || 0), 0);
            const currentCapital = startCapital + totalPL;
            const actualMonthsTrading = trades.length > 0 ? Math.ceil((new Date() - new Date(Math.min(...trades.map(t => new Date(t.date))))) / (1000 * 60 * 60 * 24 * 30)) : 1;
            const actualRate = actualMonthsTrading > 0 ? ((currentCapital - startCapital) / startCapital) / actualMonthsTrading : 0;

            let capitalCurrent = startCapital;
            let monthsCurrent = 0;

            while (capitalCurrent < target && monthsCurrent < maxMonths) {
                capitalCurrent += capitalCurrent * actualRate;
                monthsCurrent++;
            }

            document.getElementById('compoundMonths').textContent = months >= maxMonths ? 'âˆ' : months;
            document.getElementById('compoundCurrentMonths').textContent = monthsCurrent >= maxMonths ? 'âˆ' : monthsCurrent;
            const diff = monthsCurrent - months;
            document.getElementById('compoundDiff').textContent = diff > 0 ? `+${diff} Monate` : `${diff} Monate`;
            document.getElementById('compoundDiff').className = diff > 0 ? 'text-3xl font-bold text-red-400' : 'text-3xl font-bold text-green-400';

            document.getElementById('compoundResults').classList.remove('hidden');

            // Chart
            if (charts.compound) charts.compound.destroy();
            const compoundCanvas = document.getElementById('compoundChart');
            if (compoundCanvas) {
                const dataIdeal = [startCapital];
                const dataCurrent = [startCapital];
                const labels = ['Start'];

                let capIdeal = startCapital;
                let capCurrent = startCapital;

                for (let i = 1; i <= Math.max(months, monthsCurrent); i++) {
                    capIdeal += capIdeal * rate;
                    capCurrent += capCurrent * actualRate;
                    dataIdeal.push(capIdeal);
                    dataCurrent.push(capCurrent);
                    labels.push(`M${i}`);
                }

                charts.compound = new Chart(compoundCanvas.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Ziel-Rendite',
                                data: dataIdeal,
                                borderColor: '#8b5cf6',
                                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                borderWidth: 3,
                                fill: false,
                                tension: 0.4
                            },
                            {
                                label: 'Aktuelle Performance',
                                data: dataCurrent,
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                borderWidth: 3,
                                fill: false,
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: '#ffffff' } } },
                        scales: {
                            x: { ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
                            y: { ticks: { color: '#9ca3af', callback: (v) => 'â‚¬' + v.toFixed(0) }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }
                        }
                    }
                });
            }
        });

        document.getElementById('prevMonth').addEventListener('click', () => {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            renderCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            renderCalendar();
        });

        document.getElementById('todayBtn').addEventListener('click', () => {
            currentCalendarDate = new Date();
            renderCalendar();
        });

        document.getElementById('eventForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) return;

            const event = {
                date: document.getElementById('eventDate').value,
                title: document.getElementById('eventTitle').value,
                description: document.getElementById('eventDescription').value
            };

            try {
                await addDoc(collection(db, 'users', currentUser.uid, 'events'), event);
                showToast('âœ… Termin gespeichert!');
                document.getElementById('eventForm').reset();
                document.getElementById('eventDate').value = today;
                await loadAllData();
            } catch (error) {
                showToast('âŒ Fehler beim Speichern');
            }
        });

        document.getElementById('positionSizeForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const balance = parseFloat(document.getElementById('psBalance').value);
            const risk = parseFloat(document.getElementById('psRisk').value) / 100;
            const stopLoss = parseFloat(document.getElementById('psStopLoss').value);
            const pipValue = parseFloat(document.getElementById('psPipValue').value);

            if (isNaN(balance) || isNaN(risk) || isNaN(stopLoss) || isNaN(pipValue)) {
                showToast('âŒ Bitte alle Felder ausfÃ¼llen');
                return;
            }

            const riskAmount = balance * risk;
            const positionSize = riskAmount / (stopLoss * pipValue);

            document.getElementById('positionSizeResult').classList.remove('hidden');
            document.getElementById('positionSizeValue').textContent = positionSize.toFixed(2);
        });

        document.getElementById('pipCalculatorForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const pair = document.getElementById('pipPair').value;
            const lots = parseFloat(document.getElementById('pipLots').value);
            const pips = parseFloat(document.getElementById('pipAmount').value);

            if (isNaN(lots) || isNaN(pips)) {
                showToast('âŒ Bitte alle Felder ausfÃ¼llen');
                return;
            }

            // Simplified pip value calculation (real values vary)
            const pipValues = {
                'EUR/USD': 10,
                'GBP/USD': 10,
                'USD/JPY': 9.09,
                'USD/CHF': 10.20,
                'AUD/USD': 10
            };

            const basePipValue = pipValues[pair] || 10;
            const pipValue = basePipValue * lots;
            const total = pipValue * pips;

            document.getElementById('pipResult').classList.remove('hidden');
            document.getElementById('pipValue').textContent = formatCurrency(pipValue);
            document.getElementById('pipTotal').textContent = formatCurrency(total);
        });

    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b75ff03d30be0d3',t:'MTc2NzMxMjIzNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
