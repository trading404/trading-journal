<!doctype html>
<html lang="de" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Professional Trading Journal</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script><!-- Firebase SDK v9 -->
  <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, setDoc, getDoc, query, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        window.firebaseModules = { initializeApp, getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, setDoc, getDoc, query, orderBy };
    </script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        * {
            scrollbar-width: thin;
            scrollbar-color: #6366f1 #1a1f3a;
        }
        
        *::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        *::-webkit-scrollbar-track {
            background: #1a1f3a;
        }
        
        *::-webkit-scrollbar-thumb {
            background: #6366f1;
            border-radius: 4px;
        }
        
        body {
            background: linear-gradient(135deg, #0a0e27 0%, #1e1b4b 25%, #312e81 50%, #1e1b4b 75%, #0a0e27 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        
        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }
        
        .glass-card {
            background: rgba(26, 31, 58, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }
        
        .modal-overlay {
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(10px);
        }
        
        .emotion-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        /* Light Mode Styles */
        body.light-mode {
            background: linear-gradient(135deg, #f0f4ff 0%, #e0e7ff 25%, #ddd6fe 50%, #e0e7ff 75%, #f0f4ff 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            color: #1e293b;
        }
        
        body.light-mode .glass-card {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(139, 92, 246, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            color: #1e293b;
        }
        
        body.light-mode .modal-overlay {
            background: rgba(255, 255, 255, 0.95);
        }
        
        body.light-mode * {
            scrollbar-color: #8b5cf6 #e0e7ff;
        }
        
        body.light-mode *::-webkit-scrollbar-track {
            background: #e0e7ff;
        }
        
        body.light-mode *::-webkit-scrollbar-thumb {
            background: #8b5cf6;
        }
        
        body.light-mode .text-white {
            color: #1e293b !important;
        }
        
        body.light-mode .text-gray-400 {
            color: #64748b !important;
        }
        
        body.light-mode .text-gray-300 {
            color: #475569 !important;
        }
        
        body.light-mode .bg-slate-800 {
            background-color: #f1f5f9 !important;
            border: 1px solid #e2e8f0;
        }
        
        body.light-mode .bg-slate-700 {
            background-color: #e2e8f0 !important;
        }
        
        body.light-mode aside {
            background-color: #f8fafc !important;
            border-right-color: #e2e8f0 !important;
        }
        
        body.light-mode input,
        body.light-mode select,
        body.light-mode textarea {
            background-color: #ffffff !important;
            border-color: #d1d5db !important;
            color: #1e293b !important;
        }
        
        body.light-mode input::placeholder,
        body.light-mode textarea::placeholder {
            color: #9ca3af !important;
        }
        
        .theme-toggle {
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 9999px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        body.light-mode .theme-toggle {
            background: rgba(139, 92, 246, 0.1);
        }
        
        body.light-mode .theme-toggle:hover {
            background: rgba(139, 92, 246, 0.2);
        }
        
        .lang-btn {
            padding: 6px 12px;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.3s;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .lang-btn.active {
            background: #8b5cf6;
        }
        
        body.light-mode .lang-btn {
            background: rgba(139, 92, 246, 0.1);
            color: #1e293b;
        }
        
        body.light-mode .lang-btn:hover {
            background: rgba(139, 92, 246, 0.2);
        }
        
        body.light-mode .lang-btn.active {
            background: #8b5cf6;
            color: white;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full text-white">
  <div class="min-h-full w-full flex flex-col overflow-auto"><!-- Login Screen -->
   <div id="loginScreen" class="flex-1 flex items-center justify-center px-4">
    <div class="glass-card rounded-3xl p-10 max-w-md w-full"><!-- Theme & Language Controls -->
     <div class="flex justify-end gap-2 mb-6">
      <div class="flex gap-1"><button class="lang-btn active" data-lang="de">DE</button> <button class="lang-btn" data-lang="en">EN</button> <button class="lang-btn" data-lang="es">ES</button>
      </div>
      <div class="theme-toggle" id="themeToggleLogin"><span id="themeIconLogin">ğŸŒ™</span>
      </div>
     </div>
     <div class="text-center mb-10">
      <div class="text-7xl mb-6">
       ğŸ“Š
      </div>
      <h1 class="text-4xl font-bold mb-3 bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent" data-i18n="loginTitle">Trading Journal Pro</h1>
      <p class="text-gray-400 text-lg" data-i18n="loginSubtitle">Professionelles Trade Management</p>
     </div>
     <form id="loginForm" class="space-y-5 mb-6">
      <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="emailLabel">E-Mail Adresse</label> <input type="email" id="loginEmail" class="w-full px-5 py-4 rounded-xl text-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" data-i18n-placeholder="emailPlaceholder" placeholder="deine@email.de" required>
      </div>
      <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="passwordLabel">Passwort</label> <input type="password" id="loginPassword" class="w-full px-5 py-4 rounded-xl text-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="â€¢â€¢â€¢â€¢â€¢     â€¢â€¢" required>
      </div><button type="submit" class="w-full py-4 rounded-xl font-bold text-white text-lg bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 transition"> <span data-i18n="loginButton">ğŸ” Anmelden</span> </button>
     </form>
     <div class="text-center"><button id="showRegisterBtn" class="text-purple-400 hover:text-purple-300 font-semibold" data-i18n="showRegister"> Noch kein Konto? Jetzt registrieren â†’ </button>
     </div>
    </div>
   </div><!-- Register Screen -->
   <div id="registerScreen" class="flex-1 flex items-center justify-center px-4 hidden">
    <div class="glass-card rounded-3xl p-10 max-w-md w-full"><!-- Theme & Language Controls -->
     <div class="flex justify-end gap-2 mb-6">
      <div class="flex gap-1"><button class="lang-btn active" data-lang="de">DE</button> <button class="lang-btn" data-lang="en">EN</button> <button class="lang-btn" data-lang="es">ES</button>
      </div>
      <div class="theme-toggle" id="themeToggleRegister"><span id="themeIconRegister">ğŸŒ™</span>
      </div>
     </div>
     <div class="text-center mb-10">
      <div class="text-7xl mb-6">
       ğŸš€
      </div>
      <h1 class="text-4xl font-bold mb-3 bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent" data-i18n="registerTitle">Registrierung</h1>
      <p class="text-gray-400 text-lg" data-i18n="registerSubtitle">Erstelle dein Trading Journal</p>
     </div>
     <form id="registerForm" class="space-y-5 mb-6">
      <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="emailLabel">E-Mail Adresse</label> <input type="email" id="registerEmail" class="w-full px-5 py-4 rounded-xl text-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" data-i18n-placeholder="emailPlaceholder" placeholder="deine@email.de" required>
      </div>
      <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="passwordLabelMin">Passwort (min. 6 Zeichen)</label> <input type="password" id="registerPassword" class="w-full px-5 py-4 rounded-xl text-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
      </div><button type="submit" class="w-full py-4 rounded-xl font-bold text-white text-lg bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 transition"> <span data-i18n="registerButton">âœ¨ Konto erstellen</span> </button>
     </form>
     <div class="text-center"><button id="showLoginBtn" class="text-purple-400 hover:text-purple-300 font-semibold" data-i18n="showLogin"> â† Bereits registriert? Jetzt anmelden </button>
     </div>
    </div>
   </div><!-- Main App -->
   <div id="mainApp" class="flex-1 flex flex-col w-full hidden">
    <header class="bg-gradient-to-r from-purple-600 to-blue-600 shadow-2xl w-full sticky top-0 z-50">
     <div class="max-w-7xl mx-auto px-6 py-6">
      <div class="flex items-center justify-between flex-wrap gap-4">
       <h1 class="text-2xl sm:text-3xl font-bold text-white flex items-center gap-3"><span class="text-4xl">ğŸ’</span> <span data-i18n="appTitle">Trading Journal Pro</span></h1>
       <div class="flex items-center gap-4">
        <div class="flex gap-1"><button class="lang-btn text-white active" data-lang="de">DE</button> <button class="lang-btn text-white" data-lang="en">EN</button> <button class="lang-btn text-white" data-lang="es">ES</button>
        </div>
        <div class="theme-toggle" id="themeToggleMain"><span id="themeIconMain">ğŸŒ™</span>
        </div>
        <div class="bg-white bg-opacity-10 px-4 py-2 rounded-xl">
         <div class="text-xs text-purple-100" data-i18n="capital">
          Kapital
         </div>
         <div class="text-xl font-bold" id="headerCapital">
          â‚¬0.00
         </div>
        </div><button id="logoutBtn" class="bg-red-500 hover:bg-red-600 px-5 py-3 rounded-xl font-bold transition"> <span data-i18n="logout">ğŸšª Abmelden</span> </button>
       </div>
      </div>
     </div>
    </header>
    <div class="flex flex-1 overflow-hidden w-full">
     <aside class="w-64 bg-slate-800 border-r border-slate-700 overflow-y-auto flex-shrink-0">
      <nav class="p-4 space-y-2"><button class="nav-button active w-full text-left px-5 py-4 rounded-xl font-bold bg-purple-600 text-white flex items-center gap-3 transition" data-tab="dashboard"> <span class="text-xl">ğŸ“Š</span> <span data-i18n="navDashboard">Dashboard</span> </button> <button class="nav-button w-full text-left px-5 py-4 rounded-xl font-bold text-gray-400 hover:text-white hover:bg-slate-700 flex items-center gap-3 transition" data-tab="newtrade"> <span class="text-xl">â•</span> <span data-i18n="navNewTrade">Neuer Trade</span> </button> <button class="nav-button w-full text-left px-5 py-4 rounded-xl font-bold text-gray-400 hover:text-white hover:bg-slate-700 flex items-center gap-3 transition" data-tab="history"> <span class="text-xl">ğŸ“œ</span> <span data-i18n="navHistory">Historie</span> </button> <button class="nav-button w-full text-left px-5 py-4 rounded-xl font-bold text-gray-400 hover:text-white hover:bg-slate-700 flex items-center gap-3 transition" data-tab="performance"> <span class="text-xl">ğŸ“ˆ</span> <span data-i18n="navPerformance">Performance</span> </button> <button class="nav-button w-full text-left px-5 py-4 rounded-xl font-bold text-gray-400 hover:text-white hover:bg-slate-700 flex items-center gap-3 transition" data-tab="emotions"> <span class="text-xl">ğŸ˜Š</span> <span data-i18n="navEmotions">Emotionen</span> </button> <button class="nav-button w-full text-left px-5 py-4 rounded-xl font-bold text-gray-400 hover:text-white hover:bg-slate-700 flex items-center gap-3 transition" data-tab="compound"> <span class="text-xl">ğŸ’°</span> <span data-i18n="navCompound">Zinseszins</span> </button> <button class="nav-button w-full text-left px-5 py-4 rounded-xl font-bold text-gray-400 hover:text-white hover:bg-slate-700 flex items-center gap-3 transition" data-tab="calendar"> <span class="text-xl">ğŸ“…</span> <span data-i18n="navCalendar">Kalender</span> </button> <button class="nav-button w-full text-left px-5 py-4 rounded-xl font-bold text-gray-400 hover:text-white hover:bg-slate-700 flex items-center gap-3 transition" data-tab="withdrawals"> <span class="text-xl">ğŸ’¸</span> <span data-i18n="navWithdrawals">Auszahlungen</span> </button> <button class="nav-button w-full text-left px-5 py-4 rounded-xl font-bold text-gray-400 hover:text-white hover:bg-slate-700 flex items-center gap-3 transition" data-tab="deposits"> <span class="text-xl">ğŸ’µ</span> <span data-i18n="navDeposits">Einzahlungen</span> </button> <button class="nav-button w-full text-left px-5 py-4 rounded-xl font-bold text-gray-400 hover:text-white hover:bg-slate-700 flex items-center gap-3 transition" data-tab="calculator"> <span class="text-xl">ğŸ§®</span> <span data-i18n="navCalculator">Rechner</span> </button>
      </nav>
     </aside>
     <main class="flex-1 overflow-auto w-full">
      <div class="max-w-7xl mx-auto px-6 py-8"><!-- Dashboard Tab -->
       <div id="dashboardTab" class="tab-content"><!-- Startkapital festlegen -->
        <div class="glass-card rounded-2xl p-8 mb-8">
         <h2 class="text-3xl font-bold mb-6 flex items-center gap-3"><span>ğŸ’¼</span> <span data-i18n="startCapitalTitle">Startkapital festlegen</span></h2>
         <form id="startCapitalForm" class="flex gap-4 flex-wrap"><input type="number" id="startCapital" step="0.01" class="flex-1 min-w-[200px] px-5 py-4 rounded-xl text-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" data-i18n-placeholder="startCapitalPlaceholder" placeholder="z.B. 10000" required> <button type="submit" class="px-8 py-4 rounded-xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 transition"> <span data-i18n="save">ğŸ’¾ Speichern</span> </button>
         </form>
         <div id="startCapitalDisplay" class="mt-6 hidden">
          <div class="text-sm text-gray-400 font-bold" data-i18n="startCapital">
           Startkapital
          </div>
          <div class="text-4xl font-bold text-purple-400 mt-2" id="startCapitalValue">
           â‚¬0.00
          </div>
         </div>
        </div><!-- FinanzÃ¼bersicht -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
         <div class="glass-card rounded-2xl p-6 text-center transform hover:scale-105 transition">
          <div class="text-4xl mb-3">
           ğŸ’°
          </div>
          <div class="text-sm text-gray-400 mb-2" data-i18n="currentCapital">
           Aktuelles Kapital
          </div>
          <div class="text-3xl font-bold text-purple-400" id="currentCapital">
           â‚¬0.00
          </div>
         </div>
         <div class="glass-card rounded-2xl p-6 text-center transform hover:scale-105 transition">
          <div class="text-4xl mb-3">
           ğŸ“Š
          </div>
          <div class="text-sm text-gray-400 mb-2" data-i18n="totalPL">
           Gesamt P/L
          </div>
          <div class="text-3xl font-bold" id="totalPL">
           â‚¬0.00
          </div>
         </div>
         <div class="glass-card rounded-2xl p-6 text-center transform hover:scale-105 transition">
          <div class="text-4xl mb-3">
              
          </div>
          <div class="text-sm text-gray-400 mb-2" data-i18n="winRate">
           Winrate
          </div>
          <div class="text-3xl font-bold" id="winRate">
           0%
          </div>
         </div>
         <div class="glass-card rounded-2xl p-6 text-center transform hover:scale-105 transition">
          <div class="text-4xl mb-3">
           ğŸ“
          </div>
          <div class="text-sm text-gray-400 mb-2" data-i18n="trades">
           Trades
          </div>
          <div class="text-3xl font-bold" id="totalTrades">
           0
          </div>
         </div>
        </div><!-- Equity Curve -->
        <div class="glass-card rounded-2xl p-8 mb-8">
         <h3 class="text-2xl font-bold mb-6 flex items-center gap-3"><span>ğŸ“ˆ</span> <span data-i18n="equityCurve">Equity Curve</span></h3>
         <div class="h-96">
          <canvas id="dashboardEquityChart"></canvas>
         </div>
        </div><!-- Deine aktuelle Performance -->
        <div class="glass-card rounded-2xl p-8">
         <h3 class="text-2xl font-bold mb-6 flex items-center gap-3"><span>ğŸ¯</span> <span data-i18n="currentPerformanceTitle">Deine aktuelle Performance</span></h3>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="currentPerformanceGrid"><!-- Dynamisch gefÃ¼llt -->
         </div>
        </div>
       </div><!-- Neuer Trade Tab -->
       <div id="newtradeTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-8">
         <h2 class="text-3xl font-bold mb-6 flex items-center gap-3"><span>â•</span> <span data-i18n="newTradeTitle">Neuen Trade hinzufÃ¼gen</span></h2>
         <form id="newTradeForm" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
           <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="date">Datum *</label> <input type="date" id="tradeDate" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" required>
           </div>
           <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="asset">Asset</label> <select id="tradeAsset" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="" data-i18n="pleaseSelect">-- Bitte wÃ¤hlen --</option> <option value="EUR/USD">EUR/USD</option> <option value="GBP/USD">GBP/USD</option> <option value="USD/JPY">USD/JPY</option> <option value="USD/CHF">USD/CHF</option> <option value="AUD/USD">AUD/USD</option> <option value="USD/CAD">USD/CAD</option> <option value="NZD/USD">NZD/USD</option> <option value="EUR/GBP">EUR/GBP</option> <option value="EUR/JPY">EUR/JPY</option> <option value="GBP/JPY">GBP/JPY</option> <option value="Gold (XAU/USD)">Gold (XAU/USD)</option> <option value="Silver (XAG/USD)">Silver (XAG/USD)</option> <option value="Oil (WTI)">Oil (WTI)</option> <option value="Bitcoin">Bitcoin</option> <option value="Ethereum">Ethereum</option> </select>
           </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
           <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="result">Ergebnis</label> <select id="tradeResult" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="win">âœ… Win</option> <option value="loss">âŒ Loss</option> <option value="breakeven">âš–ï¸ Break Even</option> </select>
           </div>
           <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="profitLoss">Profit/Loss (â‚¬)</label> <input type="number" id="tradeProfitLoss" step="0.01" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="0.00">
           </div>
           <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="position">Position</label> <select id="tradePosition" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="Long">Long</option> <option value="Short">Short</option> </select>
           </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
           <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="strategy">Strategie</label> <input type="text" id="tradeStrategy" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" data-i18n-placeholder="strategyPlaceholder" placeholder="z.B. Breakout">
           </div>
           <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="emotion">Emotion</label> <select id="tradeEmotion" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="" data-i18n="none">-- Keine --</option> <option value="ğŸ˜Š Zufrieden">ğŸ˜Š Zufrieden</option> <option value="ğŸ˜ƒ Euphorisch">ğŸ˜ƒ Euphorisch</option> <option value="ğŸ˜Œ Ruhig">ğŸ˜Œ Ruhig</option> <option value="ğŸ˜ Neutral">   Neutral</option> <option value="ğŸ˜Ÿ Unsicher">ğŸ˜Ÿ Unsicher</option> <option value="ğŸ˜° NervÃ¶s">ğŸ˜° NervÃ¶s</option> <option value="ğŸ˜¡ Frustriert">ğŸ˜¡ Frustriert</option> <option value="ğŸ˜± FOMO">ğŸ˜± FOMO</option> <option value="ğŸ˜¤ Rachetrading">ğŸ˜¤ Rachetrading</option> </select>
           </div>
          </div>
          <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="notes">Notizen</label> <textarea id="tradeNotes" rows="4" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" data-i18n-placeholder="notesPlaceholder" placeholder="Details zum Trade, Setup, Fehler, Learnings..."></textarea>
          </div><button type="submit" class="w-full py-5 rounded-xl font-bold text-white text-lg bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 transition transform hover:scale-105"> <span data-i18n="saveTrade">ğŸ’¾ Trade speichern</span> </button>
         </form>
        </div>
       </div><!-- Historie Tab -->
       <div id="historyTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-8 mb-6">
         <div class="flex justify-between items-center mb-6 flex-wrap gap-4">
          <h2 class="text-3xl font-bold flex items-center gap-3"><span>ğŸ“œ</span> <span data-i18n="tradeHistory">Trade Historie</span></h2>
          <div class="flex gap-3 flex-wrap"><select id="filterAsset" class="px-4 py-2 rounded-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white text-sm focus:border-purple-500 outline-none"> <option value="all" data-i18n="allAssets">Alle Assets</option> </select> <select id="filterResult" class="px-4 py-2 rounded-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white text-sm focus:border-purple-500 outline-none"> <option value="all" data-i18n="allResults">Alle Ergebnisse</option> <option value="win">âœ… Wins</option> <option value="loss">âŒ Loss</option> <option value="breakeven">âš–ï¸ Break Even</option> </select>
          </div>
         </div>
         <div id="tradeHistoryList" class="space-y-4"></div>
        </div>
       </div><!-- Auszahlungen Tab -->
       <div id="withdrawalsTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-8 mb-8">
         <h2 class="text-3xl font-bold mb-6 flex items-center gap-3"><span>ğŸ’¸</span> <span data-i18n="withdrawalTitle">Auszahlung erfassen</span></h2>
         <form id="withdrawalForm" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
           <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="amount">Betrag (â‚¬)</label> <input type="number" id="withdrawalAmount" step="0.01" class="w-full px-5 py-4 rounded-xl text-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" data-i18n-placeholder="amountPlaceholder" placeholder="z.B. 5000" required>
           </div>
           <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="date">Datum</label> <input type="date" id="withdrawalDate" class="w-full px-5 py-4 rounded-xl text-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" required>
           </div>
          </div>
          <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="noteOptional">Notiz (optional)</label> <textarea id="withdrawalNote" rows="3" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" data-i18n-placeholder="withdrawalNotePlaceholder" placeholder="z.B. GewinnausschÃ¼ttung Q1"></textarea>
          </div><button type="submit" class="w-full py-5 rounded-xl font-bold text-white text-lg bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 transition transform hover:scale-105"> <span data-i18n="saveWithdrawal">ğŸ’¸ Auszahlung speichern</span> </button>
         </form>
        </div>
        <div class="glass-card rounded-2xl p-8">
         <h3 class="text-2xl font-bold mb-6 flex items-center gap-3"><span>ğŸ“œ</span> <span data-i18n="withdrawalHistory">Auszahlungs-Historie</span></h3>
         <div id="withdrawalsList" class="space-y-4"><!-- Dynamisch gefÃ¼llt -->
         </div>
        </div>
       </div><!-- Einzahlungen Tab -->
       <div id="depositsTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-8 mb-8">
         <h2 class="text-3xl font-bold mb-6 flex items-center gap-3"><span>ğŸ’µ</span> <span data-i18n="depositTitle">NachtrÃ¤gliche Einzahlung</span></h2>
         <form id="depositForm" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
           <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="amount">Betrag (â‚¬)</label> <input type="number" id="depositAmount" step="0.01" class="w-full px-5 py-4 rounded-xl text-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" data-i18n-placeholder="depositAmountPlaceholder" placeholder="z.B. 10000" required>
           </div>
           <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="date">Datum</label> <input type="date" id="depositDate" class="w-full px-5 py-4 rounded-xl text-lg bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" required>
           </div>
          </div>
          <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="noteOptional">Notiz (optional)</label> <textarea id="depositNote" rows="3" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" data-i18n-placeholder="depositNotePlaceholder" placeholder="z.B. KapitalerhÃ¶hung"></textarea>
          </div><button type="submit" class="w-full py-5 rounded-xl font-bold text-white text-lg bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 transition transform hover:scale-105"> <span data-i18n="saveDeposit">ğŸ’µ Einzahlung speichern</span> </button>
         </form>
        </div>
        <div class="glass-card rounded-2xl p-8">
         <h3 class="text-2xl font-bold mb-6 flex items-center gap-3"><span>ğŸ“œ</span> <span data-i18n="depositHistory">Einzahlungs-Historie</span></h3>
         <div id="depositsList" class="space-y-4"><!-- Dynamisch gefÃ¼llt -->
         </div>
        </div>
       </div><!-- Performance Tab -->
       <div id="performanceTab" class="tab-content hidden"><!-- Statistiken -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
         <div class="glass-card rounded-2xl p-6 text-center">
          <div class="text-4xl mb-3">
           ğŸ†
          </div>
          <div class="text-sm text-gray-400 mb-2" data-i18n="bestTrade">
           Bester Trade
          </div>
          <div class="text-2xl font-bold text-green-400" id="perfBestTrade">
           â‚¬0.00
          </div>
         </div>
         <div class="glass-card rounded-2xl p-6 text-center">
          <div class="text-4xl mb-3">
           ğŸ’”
          </div>
          <div class="text-sm text-gray-400 mb-2" data-i18n="worstTrade">
           Schlechtester Trade
          </div>
          <div class="text-2xl font-bold text-red-400" id="perfWorstTrade">
           â‚¬0.00
          </div>
         </div>
         <div class="glass-card rounded-2xl p-6 text-center">
          <div class="text-4xl mb-3">
           ğŸ”¥
          </div>
          <div class="text-sm text-gray-400 mb-2" data-i18n="winStreak">
           Win Streak
          </div>
          <div class="text-2xl font-bold text-green-400" id="perfWinStreak">
           0
          </div>
         </div>
         <div class="glass-card rounded-2xl p-6 text-center">
          <div class="text-4xl mb-3">
           â„ï¸
          </div>
          <div class="text-sm text-gray-400 mb-2" data-i18n="lossStreak">
           Loss Streak
          </div>
          <div class="text-2xl font-bold text-red-400" id="perfLossStreak">
           0
          </div>
         </div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
         <div class="glass-card rounded-2xl p-6 text-center">
          <div class="text-4xl mb-3">
           ğŸ“ˆ
          </div>
          <div class="text-sm text-gray-400 mb-2" data-i18n="avgWin">
           Ã˜ Gewinn
          </div>
          <div class="text-2xl font-bold text-green-400" id="perfAvgWin">
           â‚¬0.00
          </div>
         </div>
         <div class="glass-card rounded-2xl p-6 text-center">
          <div class="text-4xl mb-3">
           ğŸ“‰
          </div>
          <div class="text-sm text-gray-400 mb-2" data-i18n="avgLoss">
           Ã˜ Verlust
          </div>
          <div class="text-2xl font-bold text-red-400" id="perfAvgLoss">
           â‚¬0.00
          </div>
         </div>
        </div><!-- Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
         <div class="glass-card rounded-2xl p-8">
          <h3 class="text-xl font-bold mb-4" data-i18n="streakChart">ğŸ“Š Gewinn/Verlust StrÃ¤hnen</h3>
          <div class="h-64">
           <canvas id="streakChart"></canvas>
          </div>
         </div>
         <div class="glass-card rounded-2xl p-8">
          <h3 class="text-xl font-bold mb-4" data-i18n="distributionChart">ğŸ¯ Gewinn/Verlust Verteilung</h3>
          <div class="h-64">
           <canvas id="distributionChart"></canvas>
          </div>
         </div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
         <div class="glass-card rounded-2xl p-8">
          <h3 class="text-xl font-bold mb-4" data-i18n="strategyChart">ğŸ² Performance nach Strategie</h3>
          <div class="h-64">
           <canvas id="strategyChart"></canvas>
          </div>
         </div>
         <div class="glass-card rounded-2xl p-8">
          <h3 class="text-xl font-bold mb-4" data-i18n="monthlyChart">ğŸ“… Monatliche Performance</h3>
          <div class="h-64">
           <canvas id="monthlyChart"></canvas>
          </div>
         </div>
        </div>
        <div class="glass-card rounded-2xl p-8 mb-8">
         <h3 class="text-xl font-bold mb-4" data-i18n="assetChart">ğŸ’± Performance nach Asset</h3>
         <div class="h-96">
          <canvas id="assetChart"></canvas>
         </div>
        </div>
        <div class="glass-card rounded-2xl p-8">
         <h3 class="text-xl font-bold mb-4" data-i18n="currentPerfChart">ğŸ¯ Deine aktuelle Performance</h3>
         <div class="h-96">
          <canvas id="currentPerfChart"></canvas>
         </div>
        </div>
       </div><!-- Emotionen Tab -->
       <div id="emotionsTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-8 mb-8">
         <h2 class="text-3xl font-bold mb-6 flex items-center gap-3"><span>ğŸ˜Š</span> <span data-i18n="emotionAnalysis">Emotions-Analyse</span></h2>
         <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="h-64">
           <canvas id="emotionChart"></canvas>
          </div>
          <div id="emotionStats" class="space-y-4"><!-- Dynamisch gefÃ¼llt -->
          </div>
         </div>
        </div>
        <div class="glass-card rounded-2xl p-8">
         <h3 class="text-xl font-bold mb-4" data-i18n="emotionPerformance">ğŸ“Š Performance pro Emotion</h3>
         <div id="emotionPerformanceList" class="space-y-3"><!-- Dynamisch gefÃ¼llt -->
         </div>
        </div>
       </div><!-- Zinseszins Tab -->
       <div id="compoundTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-8 mb-8">
         <h2 class="text-3xl font-bold mb-6 flex items-center gap-3"><span>ğŸ’°</span> <span data-i18n="compoundCalculator">Zinseszins-Rechner</span></h2>
         <form id="compoundForm" class="space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
           <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="targetAmount">Ziel Summe (â‚¬)</label> <input type="number" id="compoundTarget" step="0.01" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="100000" required>
           </div>
           <div><label class="block text-sm font-bold mb-3 text-purple-300" data-i18n="monthlyReturn">Monatliche Rendite (%)</label> <input type="number" id="compoundRate" step="0.01" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="5" required>
           </div>
           <div class="flex items-end"><button type="submit" class="w-full py-4 rounded-xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 transition"> <span data-i18n="calculate">ğŸ§® Berechnen</span> </button>
           </div>
          </div>
         </form>
         <div id="compoundResults" class="mt-8 hidden">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
           <div class="bg-slate-800 rounded-xl p-6 text-center">
            <div class="text-sm text-gray-400 mb-2">
             ğŸ¯ <span data-i18n="requiredMonthsTarget">BenÃ¶tigte Monate (Ziel)</span>
            </div>
            <div class="text-3xl font-bold text-purple-400" id="compoundMonths">
             0
            </div>
            <div class="text-xs text-gray-500 mt-2" data-i18n="withDesiredReturn">
             Mit gewÃ¼nschter Rendite
            </div>
           </div>
           <div class="bg-slate-800 rounded-xl p-6 text-center">
            <div class="text-sm text-gray-400 mb-2">
             ğŸ“Š <span data-i18n="withCurrentPerformance">Mit aktueller Performance</span>
            </div>
            <div class="text-3xl font-bold text-blue-400" id="compoundCurrentMonths">
             0
            </div>
            <div class="text-xs text-gray-500 mt-2" data-i18n="basedOnTrades">
             Basierend auf deinen Trades
            </div>
           </div>
          </div><!-- Status Indicator -->
          <div id="compoundStatus" class="rounded-2xl p-8 mb-6 text-center">
           <div class="text-6xl mb-4" id="compoundStatusIcon">
            ğŸ¯
           </div>
           <div class="text-3xl font-bold mb-3" id="compoundStatusText">
            Berechne...
           </div>
           <div class="text-lg text-gray-300" id="compoundStatusDetail"></div>
           <div class="mt-4 text-sm text-gray-400" id="compoundStatusExtra"></div>
          </div><!-- Vergleichsdiagramm -->
          <div class="mb-6">
           <h4 class="text-xl font-bold mb-4 text-center">ğŸ“Š Geplant vs. Deine aktuelle Performance</h4>
           <div class="h-96">
            <canvas id="compoundComparisonChart"></canvas>
           </div>
          </div>
          <div class="h-96">
           <canvas id="compoundChart"></canvas>
          </div>
         </div>
        </div>
       </div><!-- Kalender Tab -->
       <div id="calendarTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-8 mb-8">
         <div class="flex justify-between items-center mb-6">
          <h2 class="text-3xl font-bold flex items-center gap-3"><span>ğŸ“…</span> <span id="calendarMonth" data-i18n="calendar">Kalender</span></h2>
          <div class="flex gap-2"><button id="prevMonth" class="px-4 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 transition">â—€</button> <button id="todayBtn" class="px-4 py-2 rounded-lg bg-purple-600 hover:bg-purple-700 transition" data-i18n="today">Heute</button> <button id="nextMonth" class="px-4 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 transition">â–¶</button>
          </div>
         </div>
         <div class="grid grid-cols-7 gap-2 mb-4">
          <div class="text-center font-bold text-gray-400 py-2" data-i18n="mon">
           Mo
          </div>
          <div class="text-center font-bold text-gray-400 py-2" data-i18n="tue">
           Di
          </div>
          <div class="text-center font-bold text-gray-400 py-2" data-i18n="wed">
           Mi
          </div>
          <div class="text-center font-bold text-gray-400 py-2" data-i18n="thu">
           Do
          </div>
          <div class="text-center font-bold text-gray-400 py-2" data-i18n="fri">
           Fr
          </div>
          <div class="text-center font-bold text-gray-400 py-2" data-i18n="sat">
           Sa
          </div>
          <div class="text-center font-bold text-gray-400 py-2" data-i18n="sun">
           So
          </div>
         </div>
         <div id="calendarGrid" class="grid grid-cols-7 gap-2"><!-- Dynamisch gefÃ¼llt -->
         </div>
        </div>
        <div class="glass-card rounded-2xl p-8">
         <h3 class="text-2xl font-bold mb-6 flex items-center gap-3"><span>ğŸ“</span> <span data-i18n="addEvent">Termin hinzufÃ¼gen</span></h3>
         <form id="eventForm" class="space-y-4"><input type="date" id="eventDate" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" required> <input type="text" id="eventTitle" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" data-i18n-placeholder="eventTitlePlaceholder" placeholder="Termin Titel" required> <textarea id="eventDescription" rows="3" class="w-full px-5 py-4 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" data-i18n-placeholder="eventDescriptionPlaceholder" placeholder="Beschreibung (optional)"></textarea> <button type="submit" class="w-full py-4 rounded-xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 transition"> <span data-i18n="saveEvent">ğŸ“… Termin speichern</span> </button>
         </form>
        </div>
       </div><!-- Rechner Tab -->
       <div id="calculatorTab" class="tab-content hidden">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6"><!-- PositionsgrÃ¶ÃŸen-Rechner -->
         <div class="glass-card rounded-2xl p-8">
          <h3 class="text-2xl font-bold mb-6 flex items-center gap-3"><span>ğŸ“</span> <span data-i18n="positionSizeCalculator">PositionsgrÃ¶ÃŸen-Rechner</span></h3>
          <form id="positionSizeForm" class="space-y-4">
           <div><label class="block text-sm font-bold mb-2 text-purple-300" data-i18n="accountBalance">Kontostand (â‚¬)</label> <input type="number" id="psBalance" step="0.01" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none">
           </div>
           <div><label class="block text-sm font-bold mb-2 text-purple-300" data-i18n="riskPerTrade">Risiko pro Trade (%)</label> <input type="number" id="psRisk" step="0.1" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="1">
           </div>
           <div><label class="block text-sm font-bold mb-2 text-purple-300" data-i18n="stopLoss">Stop Loss (Pips)</label> <input type="number" id="psStopLoss" step="0.1" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="50">
           </div>
           <div><label class="block text-sm font-bold mb-2 text-purple-300" data-i18n="pipValue">Pip-Wert (â‚¬)</label> <input type="number" id="psPipValue" step="0.01" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="10">
           </div><button type="submit" class="w-full py-4 rounded-xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 transition"> <span data-i18n="calculate">ğŸ§® Berechnen</span> </button>
           <div id="positionSizeResult" class="mt-6 p-6 bg-slate-800 rounded-xl hidden">
            <div class="text-sm text-gray-400 mb-2" data-i18n="recommendedPosition">
             Empfohlene PositionsgrÃ¶ÃŸe
            </div>
            <div class="text-3xl font-bold text-purple-400" id="positionSizeValue">
             0
            </div>
            <div class="text-sm text-gray-400 mt-2">
             Lots
            </div>
           </div>
          </form>
         </div><!-- Pip-Rechner -->
         <div class="glass-card rounded-2xl p-8">
          <h3 class="text-2xl font-bold mb-6 flex items-center gap-3"><span>ğŸ“Š</span> <span data-i18n="pipCalculator">Pip-Rechner</span></h3>
          <form id="pipCalculatorForm" class="space-y-4">
           <div><label class="block text-sm font-bold mb-2 text-purple-300" data-i18n="currencyPair">WÃ¤hrungspaar</label> <select id="pipPair" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="EUR/USD">EUR/USD</option> <option value="GBP/USD">GBP/USD</option> <option value="USD/JPY">USD/JPY</option> <option value="USD/CHF">USD/CHF</option> <option value="AUD/USD">AUD/USD</option> </select>
           </div>
           <div><label class="block text-sm font-bold mb-2 text-purple-300" data-i18n="lotSize">Lot-GrÃ¶ÃŸe</label> <input type="number" id="pipLots" step="0.01" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="1">
           </div>
           <div><label class="block text-sm font-bold mb-2 text-purple-300" data-i18n="numberOfPips">Anzahl Pips</label> <input type="number" id="pipAmount" step="0.1" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" placeholder="50">
           </div>
           <div><label class="block text-sm font-bold mb-2 text-purple-300" data-i18n="convertTo">Konvertierung nach</label> <select id="pipCurrency" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="EUR">EUR</option> <option value="USD">USD</option> <option value="GBP">GBP</option> </select>
           </div><button type="submit" class="w-full py-4 rounded-xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 transition"> <span data-i18n="calculate">ğŸ§® Berechnen</span> </button>
           <div id="pipResult" class="mt-6 p-6 bg-slate-800 rounded-xl hidden">
            <div class="text-sm text-gray-400 mb-2" data-i18n="pipValue">
             Pip-Wert
            </div>
            <div class="text-3xl font-bold text-purple-400" id="pipValue">
             â‚¬0.00
            </div>
            <div class="text-sm text-gray-400 mt-4 mb-2" data-i18n="totalValue">
             Gesamtwert
            </div>
            <div class="text-2xl font-bold text-blue-400" id="pipTotal">
             â‚¬0.00
            </div>
           </div>
          </form>
         </div>
        </div>
       </div>
      </div>
     </main>
    </div>
   </div>
  </div><!-- Edit Trade Modal -->
  <div id="editModal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay">
   <div class="glass-card rounded-2xl p-8 max-w-2xl w-full mx-4 max-h-[90%] overflow-y-auto">
    <h3 class="text-2xl font-bold mb-6" data-i18n="editTrade">Trade bearbeiten</h3>
    <form id="editTradeForm" class="space-y-4"><input type="hidden" id="editTradeId">
     <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div><label class="block text-sm font-bold mb-2 text-purple-300" data-i18n="date">Datum</label> <input type="date" id="editDate" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none" required>
      </div>
      <div><label class="block text-sm font-bold mb-2 text-purple-300" data-i18n="asset">Asset</label> <select id="editAsset" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="" data-i18n="pleaseSelect">-- Bitte wÃ¤hlen --</option> <option value="EUR/USD">EUR/USD</option> <option value="GBP/USD">GBP/USD</option> <option value="USD/JPY">USD/JPY</option> <option value="USD/CHF">USD/CHF</option> <option value="AUD/USD">AUD/USD</option> <option value="USD/CAD">USD/CAD</option> <option value="NZD/USD">NZD/USD</option> <option value="EUR/GBP">EUR/GBP</option> <option value="EUR/JPY">EUR/JPY</option> <option value="GBP/JPY">GBP/JPY</option> <option value="Gold (XAU/USD)">Gold (XAU/USD)</option> <option value="Silver (XAG/USD)">Silver (XAG/USD)</option> <option value="Oil (WTI)">Oil (WTI)</option> <option value="Bitcoin">Bitcoin</option> <option value="Ethereum">Ethereum</option> </select>
      </div>
     </div>
     <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div><label class="block text-sm font-bold mb-2 text-purple-300" data-i18n="result">Ergebnis</label> <select id="editResult" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="win">âœ… Win</option> <option value="loss">âŒ Loss</option> <option value="breakeven">âš–ï¸ Break Even</option> </select>
      </div>
      <div><label class="block text-sm font-bold mb-2 text-purple-300" data-i18n="profitLoss">P/L (â‚¬)</label> <input type="number" id="editProfitLoss" step="0.01" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none">
      </div>
      <div><label class="block text-sm font-bold mb-2 text-purple-300" data-i18n="position">Position</label> <select id="editPosition" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="Long">Long</option> <option value="Short">Short</option> </select>
      </div>
     </div>
     <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div><label class="block text-sm font-bold mb-2 text-purple-300" data-i18n="strategy">Strategie</label> <input type="text" id="editStrategy" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none">
      </div>
      <div><label class="block text-sm font-bold mb-2 text-purple-300" data-i18n="emotion">Emotion</label> <select id="editEmotion" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"> <option value="" data-i18n="none">-- Keine --</option> <option value="ğŸ˜Š Zufrieden">ğŸ˜Š Zufrieden</option> <option value="ğŸ˜ƒ Euphorisch">ğŸ˜ƒ Euphorisch</option> <option value="ğŸ˜Œ Ruhig">ğŸ˜Œ Ruhig</option> <option value="    Neutral">ğŸ˜ Neutral</option> <option value="ğŸ˜Ÿ Unsicher">ğŸ˜Ÿ Unsicher</option> <option value="ğŸ˜° NervÃ¶s">ğŸ˜° NervÃ¶s</option> <option value="ğŸ˜¡ Frustriert">ğŸ˜¡ Frustriert</option> <option value="ğŸ˜± FOMO">ğŸ˜± FOMO</option> <option value="ğŸ˜¤ Rachetrading">ğŸ˜¤ Rachetrading</option> </select>
      </div>
     </div>
     <div><label class="block text-sm font-bold mb-2 text-purple-300" data-i18n="notes">Notizen</label> <textarea id="editNotes" rows="3" class="w-full px-4 py-3 rounded-xl bg-slate-800 border-2 border-purple-500 border-opacity-30 text-white focus:border-purple-500 outline-none"></textarea>
     </div>
     <div class="flex gap-4"><button type="submit" class="flex-1 py-4 rounded-xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 transition"> <span data-i18n="save">ğŸ’¾ Speichern</span> </button> <button type="button" id="cancelEdit" class="flex-1 py-4 rounded-xl font-bold bg-slate-700 hover:bg-slate-600 transition"> <span data-i18n="cancel">âŒ Abbrechen</span> </button>
     </div>
    </form>
   </div>
  </div>
  <script type="module">
        const { initializeApp, getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, setDoc, getDoc, query, orderBy } = window.firebaseModules;

        // ERSETZE DIESE WERTE MIT DEINER FIREBASE CONFIG:
        const firebaseConfig = {
  apiKey: "AIzaSyAYpUD2SFyviiHDJSKvei_TtCqnhsM2sBA",
  authDomain: "trading-journal-pro-8212f.firebaseapp.com",
  projectId: "trading-journal-pro-8212f",
  storageBucket: "trading-journal-pro-8212f.firebasestorage.app",
  messagingSenderId: "927047992152",
  appId: "1:927047992152:web:2269467aa95689e0955b2d",
  measurementId: "G-36WT75DLEL"
};

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let trades = [];
        let events = [];
        let transactions = [];
        let startCapitalData = null;
        let currentCalendarDate = new Date();
        let currentLang = localStorage.getItem('tradingJournalLang') || 'de';
        let currentTheme = localStorage.getItem('tradingJournalTheme') || 'dark';
        
        const charts = {};

        // Translations
        const translations = {
            de: {
                loginTitle: "Trading Journal Pro",
                loginSubtitle: "Professionelles Trade Management",
                emailLabel: "E-Mail Adresse",
                emailPlaceholder: "deine@email.de",
                passwordLabel: "Passwort",
                passwordLabelMin: "Passwort (min. 6 Zeichen)",
                loginButton: "ğŸ” Anmelden",
                registerButton: "âœ¨ Konto erstellen",
                showRegister: "Noch kein Konto? Jetzt registrieren â†’",
                showLogin: "   Bereits registriert? Jetzt anmelden",
                registerTitle: "Registrierung",
                registerSubtitle: "Erstelle dein Trading Journal",
                appTitle: "Trading Journal Pro",
                capital: "Kapital",
                logout: "ğŸšª Abmelden",
                navDashboard: "Dashboard",
                navNewTrade: "Neuer Trade",
                navHistory: "Historie",
                navPerformance: "Performance",
                navEmotions: "Emotionen",
                navCompound: "Zinseszins",
                navCalendar: "Kalender",
                navWithdrawals: "Auszahlungen",
                navDeposits: "Einzahlungen",
                navCalculator: "Rechner",
                startCapitalTitle: "Startkapital festlegen",
                startCapitalPlaceholder: "z.B. 10000",
                save: "ğŸ’¾ Speichern",
                startCapital: "Startkapital",
                currentCapital: "Aktuelles Kapital",
                totalPL: "Gesamt P/L",
                winRate: "Winrate",
                trades: "Trades",
                equityCurve: "Equity Curve",
                currentPerformanceTitle: "Deine aktuelle Performance",
                newTradeTitle: "Neuen Trade hinzufÃ¼gen",
                date: "Datum *",
                asset: "Asset",
                pleaseSelect: "-- Bitte wÃ¤hlen --",
                result: "Ergebnis",
                win: "Win",
                loss: "Loss",
                breakeven: "Break Even",
                profitLoss: "Profit/Loss (â‚¬)",
                position: "Position",
                strategy: "Strategie",
                strategyPlaceholder: "z.B. Breakout",
                emotion: "Emotion",
                none: "-- Keine --",
                notes: "Notizen",
                notesPlaceholder: "Details zum Trade, Setup, Fehler, Learnings...",
                saveTrade: "    Trade speichern",
                tradeHistory: "Trade Historie",
                allAssets: "Alle Assets",
                allResults: "Alle Ergebnisse",
                wins: "Wins",
                losses: "Loss",
                withdrawalTitle: "Auszahlung erfassen",
                amount: "Betrag (â‚¬)",
                amountPlaceholder: "z.B. 5000",
                noteOptional: "Notiz (optional)",
                withdrawalNotePlaceholder: "z.B. GewinnausschÃ¼ttung Q1",
                saveWithdrawal: "ğŸ’¸ Auszahlung speichern",
                withdrawalHistory: "Auszahlungs-Historie",
                depositTitle: "NachtrÃ¤gliche Einzahlung",
                depositAmountPlaceholder: "z.B. 10000",
                depositNotePlaceholder: "z.B. KapitalerhÃ¶hung",
                saveDeposit: "ğŸ’µ Einzahlung speichern",
                depositHistory: "Einzahlungs-Historie",
                bestTrade: "Bester Trade",
                worstTrade: "Schlechtester Trade",
                winStreak: "Win Streak",
                lossStreak: "Loss Streak",
                avgWin: "Ã˜ Gewinn",
                avgLoss: "Ã˜ Verlust",
                streakChart: "ğŸ“Š Gewinn/Verlust StrÃ¤hnen",
                distributionChart: "ğŸ¯ Gewinn/Verlust Verteilung",
                strategyChart: "ğŸ² Performance nach Strategie",
                monthlyChart: "ğŸ“… Monatliche Performance",
                assetChart: "ğŸ’± Performance nach Asset",
                currentPerfChart: "ğŸ¯ Deine aktuelle Performance",
                emotionAnalysis: "Emotions-Analyse",
                emotionPerformance: "ğŸ“Š Performance pro Emotion",
                compoundCalculator: "Zinseszins-Rechner",
                targetAmount: "Ziel Summe (â‚¬)",
                monthlyReturn: "Monatliche Rendite (%)",
                calculate: "ğŸ§® Berechnen",
                requiredMonthsTarget: "BenÃ¶tigte Monate (Ziel)",
                withDesiredReturn: "Mit gewÃ¼nschter Rendite",
                withCurrentPerformance: "Mit aktueller Performance",
                basedOnTrades: "Basierend auf deinen Trades",
                fasterThanPlanned: "Du bist schneller als geplant!",
                slowerThanPlanned: "Du brauchst lÃ¤nger als geplant",
                onTrack: "Perfekt auf Kurs!",
                monthsFaster: "Monate schneller",
                monthsSlower: "Monate lÃ¤nger",
                keepGoing: "Weiter so! Deine Performance Ã¼bertrifft das Ziel.",
                needImprovement: "Du musst deine Strategie optimieren.",
                exactlyOnTarget: "Deine Performance entspricht exakt dem Ziel!",
                calendar: "Kalender",
                today: "Heute",
                mon: "Mo",
                tue: "Di",
                wed: "Mi",
                thu: "Do",
                fri: "Fr",
                sat: "Sa",
                sun: "So",
                addEvent: "Termin hinzufÃ¼gen",
                eventTitlePlaceholder: "Termin Titel",
                eventDescriptionPlaceholder: "Beschreibung (optional)",
                saveEvent: "ğŸ“… Termin speichern",
                positionSizeCalculator: "PositionsgrÃ¶ÃŸen-Rechner",
                accountBalance: "Kontostand (â‚¬)",
                riskPerTrade: "Risiko pro Trade (%)",
                stopLoss: "Stop Loss (Pips)",
                pipValue: "Pip-Wert (â‚¬)",
                recommendedPosition: "Empfohlene PositionsgrÃ¶ÃŸe",
                pipCalculator: "Pip-Rechner",
                currencyPair: "WÃ¤hrungspaar",
                lotSize: "Lot-GrÃ¶ÃŸe",
                numberOfPips: "Anzahl Pips",
                convertTo: "Konvertierung nach",
                totalValue: "Gesamtwert",
                editTrade: "Trade bearbeiten",
                cancel: "âŒ Abbrechen"
            },
            en: {
                loginTitle: "Trading Journal Pro",
                loginSubtitle: "Professional Trade Management",
                emailLabel: "Email Address",
                emailPlaceholder: "your@email.com",
                passwordLabel: "Password",
                passwordLabelMin: "Password (min. 6 characters)",
                loginButton: "ğŸ” Login",
                registerButton: "âœ¨ Create Account",
                showRegister: "No account yet? Register now â†’",
                showLogin: "â† Already registered? Login now",
                registerTitle: "Registration",
                registerSubtitle: "Create your Trading Journal",
                appTitle: "Trading Journal Pro",
                capital: "Capital",
                logout: "ğŸšª Logout",
                navDashboard: "Dashboard",
                navNewTrade: "New Trade",
                navHistory: "History",
                navPerformance: "Performance",
                navEmotions: "Emotions",
                navCompound: "Compound",
                navCalendar: "Calendar",
                navWithdrawals: "Withdrawals",
                navDeposits: "Deposits",
                navCalculator: "Calculator",
                startCapitalTitle: "Set Starting Capital",
                startCapitalPlaceholder: "e.g. 10000",
                save: "ğŸ’¾ Save",
                startCapital: "Starting Capital",
                currentCapital: "Current Capital",
                totalPL: "Total P/L",
                winRate: "Win Rate",
                trades: "Trades",
                equityCurve: "Equity Curve",
                currentPerformanceTitle: "Your Current Performance",
                newTradeTitle: "Add New Trade",
                date: "Date *",
                asset: "Asset",
                pleaseSelect: "-- Please Select --",
                result: "Result",
                win: "Win",
                loss: "Loss",
                breakeven: "Break Even",
                profitLoss: "Profit/Loss (â‚¬)",
                position: "Position",
                strategy: "Strategy",
                strategyPlaceholder: "e.g. Breakout",
                emotion: "Emotion",
                none: "-- None --",
                notes: "Notes",
                notesPlaceholder: "Trade details, setup, mistakes, learnings...",
                saveTrade: "ğŸ’¾ Save Trade",
                tradeHistory: "Trade History",
                allAssets: "All Assets",
                allResults: "All Results",
                wins: "Wins",
                losses: "Losses",
                withdrawalTitle: "Record Withdrawal",
                amount: "Amount (â‚¬)",
                amountPlaceholder: "e.g. 5000",
                noteOptional: "Note (optional)",
                withdrawalNotePlaceholder: "e.g. Q1 Profit Distribution",
                saveWithdrawal: "ğŸ’¸ Save Withdrawal",
                withdrawalHistory: "Withdrawal History",
                depositTitle: "Additional Deposit",
                depositAmountPlaceholder: "e.g. 10000",
                depositNotePlaceholder: "e.g. Capital Increase",
                saveDeposit: "ğŸ’µ Save Deposit",
                depositHistory: "Deposit History",
                bestTrade: "Best Trade",
                worstTrade: "Worst Trade",
                winStreak: "Win Streak",
                lossStreak: "Loss Streak",
                avgWin: "Avg Win",
                avgLoss: "Avg Loss",
                streakChart: "ğŸ“Š Win/Loss Streaks",
                distributionChart: "ğŸ¯ Win/Loss Distribution",
                strategyChart: "ğŸ² Performance by Strategy",
                monthlyChart: "ğŸ“… Monthly Performance",
                assetChart: "ğŸ’± Performance by Asset",
                currentPerfChart: "ğŸ¯ Your Current Performance",
                emotionAnalysis: "Emotion Analysis",
                emotionPerformance: "ğŸ“Š Performance per Emotion",
                compoundCalculator: "Compound Calculator",
                targetAmount: "Target Amount (â‚¬)",
                monthlyReturn: "Monthly Return (%)",
                calculate: "ğŸ§® Calculate",
                requiredMonthsTarget: "Required Months (Target)",
                withDesiredReturn: "With desired return",
                withCurrentPerformance: "With Current Performance",
                basedOnTrades: "Based on your trades",
                fasterThanPlanned: "You're faster than planned!",
                slowerThanPlanned: "You need more time than planned",
                onTrack: "Perfectly on track!",
                monthsFaster: "months faster",
                monthsSlower: "months longer",
                keepGoing: "Keep it up! Your performance exceeds the target.",
                needImprovement: "You need to optimize your strategy.",
                exactlyOnTarget: "Your performance matches the target exactly!",
                calendar: "Calendar",
                today: "Today",
                mon: "Mon",
                tue: "Tue",
                wed: "Wed",
                thu: "Thu",
                fri: "Fri",
                sat: "Sat",
                sun: "Sun",
                addEvent: "Add Event",
                eventTitlePlaceholder: "Event Title",
                eventDescriptionPlaceholder: "Description (optional)",
                saveEvent: "ğŸ“… Save Event",
                positionSizeCalculator: "Position Size Calculator",
                accountBalance: "Account Balance (â‚¬)",
                riskPerTrade: "Risk per Trade (%)",
                stopLoss: "Stop Loss (Pips)",
                pipValue: "Pip Value (â‚¬)",
                recommendedPosition: "Recommended Position Size",
                pipCalculator: "Pip Calculator",
                currencyPair: "Currency Pair",
                lotSize: "Lot Size",
                numberOfPips: "Number of Pips",
                convertTo: "Convert to",
                totalValue: "Total Value",
                editTrade: "Edit Trade",
                cancel: "âŒ Cancel"
            },
            es: {
                loginTitle: "Trading Journal Pro",
                loginSubtitle: "GestiÃ³n Profesional de Trading",
                emailLabel: "Correo ElectrÃ³nico",
                emailPlaceholder: "tu@email.com",
                passwordLabel: "ContraseÃ±a",
                passwordLabelMin: "ContraseÃ±a (mÃ­n. 6 caracteres)",
                loginButton: "ğŸ” Iniciar SesiÃ³n",
                registerButton: "âœ¨ Crear Cuenta",
                showRegister: "Â¿No tienes cuenta? RegÃ­strate ahora â†’",
                showLogin: "â† Â¿Ya registrado? Inicia sesiÃ³n",
                registerTitle: "Registro",
                registerSubtitle: "Crea tu Diario de Trading",
                appTitle: "Trading Journal Pro",
                capital: "Capital",
                logout: "ğŸšª Cerrar SesiÃ³n",
                navDashboard: "Panel",
                navNewTrade: "Nuevo Trade",
                navHistory: "Historial",
                navPerformance: "Rendimiento",
                navEmotions: "Emociones",
                navCompound: "InterÃ©s Compuesto",
                navCalendar: "Calendario",
                navWithdrawals: "Retiros",
                navDeposits: "DepÃ³sitos",
                navCalculator: "Calculadora",
                startCapitalTitle: "Establecer Capital Inicial",
                startCapitalPlaceholder: "ej. 10000",
                save: "ğŸ’¾ Guardar",
                startCapital: "Capital Inicial",
                currentCapital: "Capital Actual",
                totalPL: "P/L Total",
                winRate: "Tasa de Ã‰xito",
                trades: "Operaciones",
                equityCurve: "Curva de Capital",
                currentPerformanceTitle: "Tu Rendimiento Actual",
                newTradeTitle: "Agregar Nuevo Trade",
                date: "Fecha *",
                asset: "Activo",
                pleaseSelect: "-- Por favor selecciona --",
                result: "Resultado",
                win: "Ganancia",
                loss: "PÃ©rdida",
                breakeven: "Punto Muerto",
                profitLoss: "Ganancia/PÃ©rdida (â‚¬)",
                position: "PosiciÃ³n",
                strategy: "Estrategia",
                strategyPlaceholder: "ej. Breakout",
                emotion: "EmociÃ³n",
                none: "-- Ninguna --",
                notes: "Notas",
                notesPlaceholder: "Detalles del trade, configuraciÃ³n, errores, aprendizajes...",
                saveTrade: "ğŸ’¾ Guardar Trade",
                tradeHistory: "Historial de Trades",
                allAssets: "Todos los Activos",
                allResults: "Todos los Resultados",
                wins: "Ganancias",
                losses: "PÃ©rdidas",
                withdrawalTitle: "Registrar Retiro",
                amount: "Monto (â‚¬)",
                amountPlaceholder: "ej. 5000",
                noteOptional: "Nota (opcional)",
                withdrawalNotePlaceholder: "ej. DistribuciÃ³n de ganancias Q1",
                saveWithdrawal: "ğŸ’¸ Guardar Retiro",
                withdrawalHistory: "Historial de Retiros",
                depositTitle: "DepÃ³sito Adicional",
                depositAmountPlaceholder: "ej. 10000",
                depositNotePlaceholder: "ej. Aumento de capital",
                saveDeposit: "ğŸ’µ Guardar DepÃ³sito",
                depositHistory: "Historial de DepÃ³sitos",
                bestTrade: "Mejor Trade",
                worstTrade: "Peor Trade",
                winStreak: "Racha Ganadora",
                lossStreak: "Racha Perdedora",
                avgWin: "Ganancia Promedio",
                avgLoss: "PÃ©rdida Promedio",
                streakChart: "ğŸ“Š Rachas de Ganancia/PÃ©rdida",
                distributionChart: "ğŸ¯ DistribuciÃ³n Ganancia/PÃ©rdida",
                strategyChart: "ğŸ² Rendimiento por Estrategia",
                monthlyChart: "ğŸ“… Rendimiento Mensual",
                assetChart: "ğŸ’± Rendimiento por Activo",
                currentPerfChart: "ğŸ¯ Tu Rendimiento Actual",
                emotionAnalysis: "AnÃ¡lisis de Emociones",
                emotionPerformance: "ğŸ“Š Rendimiento por EmociÃ³n",
                compoundCalculator: "Calculadora de InterÃ©s Compuesto",
                targetAmount: "Monto Objetivo (â‚¬)",
                monthlyReturn: "Retorno Mensual (%)",
                calculate: "ğŸ§® Calcular",
                requiredMonthsTarget: "Meses Necesarios (Objetivo)",
                withDesiredReturn: "Con retorno deseado",
                withCurrentPerformance: "Con Rendimiento Actual",
                basedOnTrades: "Basado en tus trades",
                fasterThanPlanned: "Â¡Eres mÃ¡s rÃ¡pido de lo planeado!",
                slowerThanPlanned: "Necesitas mÃ¡s tiempo del planeado",
                onTrack: "Â¡Perfectamente en camino!",
                monthsFaster: "meses mÃ¡s rÃ¡pido",
                monthsSlower: "meses mÃ¡s",
                keepGoing: "  Sigue asÃ­! Tu rendimiento supera el objetivo.",
                needImprovement: "Necesitas optimizar tu estrategia.",
                exactlyOnTarget: "Â¡Tu rendimiento coincide exactamente con el objetivo!",
                calendar: "Calendario",
                today: "Hoy",
                mon: "Lun",
                tue: "Mar",
                wed: "MiÃ©",
                thu: "Jue",
                fri: "Vie",
                sat: "SÃ¡b",
                sun: "Dom",
                addEvent: "Agregar Evento",
                eventTitlePlaceholder: "TÃ­tulo del Evento",
                eventDescriptionPlaceholder: "DescripciÃ³n (opcional)",
                saveEvent: "ğŸ“… Guardar Evento",
                positionSizeCalculator: "Calculadora de TamaÃ±o de PosiciÃ³n",
                accountBalance: "Balance de Cuenta (â‚¬)",
                riskPerTrade: "Riesgo por OperaciÃ³n (%)",
                stopLoss: "Stop Loss (Pips)",
                pipValue: "Valor del Pip (â‚¬)",
                recommendedPosition: "TamaÃ±o de PosiciÃ³n Recomendado",
                pipCalculator: "Calculadora de Pips",
                currencyPair: "Par de Divisas",
                lotSize: "TamaÃ±o del Lote",
                numberOfPips: "NÃºmero de Pips",
                convertTo: "Convertir a",
                totalValue: "Valor Total",
                editTrade: "Editar Trade",
                cancel: "âŒ Cancelar"
            }
        };

        function t(key) {
            return translations[currentLang][key] || key;
        }

        function updateLanguage() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                el.textContent = t(key);
            });

            document.querySelectorAll('[data-i18n-placeholder]').forEach(el => {
                const key = el.getAttribute('data-i18n-placeholder');
                el.placeholder = t(key);
            });

            localStorage.setItem('tradingJournalLang', currentLang);
        }

        function updateTheme() {
            if (currentTheme === 'light') {
                document.body.classList.add('light-mode');
                document.getElementById('themeIconLogin').textContent = 'â˜€ï¸';
                document.getElementById('themeIconRegister').textContent = 'â˜€ï¸';
                document.getElementById('themeIconMain').textContent = 'â˜€ï¸';
            } else {
                document.body.classList.remove('light-mode');
                document.getElementById('themeIconLogin').textContent = 'ğŸŒ™';
                document.getElementById('themeIconRegister').textContent = 'ğŸŒ™';
                document.getElementById('themeIconMain').textContent = 'ğŸŒ™';
            }
            localStorage.setItem('tradingJournalTheme', currentTheme);
        }

        // Language switcher
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const lang = btn.dataset.lang;
                currentLang = lang;
                
                document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll(`[data-lang="${lang}"]`).forEach(b => b.classList.add('active'));
                
                updateLanguage();
            });
        });

        // Theme toggle
        document.getElementById('themeToggleLogin').addEventListener('click', () => {
            currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
            updateTheme();
        });

        document.getElementById('themeToggleRegister').addEventListener('click', () => {
            currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
            updateTheme();
        });

        document.getElementById('themeToggleMain').addEventListener('click', () => {
            currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
            updateTheme();
        });

        // Initialize theme and language
        updateTheme();
        updateLanguage();
        document.querySelectorAll(`[data-lang="${currentLang}"]`).forEach(b => b.classList.add('active'));

        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = 'position:fixed;bottom:32px;right:32px;background:rgba(0,0,0,0.9);color:white;padding:16px 24px;border-radius:12px;z-index:10000;box-shadow:0 4px 12px rgba(0,0,0,0.5);';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function formatCurrency(value) {
            return '   ' + value.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString(currentLang === 'de' ? 'de-DE' : currentLang === 'en' ? 'en-US' : 'es-ES', { day: '2-digit', month: '2-digit', year: 'numeric' });
        }

        async function loadAllData() {
            if (!currentUser) return;

            try {
                const [tradesSnap, eventsSnap, transactionsSnap, settingsDoc] = await Promise.all([
                    getDocs(query(collection(db, 'users', currentUser.uid, 'trades'), orderBy('date', 'desc'))),
                    getDocs(collection(db, 'users', currentUser.uid, 'events')),
                    getDocs(query(collection(db, 'users', currentUser.uid, 'transactions'), orderBy('date', 'desc'))),
                    getDoc(doc(db, 'users', currentUser.uid, 'settings', 'capital'))
                ]);

                trades = tradesSnap.docs.map(d => ({ id: d.id, ...d.data() }));
                events = eventsSnap.docs.map(d => ({ id: d.id, ...d.data() }));
                transactions = transactionsSnap.docs.map(d => ({ id: d.id, ...d.data() }));

                if (settingsDoc.exists()) {
                    startCapitalData = settingsDoc.data();
                }

                updateDashboard();
                renderHistory();
                renderTransactions();
                renderPerformance();
                renderEmotions();
                renderCalendar();
                updateAssetFilter();

            } catch (error) {
                console.error('Fehler beim Laden:', error);
                showToast('âŒ Fehler beim Laden der Daten');
            }
        }

        function updateDashboard() {
            const startCapital = startCapitalData?.startCapital || 0;
            let currentCapital = startCapital;

            // Berechne mit Trades
            trades.forEach(t => {
                currentCapital += (t.profitLoss || 0);
            });

            // BerÃ¼cksichtige Transaktionen
            transactions.forEach(t => {
                if (t.type === 'withdrawal') {
                    currentCapital -= t.amount;
                } else if (t.type === 'deposit') {
                    currentCapital += t.amount;
                }
            });

            if (startCapital > 0) {
                document.getElementById('startCapitalDisplay').classList.remove('hidden');
                document.getElementById('startCapitalValue').textContent = formatCurrency(startCapital);
                document.getElementById('startCapital').value = startCapital;
            }

            const totalPL = trades.reduce((sum, t) => sum + (t.profitLoss || 0), 0);

            document.getElementById('headerCapital').textContent = formatCurrency(currentCapital);
            document.getElementById('currentCapital').textContent = formatCurrency(currentCapital);
            document.getElementById('totalPL').textContent = formatCurrency(totalPL);
            document.getElementById('totalPL').className = totalPL >= 0 ? 'text-3xl font-bold text-green-400' : 'text-3xl font-bold text-red-400';
            document.getElementById('totalTrades').textContent = trades.length;

            const wins = trades.filter(t => t.result === 'win').length;
            const losses = trades.filter(t => t.result === 'loss').length;
            const breakeven = trades.filter(t => t.result === 'breakeven').length;
            const totalTrades = wins + losses + breakeven;
            const winRate = totalTrades > 0 ? (wins / totalTrades * 100) : 0;
            document.getElementById('winRate').textContent = winRate.toFixed(1) + '%';

            // Equity Curve
            const canvas = document.getElementById('dashboardEquityChart');
            if (canvas) {
                const sortedTrades = [...trades].sort((a, b) => new Date(a.date) - new Date(b.date));
                const equityData = [startCapital];
                const labels = ['Start'];

                let runningCapital = startCapital;
                sortedTrades.forEach(t => {
                    runningCapital += (t.profitLoss || 0);
                    equityData.push(runningCapital);
                    labels.push(formatDate(t.date));
                });

                // Transaktionen einbeziehen
                transactions.forEach(trans => {
                    if (trans.type === 'withdrawal') {
                        runningCapital -= trans.amount;
                    } else {
                        runningCapital += trans.amount;
                    }
                });

                if (charts.dashboardEquity) {
                    charts.dashboardEquity.destroy();
                }

                const ctx = canvas.getContext('2d');
                charts.dashboardEquity = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: t('capital'),
                            data: equityData,
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { labels: { color: currentTheme === 'light' ? '#1e293b' : '#ffffff', font: { size: 14, weight: 'bold' } } }
                        },
                        scales: {
                            x: { ticks: { color: currentTheme === 'light' ? '#64748b' : '#9ca3af' }, grid: { color: currentTheme === 'light' ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.1)' } },
                            y: { ticks: { color: currentTheme === 'light' ? '#64748b' : '#9ca3af', callback: (v) => 'â‚¬' + v.toFixed(0) }, grid: { color: currentTheme === 'light' ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.1)' } }
                        }
                    }
                });
            }

            // Aktuelle Performance
            const perfGrid = document.getElementById('currentPerformanceGrid');
            if (perfGrid) {
                const profitLosses = trades.map(t => t.profitLoss || 0);
                const best = profitLosses.length > 0 ? Math.max(...profitLosses) : 0;
                const worst = profitLosses.length > 0 ? Math.min(...profitLosses) : 0;
                const avg = profitLosses.length > 0 ? profitLosses.reduce((a, b) => a + b, 0) / profitLosses.length : 0;

                perfGrid.innerHTML = `
                    <div class="bg-slate-800 rounded-xl p-6">
                        <div class="text-sm text-gray-400 mb-2">${t('bestTrade')}</div>
                        <div class="text-2xl font-bold text-green-400">${formatCurrency(best)}</div>
                    </div>
                    <div class="bg-slate-800 rounded-xl p-6">
                        <div class="text-sm text-gray-400 mb-2">${t('worstTrade')}</div>
                        <div class="text-2xl font-bold text-red-400">${formatCurrency(worst)}</div>
                    </div>
                    <div class="bg-slate-800 rounded-xl p-6">
                        <div class="text-sm text-gray-400 mb-2">Ã˜ Trade</div>
                        <div class="text-2xl font-bold ${avg >= 0 ? 'text-green-400' : 'text-red-400'}">${formatCurrency(avg)}</div>
                    </div>
                    <div class="bg-slate-800 rounded-xl p-6">
                        <div class="text-sm text-gray-400 mb-2">Total ${t('trades')}</div>
                        <div class="text-2xl font-bold text-purple-400">${trades.length}</div>
                    </div>
                `;
            }

            // Update calculator balance
            if (document.getElementById('psBalance')) {
                document.getElementById('psBalance').value = currentCapital.toFixed(2);
            }
        }

        function updateAssetFilter() {
            const filter = document.getElementById('filterAsset');
            if (!filter) return;

            const assets = [...new Set(trades.map(t => t.asset).filter(a => a))];
            filter.innerHTML = `<option value="all">${t('allAssets')}</option>`;
            assets.forEach(asset => {
                const opt = document.createElement('option');
                opt.value = asset;
                opt.textContent = asset;
                filter.appendChild(opt);
            });
        }

        function renderHistory() {
            const assetFilter = document.getElementById('filterAsset')?.value || 'all';
            const resultFilter = document.getElementById('filterResult')?.value || 'all';

            let filtered = trades;

            if (assetFilter !== 'all') {
                filtered = filtered.filter(t => t.asset === assetFilter);
            }

            if (resultFilter !== 'all') {
                filtered = filtered.filter(t => t.result === resultFilter);
            }

            const container = document.getElementById('tradeHistoryList');
            if (!container) return;

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-20">
                        <div class="text-6xl mb-4">ğŸ“œ</div>
                        <p class="text-gray-400 text-lg">Keine Trades gefunden</p>
                    </div>
                `;
                return;
            }

            let html = '';
            filtered.forEach(trade => {
                const plValue = trade.profitLoss || 0;
                const plColor = plValue > 0 ? 'text-green-400' : plValue < 0 ? 'text-red-400' : 'text-yellow-400';
                const resultBadge = trade.result === 'win' ? 'bg-green-500' : trade.result === 'loss' ? 'bg-red-500' : 'bg-yellow-500';
                const positionBadge = trade.position === 'Long' ? 'bg-blue-500' : 'bg-orange-500';

                html += `
                    <div class="glass-card rounded-xl p-6 hover:scale-[1.02] transition">
                        <div class="flex justify-between items-start mb-3 flex-wrap gap-3">
                            <div>
                                <div class="flex items-center gap-3 mb-2 flex-wrap">
                                    <span class="text-2xl font-bold">${trade.asset || 'N/A'}</span>
                                    <span class="text-xs font-bold px-3 py-1 rounded-full ${resultBadge}">${trade.result?.toUpperCase() || 'N/A'}</span>
                                    <span class="text-xs font-bold px-3 py-1 rounded-full ${positionBadge}">${trade.position || 'N/A'}</span>
                                    ${trade.emotion ? `<span class="emotion-badge bg-purple-500">${trade.emotion}</span>` : ''}
                                </div>
                                <div class="text-sm text-gray-400">${formatDate(trade.date)}</div>
                                ${trade.strategy ? `<div class="text-sm text-gray-300 mt-1">ğŸ“Š ${trade.strategy}</div>` : ''}
                            </div>
                            <div class="text-3xl font-bold ${plColor}">
                                ${formatCurrency(plValue)}
                            </div>
                        </div>
                        ${trade.notes ? `<div class="text-sm text-gray-300 mt-3 p-3 bg-slate-800 rounded-lg">${trade.notes}</div>` : ''}
                        <div class="flex gap-3 mt-4">
                            <button onclick="editTrade('${trade.id}')" class="flex-1 bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg text-sm font-bold transition">
                                âœï¸ ${t('editTrade')}
                            </button>
                            <button onclick="deleteTrade('${trade.id}')" class="flex-1 bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg text-sm font-bold transition">
                                ğŸ—‘ï¸ LÃ¶schen
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function renderTransactions() {
            const withdrawals = transactions.filter(t => t.type === 'withdrawal');
            const deposits = transactions.filter(t => t.type === 'deposit');

            // Render Withdrawals
            const withdrawalsList = document.getElementById('withdrawalsList');
            if (withdrawalsList) {
                if (withdrawals.length === 0) {
                    withdrawalsList.innerHTML = `
                        <div class="text-center py-20">
                            <div class="text-6xl mb-4">ğŸ’¸</div>
                            <p class="text-gray-400 text-lg">Noch keine Auszahlungen</p>
                        </div>
                    `;
                } else {
                    let html = '';
                    withdrawals.forEach(withdrawal => {
                        html += `
                            <div class="glass-card rounded-xl p-6 hover:scale-[1.02] transition">
                                <div class="flex justify-between items-center flex-wrap gap-3">
                                    <div>
                                        <div class="text-sm text-gray-400">${formatDate(withdrawal.date)}</div>
                                        ${withdrawal.note ? `<div class="text-sm text-gray-300 mt-2">${withdrawal.note}</div>` : ''}
                                    </div>
                                    <div class="text-3xl font-bold text-red-400">
                                        -${formatCurrency(withdrawal.amount)}
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <button onclick="deleteTransaction('${withdrawal.id}')" class="w-full bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg text-sm font-bold transition">
                                        ğŸ—‘ï¸ LÃ¶schen
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    withdrawalsList.innerHTML = html;
                }
            }

            // Render Deposits
            const depositsList = document.getElementById('depositsList');
            if (depositsList) {
                if (deposits.length === 0) {
                    depositsList.innerHTML = `
                        <div class="text-center py-20">
                            <div class="text-6xl mb-4">ğŸ’µ</div>
                            <p class="text-gray-400 text-lg">Noch keine Einzahlungen</p>
                        </div>
                    `;
                } else {
                    let html = '';
                    deposits.forEach(deposit => {
                        html += `
                            <div class="glass-card rounded-xl p-6 hover:scale-[1.02] transition">
                                <div class="flex justify-between items-center flex-wrap gap-3">
                                    <div>
                                        <div class="text-sm text-gray-400">${formatDate(deposit.date)}</div>
                                        ${deposit.note ? `<div class="text-sm text-gray-300 mt-2">${deposit.note}</div>` : ''}
                                    </div>
                                    <div class="text-3xl font-bold text-green-400">
                                        +${formatCurrency(deposit.amount)}
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <button onclick="deleteTransaction('${deposit.id}')" class="w-full bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg text-sm font-bold transition">
                                        ğŸ—‘ï¸ LÃ¶schen
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    depositsList.innerHTML = html;
                }
            }
        }

        function renderPerformance() {
            const profitLosses = trades.map(t => t.profitLoss || 0);
            const best = profitLosses.length > 0 ? Math.max(...profitLosses) : 0;
            const worst = profitLosses.length > 0 ? Math.min(...profitLosses) : 0;

            document.getElementById('perfBestTrade').textContent = formatCurrency(best);
            document.getElementById('perfWorstTrade').textContent = formatCurrency(worst);

            // Win/Loss Streaks - Berechnung aus der chronologischen Historie
            const sortedTrades = [...trades].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            let currentStreak = 0;
            let currentStreakType = null;
            let maxWinStreak = 0;
            let maxLossStreak = 0;
            let streaks = [];

            sortedTrades.forEach(t => {
                const isWin = (t.profitLoss || 0) > 0;
                const isLoss = (t.profitLoss || 0) < 0;
                
                if (isWin) {
                    if (currentStreakType === 'win') {
                        currentStreak++;
                    } else {
                        if (currentStreak !== 0) {
                            streaks.push(currentStreak);
                        }
                        currentStreak = 1;
                        currentStreakType = 'win';
                    }
                    maxWinStreak = Math.max(maxWinStreak, currentStreak);
                } else if (isLoss) {
                    if (currentStreakType === 'loss') {
                        currentStreak--;
                    } else {
                        if (currentStreak !== 0) {
                            streaks.push(currentStreak);
                        }
                        currentStreak = -1;
                        currentStreakType = 'loss';
                    }
                    maxLossStreak = Math.max(maxLossStreak, Math.abs(currentStreak));
                }
                // Break-even ignorieren fÃ¼r Streaks
            });
            
            // Letzten Streak hinzufÃ¼gen
            if (currentStreak !== 0) {
                streaks.push(currentStreak);
            }

            document.getElementById('perfWinStreak').textContent = maxWinStreak;
            document.getElementById('perfLossStreak').textContent = maxLossStreak;

            // Avg Win/Loss - Berechnung aus tatsÃ¤chlichen Trades
            const winTrades = trades.filter(t => (t.profitLoss || 0) > 0);
            const lossTrades = trades.filter(t => (t.profitLoss || 0) < 0);
            
            const avgWin = winTrades.length > 0 ? winTrades.reduce((sum, t) => sum + (t.profitLoss || 0), 0) / winTrades.length : 0;
            const avgLoss = lossTrades.length > 0 ? Math.abs(lossTrades.reduce((sum, t) => sum + (t.profitLoss || 0), 0) / lossTrades.length) : 0;

            document.getElementById('perfAvgWin').textContent = formatCurrency(avgWin);
            document.getElementById('perfAvgLoss').textContent = formatCurrency(avgLoss);

            // Streak Chart
            if (charts.streak) charts.streak.destroy();
            const streakCanvas = document.getElementById('streakChart');
            if (streakCanvas) {
                charts.streak = new Chart(streakCanvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: streaks.map((_, i) => `StrÃ¤hne ${i + 1}`),
                        datasets: [{
                            label: t('streakChart'),
                            data: streaks,
                            backgroundColor: streaks.map(s => s > 0 ? 'rgba(34, 197, 94, 0.8)' : 'rgba(239, 68, 68, 0.8)')
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: currentTheme === 'light' ? '#1e293b' : '#ffffff' } } },
                        scales: {
                            x: { ticks: { color: currentTheme === 'light' ? '#64748b' : '#9ca3af' }, grid: { color: currentTheme === 'light' ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.1)' } },
                            y: { ticks: { color: currentTheme === 'light' ? '#64748b' : '#9ca3af' }, grid: { color: currentTheme === 'light' ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.1)' } }
                        }
                    }
                });
            }

            // Distribution Chart
            if (charts.distribution) charts.distribution.destroy();
            const distCanvas = document.getElementById('distributionChart');
            if (distCanvas) {
                const winCount = wins.length;
                const lossCount = losses.length;
                const beCount = trades.filter(t => t.result === 'breakeven').length;

                charts.distribution = new Chart(distCanvas.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: [t('wins'), t('losses'), t('breakeven')],
                        datasets: [{
                            data: [winCount, lossCount, beCount],
                            backgroundColor: ['rgba(34, 197, 94, 0.8)', 'rgba(239, 68, 68, 0.8)', 'rgba(234, 179, 8, 0.8)']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: currentTheme === 'light' ? '#1e293b' : '#ffffff' } } }
                    }
                });
            }

            // Strategy Chart
            if (charts.strategy) charts.strategy.destroy();
            const strategyCanvas = document.getElementById('strategyChart');
            if (strategyCanvas) {
                const strategyPerf = {};
                trades.forEach(t => {
                    const strat = t.strategy || 'Keine Strategie';
                    if (!strategyPerf[strat]) strategyPerf[strat] = 0;
                    strategyPerf[strat] += (t.profitLoss || 0);
                });

                charts.strategy = new Chart(strategyCanvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(strategyPerf),
                        datasets: [{
                            label: 'P/L ' + t('strategy'),
                            data: Object.values(strategyPerf),
                            backgroundColor: Object.values(strategyPerf).map(v => v >= 0 ? 'rgba(139, 92, 246, 0.8)' : 'rgba(239, 68, 68, 0.8)')
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: currentTheme === 'light' ? '#1e293b' : '#ffffff' } } },
                        scales: {
                            x: { ticks: { color: currentTheme === 'light' ? '#64748b' : '#9ca3af' }, grid: { color: currentTheme === 'light' ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.1)' } },
                            y: { ticks: { color: currentTheme === 'light' ? '#64748b' : '#9ca3af', callback: (v) => 'â‚¬' + v }, grid: { color: currentTheme === 'light' ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.1)' } }
                        }
                    }
                });
            }

            // Monthly Chart
            if (charts.monthly) charts.monthly.destroy();
            const monthlyCanvas = document.getElementById('monthlyChart');
            if (monthlyCanvas) {
                const monthlyPerf = {};
                trades.forEach(t => {
                    const date = new Date(t.date);
                    const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                    if (!monthlyPerf[key]) monthlyPerf[key] = 0;
                    monthlyPerf[key] += (t.profitLoss || 0);
                });

                charts.monthly = new Chart(monthlyCanvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(monthlyPerf).sort(),
                        datasets: [{
                            label: t('monthlyChart'),
                            data: Object.keys(monthlyPerf).sort().map(k => monthlyPerf[k]),
                            backgroundColor: Object.keys(monthlyPerf).sort().map(k => monthlyPerf[k] >= 0 ? 'rgba(34, 197, 94, 0.8)' : 'rgba(239, 68, 68, 0.8)')
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: currentTheme === 'light' ? '#1e293b' : '#ffffff' } } },
                        scales: {
                            x: { ticks: { color: currentTheme === 'light' ? '#64748b' : '#9ca3af' }, grid: { color: currentTheme === 'light' ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.1)' } },
                            y: { ticks: { color: currentTheme === 'light' ? '#64748b' : '#9ca3af', callback: (v) => 'â‚¬' + v }, grid: { color: currentTheme === 'light' ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.1)' } }
                        }
                    }
                });
            }

            // Asset Chart
            if (charts.asset) charts.asset.destroy();
            const assetCanvas = document.getElementById('assetChart');
            if (assetCanvas) {
                const assetPerf = {};
                trades.forEach(t => {
                    const asset = t.asset || 'Unbekannt';
                    if (!assetPerf[asset]) assetPerf[asset] = 0;
                    assetPerf[asset] += (t.profitLoss || 0);
                });

                charts.asset = new Chart(assetCanvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(assetPerf),
                        datasets: [{
                            label: 'P/L ' + t('asset'),
                            data: Object.values(assetPerf),
                            backgroundColor: 'rgba(99, 102, 241, 0.8)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: currentTheme === 'light' ? '#1e293b' : '#ffffff' } } },
                        scales: {
                            x: { ticks: { color: currentTheme === 'light' ? '#64748b' : '#9ca3af' }, grid: { color: currentTheme === 'light' ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.1)' } },
                            y: { ticks: { color: currentTheme === 'light' ? '#64748b' : '#9ca3af', callback: (v) => 'â‚¬' + v }, grid: { color: currentTheme === 'light' ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.1)' } }
                        }
                    }
                });
            }

            // Current Performance Chart
            if (charts.currentPerf) charts.currentPerf.destroy();
            const currentPerfCanvas = document.getElementById('currentPerfChart');
            if (currentPerfCanvas) {
                const last10 = trades.slice(0, 10).reverse();
                charts.currentPerf = new Chart(currentPerfCanvas.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: last10.map((t, i) => `Trade ${i + 1}`),
                        datasets: [{
                            label: 'Letzte 10 Trades',
                            data: last10.map(t => t.profitLoss || 0),
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: currentTheme === 'light' ? '#1e293b' : '#ffffff' } } },
                        scales: {
                            x: { ticks: { color: currentTheme === 'light' ? '#64748b' : '#9ca3af' }, grid: { color: currentTheme === 'light' ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.1)' } },
                            y: { ticks: { color: currentTheme === 'light' ? '#64748b' : '#9ca3af', callback: (v) => 'â‚¬' + v }, grid: { color: currentTheme === 'light' ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.1)' } }
                        }
                    }
                });
            }
        }

        function renderEmotions() {
            const emotionCounts = {};
            const emotionPL = {};

            trades.forEach(t => {
                if (t.emotion) {
                    emotionCounts[t.emotion] = (emotionCounts[t.emotion] || 0) + 1;
                    emotionPL[t.emotion] = (emotionPL[t.emotion] || 0) + (t.profitLoss || 0);
                }
            });

            // Emotion Chart
            if (charts.emotion) charts.emotion.destroy();
            const emotionCanvas = document.getElementById('emotionChart');
            if (emotionCanvas) {
                charts.emotion = new Chart(emotionCanvas.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(emotionCounts),
                        datasets: [{
                            data: Object.values(emotionCounts),
                            backgroundColor: [
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(139, 92, 246, 0.8)',
                                'rgba(234, 179, 8, 0.8)',
                                'rgba(249, 115, 22, 0.8)',
                                'rgba(239, 68, 68, 0.8)',
                                'rgba(236, 72, 153, 0.8)',
                                'rgba(20, 184, 166, 0.8)',
                                'rgba(251, 146, 60, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: currentTheme === 'light' ? '#1e293b' : '#ffffff' } } }
                    }
                });
            }

            // Emotion Stats
            const emotionStats = document.getElementById('emotionStats');
            if (emotionStats) {
                let html = '<div class="text-xl font-bold mb-4">HÃ¤ufigste Emotionen</div>';
                Object.entries(emotionCounts).sort((a, b) => b[1] - a[1]).slice(0, 5).forEach(([emotion, count]) => {
                    html += `
                        <div class="flex justify-between items-center p-3 bg-slate-800 rounded-lg">
                            <span class="font-bold">${emotion}</span>
                            <span class="text-purple-400 font-bold">${count}x</span>
                        </div>
                    `;
                });
                emotionStats.innerHTML = html;
            }

            // Performance pro Emotion
            const emotionPerfList = document.getElementById('emotionPerformanceList');
            if (emotionPerfList) {
                let html = '';
                Object.entries(emotionPL).sort((a, b) => b[1] - a[1]).forEach(([emotion, pl]) => {
                    const color = pl >= 0 ? 'text-green-400' : 'text-red-400';
                    html += `
                        <div class="flex justify-between items-center p-3 bg-slate-800 rounded-lg">
                            <span class="font-bold">${emotion}</span>
                            <span class="font-bold ${color}">${formatCurrency(pl)}</span>
                        </div>
                    `;
                });
                emotionPerfList.innerHTML = html || '<div class="text-center text-gray-400 py-8">Keine Emotionsdaten</div>';
            }
        }

        function renderCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();

            document.getElementById('calendarMonth').textContent = new Date(year, month).toLocaleDateString(currentLang === 'de' ? 'de-DE' : currentLang === 'en' ? 'en-US' : 'es-ES', { month: 'long', year: 'numeric' });

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            // Empty cells
            const startDay = firstDay === 0 ? 6 : firstDay - 1;
            for (let i = 0; i < startDay; i++) {
                const cell = document.createElement('div');
                cell.className = 'p-2 bg-slate-800 rounded-lg opacity-50';
                grid.appendChild(cell);
            }

            // Days
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayTrades = trades.filter(t => t.date === dateStr);
                const dayEvents = events.filter(e => e.date === dateStr);

                const cell = document.createElement('div');
                cell.className = 'p-2 bg-slate-800 rounded-lg hover:bg-slate-700 cursor-pointer transition min-h-[80px]';

                let content = `<div class="font-bold mb-1">${day}</div>`;

                if (dayTrades.length > 0) {
                    const totalPL = dayTrades.reduce((sum, t) => sum + (t.profitLoss || 0), 0);
                    const color = totalPL > 0 ? 'text-green-400' : totalPL < 0 ? 'text-red-400' : 'text-yellow-400';
                    content += `<div class="text-xs ${color} font-bold">${formatCurrency(totalPL)}</div>`;
                }

                if (dayEvents.length > 0) {
                    dayEvents.forEach(e => {
                        content += `<div class="text-xs text-purple-300 mt-1 truncate">ğŸ“… ${e.title}</div>`;
                    });
                }

                cell.innerHTML = content;
                grid.appendChild(cell);
            }
        }

        window.editTrade = function(tradeId) {
            const trade = trades.find(t => t.id === tradeId);
            if (!trade) return;

            document.getElementById('editTradeId').value = tradeId;
            document.getElementById('editDate').value = trade.date || '';
            document.getElementById('editAsset').value = trade.asset || '';
            document.getElementById('editResult').value = trade.result || 'win';
            document.getElementById('editProfitLoss').value = trade.profitLoss || 0;
            document.getElementById('editPosition').value = trade.position || 'Long';
            document.getElementById('editStrategy').value = trade.strategy || '';
            document.getElementById('editEmotion').value = trade.emotion || '';
            document.getElementById('editNotes').value = trade.notes || '';

            document.getElementById('editModal').classList.remove('hidden');
            document.getElementById('editModal').classList.add('flex');
        };

        window.deleteTrade = async function(tradeId) {
            if (!currentUser) return;

            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 z-50 flex items-center justify-center modal-overlay';
            confirmDiv.innerHTML = `
                <div class="glass-card rounded-2xl p-8 max-w-md mx-4">
                    <h3 class="text-2xl font-bold mb-4">Trade lÃ¶schen?</h3>
                    <p class="text-gray-400 mb-6">MÃ¶chtest du diesen Trade wirklich lÃ¶schen?</p>
                    <div class="flex gap-4">
                        <button id="confirmDeleteYes" class="flex-1 py-3 rounded-xl font-bold bg-red-600 hover:bg-red-700 transition">Ja, lÃ¶schen</button>
                        <button id="confirmDeleteNo" class="flex-1 py-3 rounded-xl font-bold bg-slate-700 hover:bg-slate-600 transition">Abbrechen</button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDiv);

            document.getElementById('confirmDeleteNo').onclick = () => confirmDiv.remove();
            document.getElementById('confirmDeleteYes').onclick = async () => {
                try {
                    await deleteDoc(doc(db, 'users', currentUser.uid, 'trades', tradeId));
                    showToast('âœ… Trade gelÃ¶scht');
                    await loadAllData();
                    confirmDiv.remove();
                } catch (error) {
                    console.error('Fehler:', error);
                    showToast('âŒ Fehler beim LÃ¶schen');
                }
            };
        };

        window.deleteTransaction = async function(transactionId) {
            if (!currentUser) return;

            const confirmDiv = document.createElement('div');
            confirmDiv.className = 'fixed inset-0 z-50 flex items-center justify-center modal-overlay';
            confirmDiv.innerHTML = `
                <div class="glass-card rounded-2xl p-8 max-w-md mx-4">
                    <h3 class="text-2xl font-bold mb-4">Transaktion lÃ¶schen?</h3>
                    <p class="text-gray-400 mb-6">MÃ¶chtest du diese Transaktion wirklich lÃ¶schen?</p>
                    <div class="flex gap-4">
                        <button id="confirmDeleteYes" class="flex-1 py-3 rounded-xl font-bold bg-red-600 hover:bg-red-700 transition">Ja, lÃ¶schen</button>
                        <button id="confirmDeleteNo" class="flex-1 py-3 rounded-xl font-bold bg-slate-700 hover:bg-slate-600 transition">Abbrechen</button>
                    </div>
                </div>
            `;
            document.body.appendChild(confirmDiv);

            document.getElementById('confirmDeleteNo').onclick = () => confirmDiv.remove();
            document.getElementById('confirmDeleteYes').onclick = async () => {
                try {
                    await deleteDoc(doc(db, 'users', currentUser.uid, 'transactions', transactionId));
                    showToast('âœ… Transaktion gelÃ¶scht');
                    await loadAllData();
                    confirmDiv.remove();
                } catch (error) {
                    console.error('Fehler:', error);
                    showToast('âŒ Fehler beim LÃ¶schen');
                }
            };
        };

        // Auth handlers
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                await signInWithEmailAndPassword(auth, document.getElementById('loginEmail').value, document.getElementById('loginPassword').value);
            } catch (error) {
                showToast('âŒ Login fehlgeschlagen: ' + error.message);
            }
        });

        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                await createUserWithEmailAndPassword(auth, document.getElementById('registerEmail').value, document.getElementById('registerPassword').value);
                showToast('âœ… Registrierung erfolgreich!');
            } catch (error) {
                showToast('âŒ Registrierung fehlgeschlagen: ' + error.message);
            }
        });

        document.getElementById('showRegisterBtn').addEventListener('click', () => {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.remove('hidden');
        });

        document.getElementById('showLoginBtn').addEventListener('click', () => {
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
        });

        document.getElementById('logoutBtn').addEventListener('click', () => signOut(auth));

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('registerScreen').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                loadAllData();
            } else {
                currentUser = null;
                document.getElementById('mainApp').classList.add('hidden');
                document.getElementById('registerScreen').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
            }
        });

        // Tab Navigation
        document.querySelectorAll('.nav-button').forEach(button => {
            button.addEventListener('click', () => {
                const tabName = button.dataset.tab;

                document.querySelectorAll('.nav-button').forEach(btn => {
                    btn.classList.remove('active', 'bg-purple-600', 'text-white');
                    btn.classList.add('text-gray-400');
                });
                button.classList.add('active', 'bg-purple-600', 'text-white');
                button.classList.remove('text-gray-400');

                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById(tabName + 'Tab').classList.remove('hidden');
            });
        });

        // Forms
        document.getElementById('startCapitalForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) return;

            const amount = parseFloat(document.getElementById('startCapital').value);
            if (isNaN(amount) || amount <= 0) {
                showToast('âŒ Bitte gÃ¼ltigen Betrag eingeben');
                return;
            }

            try {
                await setDoc(doc(db, 'users', currentUser.uid, 'settings', 'capital'), {
                    startCapital: amount
                });
                showToast('âœ… Startkapital gespeichert!');
                await loadAllData();
            } catch (error) {
                showToast('âŒ Fehler beim Speichern');
            }
        });

        const today = new Date().toISOString().split('T')[0];
        document.getElementById('tradeDate').value = today;
        document.getElementById('withdrawalDate').value = today;
        document.getElementById('depositDate').value = today;
        document.getElementById('eventDate').value = today;

        document.getElementById('newTradeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) return;

            const result = document.getElementById('tradeResult').value;
            let profitLoss = parseFloat(document.getElementById('tradeProfitLoss').value) || 0;

            // Bei Loss negativ machen
            if (result === 'loss' && profitLoss > 0) {
                profitLoss = -Math.abs(profitLoss);
            } else if (result === 'loss') {
                profitLoss = Math.abs(profitLoss) * -1;
            }

            const trade = {
                date: document.getElementById('tradeDate').value,
                asset: document.getElementById('tradeAsset').value,
                result: result,
                profitLoss: profitLoss,
                position: document.getElementById('tradePosition').value,
                strategy: document.getElementById('tradeStrategy').value,
                emotion: document.getElementById('tradeEmotion').value,
                notes: document.getElementById('tradeNotes').value
            };

            try {
                await addDoc(collection(db, 'users', currentUser.uid, 'trades'), trade);
                showToast('âœ… Trade gespeichert!');
                document.getElementById('newTradeForm').reset();
                document.getElementById('tradeDate').value = today;
                await loadAllData();

                // Switch to history
                document.querySelectorAll('.nav-button').forEach(btn => {
                    btn.classList.remove('active', 'bg-purple-600', 'text-white');
                    btn.classList.add('text-gray-400');
                });
                document.querySelector('[data-tab="history"]').classList.add('active', 'bg-purple-600', 'text-white');
                document.querySelector('[data-tab="history"]').classList.remove('text-gray-400');
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                });
                document.getElementById('historyTab').classList.remove('hidden');
            } catch (error) {
                showToast('âŒ Fehler beim Speichern');
            }
        });

        document.getElementById('editTradeForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) return;

            const tradeId = document.getElementById('editTradeId').value;
            const result = document.getElementById('editResult').value;
            let profitLoss = parseFloat(document.getElementById('editProfitLoss').value) || 0;

            if (result === 'loss' && profitLoss > 0) {
                profitLoss = -Math.abs(profitLoss);
            } else if (result === 'loss') {
                profitLoss = Math.abs(profitLoss) * -1;
            }

            const trade = {
                date: document.getElementById('editDate').value,
                asset: document.getElementById('editAsset').value,
                result: result,
                profitLoss: profitLoss,
                position: document.getElementById('editPosition').value,
                strategy: document.getElementById('editStrategy').value,
                emotion: document.getElementById('editEmotion').value,
                notes: document.getElementById('editNotes').value
            };

            try {
                await updateDoc(doc(db, 'users', currentUser.uid, 'trades', tradeId), trade);
                showToast('âœ… Trade aktualisiert!');
                document.getElementById('editModal').classList.add('hidden');
                document.getElementById('editModal').classList.remove('flex');
                await loadAllData();
            } catch (error) {
                showToast('âŒ Fehler beim Aktualisieren');
            }
        });

        document.getElementById('cancelEdit').addEventListener('click', () => {
            document.getElementById('editModal').classList.add('hidden');
            document.getElementById('editModal').classList.remove('flex');
        });

        document.getElementById('withdrawalForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) return;

            const amount = parseFloat(document.getElementById('withdrawalAmount').value);
            const date = document.getElementById('withdrawalDate').value;
            const note = document.getElementById('withdrawalNote').value;

            try {
                await addDoc(collection(db, 'users', currentUser.uid, 'transactions'), {
                    type: 'withdrawal',
                    amount: amount,
                    date: date,
                    note: note
                });
                showToast('âœ… Auszahlung erfasst!');
                document.getElementById('withdrawalForm').reset();
                document.getElementById('withdrawalDate').value = today;
                await loadAllData();
            } catch (error) {
                showToast('âŒ Fehler beim Speichern');
            }
        });

        document.getElementById('depositForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) return;

            const amount = parseFloat(document.getElementById('depositAmount').value);
            const date = document.getElementById('depositDate').value;
            const note = document.getElementById('depositNote').value;

            try {
                await addDoc(collection(db, 'users', currentUser.uid, 'transactions'), {
                    type: 'deposit',
                    amount: amount,
                    date: date,
                    note: note
                });
                showToast('âœ… Einzahlung erfasst!');
                document.getElementById('depositForm').reset();
                document.getElementById('depositDate').value = today;
                await loadAllData();
            } catch (error) {
                showToast('âŒ Fehler beim Speichern');
            }
        });

        document.getElementById('filterAsset')?.addEventListener('change', renderHistory);
        document.getElementById('filterResult')?.addEventListener('change', renderHistory);

        document.getElementById('compoundForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const target = parseFloat(document.getElementById('compoundTarget').value);
            const rate = parseFloat(document.getElementById('compoundRate').value) / 100;
            const startCapital = startCapitalData?.startCapital || 0;

            if (startCapital === 0) {
                showToast('âŒ Bitte zuerst Startkapital festlegen');
                return;
            }

            // Berechne Monate bis Ziel
            let capital = startCapital;
            let months = 0;
            const maxMonths = 1000;

            while (capital < target && months < maxMonths) {
                capital += capital * rate;
                months++;
            }

            // Mit aktueller Performance
            const totalPL = trades.reduce((sum, t) => sum + (t.profitLoss || 0), 0);
            const currentCapital = startCapital + totalPL;
            const actualMonthsTrading = trades.length > 0 ? Math.ceil((new Date() - new Date(Math.min(...trades.map(t => new Date(t.date))))) / (1000 * 60 * 60 * 24 * 30)) : 1;
            const actualRate = actualMonthsTrading > 0 ? ((currentCapital - startCapital) / startCapital) / actualMonthsTrading : 0;

            let capitalCurrent = startCapital;
            let monthsCurrent = 0;

            while (capitalCurrent < target && monthsCurrent < maxMonths) {
                capitalCurrent += capitalCurrent * actualRate;
                monthsCurrent++;
            }

            document.getElementById('compoundMonths').textContent = months >= maxMonths ? 'âˆ' : months;
            document.getElementById('compoundCurrentMonths').textContent = monthsCurrent >= maxMonths ? 'âˆ' : monthsCurrent;
            
            const diff = monthsCurrent - months;
            
            // Status Box Update
            const statusBox = document.getElementById('compoundStatus');
            const statusIcon = document.getElementById('compoundStatusIcon');
            const statusText = document.getElementById('compoundStatusText');
            const statusDetail = document.getElementById('compoundStatusDetail');
            const statusExtra = document.getElementById('compoundStatusExtra');

            if (diff < 0) {
                // Schneller als geplant
                statusBox.className = 'rounded-2xl p-8 mb-6 text-center bg-gradient-to-br from-green-500 to-green-600';
                statusIcon.textContent = 'ğŸš€';
                statusText.textContent = t('fasterThanPlanned');
                statusDetail.textContent = `${Math.abs(diff)} ${t('monthsFaster')}`;
                statusExtra.textContent = t('keepGoing');
            } else if (diff > 0) {
                // Langsamer als geplant
                statusBox.className = 'rounded-2xl p-8 mb-6 text-center bg-gradient-to-br from-red-500 to-red-600';
                statusIcon.textContent = 'âš ï¸';
                statusText.textContent = t('slowerThanPlanned');
                statusDetail.textContent = `${diff} ${t('monthsSlower')}`;
                statusExtra.textContent = t('needImprovement');
            } else {
                // Genau auf Plan
                statusBox.className = 'rounded-2xl p-8 mb-6 text-center bg-gradient-to-br from-purple-500 to-purple-600';
                statusIcon.textContent = 'ğŸ¯';
                statusText.textContent = t('onTrack');
                statusDetail.textContent = t('exactlyOnTarget');
                statusExtra.textContent = '';
            }

            // Vergleichsdiagramm erstellen
            const maxDisplayMonths = Math.max(months, monthsCurrent) + 2;
            const plannedData = [];
            const actualData = [];
            const labelsComparison = [];

            // Geplante Entwicklung
            let capPlanned = startCapital;
            for (let m = 0; m <= maxDisplayMonths; m++) {
                labelsComparison.push(`Monat ${m}`);
                plannedData.push(capPlanned);
                if (capPlanned < target) {
                    capPlanned += capPlanned * rate;
                }
            }

            // Aktuelle Performance
            let capActual = startCapital;
            for (let m = 0; m <= maxDisplayMonths; m++) {
                actualData.push(capActual);
                if (capActual < target) {
                    capActual += capActual * actualRate;
                }
            }

            // Vergleichschart
            if (charts.compoundComparison) {
                charts.compoundComparison.destroy();
            }

            const comparisonCanvas = document.getElementById('compoundComparisonChart');
            if (comparisonCanvas) {
                charts.compoundComparison = new Chart(comparisonCanvas.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: labelsComparison,
                        datasets: [
                            {
                                label: 'ğŸ¯ Geplante Entwicklung',
                                data: plannedData,
                                borderColor: '#8b5cf6',
                                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                borderWidth: 3,
                                fill: false,
                                tension: 0.4,
                                pointRadius: 0,
                                borderDash: [5, 5]
                            },
                            {
                                label: 'ğŸ“Š Deine aktuelle Performance',
                                data: actualData,
                                borderColor: diff < 0 ? '#22c55e' : diff > 0 ? '#ef4444' : '#8b5cf6',
                                backgroundColor: diff < 0 ? 'rgba(34, 197, 94, 0.1)' : diff > 0 ? 'rgba(239, 68, 68, 0.1)' : 'rgba(139, 92, 246, 0.1)',
                                borderWidth: 4,
                                fill: true,
                                tension: 0.4,
                                pointRadius: 0
                            },
                            {
                                label: 'ğŸ Ziel',
                                data: Array(maxDisplayMonths + 1).fill(target),
                                borderColor: '#facc15',
                                backgroundColor: 'rgba(250, 204, 21, 0.1)',
                                borderWidth: 2,
                                fill: false,
                                borderDash: [10, 5],
                                pointRadius: 0
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                labels: {
                                    color: currentTheme === 'light' ? '#1e293b' : '#ffffff',
                                    font: { size: 14, weight: 'bold' },
                                    padding: 15
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    color: currentTheme === 'light' ? '#64748b' : '#9ca3af',
                                    maxTicksLimit: 12
                                },
                                grid: {
                                    color: currentTheme === 'light' ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.1)'
                                }
                            },
                            y: {
                                ticks: {
                                    color: currentTheme === 'light' ? '#64748b' : '#9ca3af',
                                    callback: (v) => formatCurrency(v)
                                },
                                grid: {
                                    color: currentTheme === 'light' ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.1)'
                                }
                            }
                        }
                    }
                });
            }

            // Original Chart (einzelne Entwicklung)
            const dataPoints = [];
            const labels = [];
            capital = startCapital;

            for (let m = 0; m <= months && m < maxMonths; m++) {
                labels.push(`Monat ${m}`);
                dataPoints.push(capital);
                capital += capital * rate;
            }

            if (charts.compound) {
                charts.compound.destroy();
            }

            const canvas = document.getElementById('compoundChart');
            if (canvas) {
                charts.compound = new Chart(canvas.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: t('capital'),
                            data: dataPoints,
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: currentTheme === 'light' ? '#1e293b' : '#ffffff',
                                    font: { size: 14, weight: 'bold' }
                                }
                            }
                        },
                        scales: {
                            x: {
                                ticks: {
                                    color: currentTheme === 'light' ? '#64748b' : '#9ca3af'
                                },
                                grid: {
                                    color: currentTheme === 'light' ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.1)'
                                }
                            },
                            y: {
                                ticks: {
                                    color: currentTheme === 'light' ? '#64748b' : '#9ca3af',
                                    callback: (v) => formatCurrency(v)
                                },
                                grid: {
                                    color: currentTheme === 'light' ? 'rgba(0, 0, 0, 0.05)' : 'rgba(255, 255, 255, 0.1)'
                                }
                            }
                        }
                    }
                });
            }

            document.getElementById('compoundResults').classList.remove('hidden');
        });

        // Calendar
        document.getElementById('prevMonth').addEventListener('click', () => {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            renderCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            renderCalendar();
        });

        document.getElementById('todayBtn').addEventListener('click', () => {
            currentCalendarDate = new Date();
            renderCalendar();
        });

        document.getElementById('eventForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) return;

            const event = {
                date: document.getElementById('eventDate').value,
                title: document.getElementById('eventTitle').value,
                description: document.getElementById('eventDescription').value
            };

            try {
                await addDoc(collection(db, 'users', currentUser.uid, 'events'), event);
                showToast('âœ… Termin gespeichert!');
                document.getElementById('eventForm').reset();
                document.getElementById('eventDate').value = today;
                await loadAllData();
            } catch (error) {
                showToast('âŒ Fehler beim Speichern');
            }
        });

        // Position Size Calculator
        document.getElementById('positionSizeForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const balance = parseFloat(document.getElementById('psBalance').value);
            const risk = parseFloat(document.getElementById('psRisk').value) / 100;
            const stopLoss = parseFloat(document.getElementById('psStopLoss').value);
            const pipValue = parseFloat(document.getElementById('psPipValue').value);

            const riskAmount = balance * risk;
            const positionSize = riskAmount / (stopLoss * pipValue);

            document.getElementById('positionSizeValue').textContent = positionSize.toFixed(2);
            document.getElementById('positionSizeResult').classList.remove('hidden');
        });

        // Pip Calculator
        document.getElementById('pipCalculatorForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const pair = document.getElementById('pipPair').value;
            const lots = parseFloat(document.getElementById('pipLots').value);
            const pips = parseFloat(document.getElementById('pipAmount').value);

            // Simplified pip value calculation
            const basePipValue = 10; // Standard fÃ¼r 1 lot
            const pipValuePerLot = basePipValue * lots;
            const totalValue = pipValuePerLot * pips;

            document.getElementById('pipValue').textContent = formatCurrency(pipValuePerLot);
            document.getElementById('pipTotal').textContent = formatCurrency(totalValue);
            document.getElementById('pipResult').classList.remove('hidden');
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b761eb307f5e0d3',t:'MTc2NzMxMzUzNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
