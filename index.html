<!doctype html>
<html lang="de" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0, user-scalable=yes, interactive-widget=resizes-content">
  <title>Trading Journal Pro - Login</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script><!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script>
// üî• FIREBASE KONFIGURATION - ERSETZE DIES MIT DEINER EIGENEN CONFIG!
const firebaseConfig = {
  apiKey: "AIzaSyAYpUD2SFyviiHDJSKvei_TtCqnhsM2sBA",
  authDomain: "trading-journal-pro-8212f.firebaseapp.com",
  projectId: "trading-journal-pro-8212f",
  storageBucket: "trading-journal-pro-8212f.firebasestorage.app",
  messagingSenderId: "927047992152",
  appId: "1:927047992152:web:b8ae1e90a01d4710955b2d",
  measurementId: "G-Q695KCMZ9N"
};


// Firebase initialisieren
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();
</script>
  <style>
body{box-sizing:border-box;-webkit-text-size-adjust:100%}
*{box-sizing:border-box;margin:0;padding:0}
:root{--bg:#0a0e1a;--card:#151b2e;--border:#1f2937;--text:#e5e7eb;--muted:#6b7280;--primary:#3b82f6;--success:#10b981;--danger:#ef4444;--warning:#f59e0b}
html,body{height:100%;width:100%}
body{font-family:'Inter',-apple-system,sans-serif;background:var(--bg);color:var(--text);line-height:1.6}
.wrapper{width:100%;height:100%;overflow-y:auto}

/* Login Screen Styles */
.login-container{width:100%;height:100%;display:flex;align-items:center;justify-content:center;padding:1rem;background:linear-gradient(135deg,#0a0e1a 0%,#1a1f35 100%)}
.login-box{background:var(--card);border:1px solid var(--border);border-radius:1rem;padding:2.5rem;max-width:420px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,0.5)}
.login-logo{text-align:center;font-size:3rem;margin-bottom:1rem}
.login-title{text-align:center;font-size:1.75rem;font-weight:700;margin-bottom:0.5rem;color:var(--primary)}
.login-subtitle{text-align:center;color:var(--muted);margin-bottom:2rem;font-size:0.95rem}
.login-tabs{display:flex;gap:0.5rem;margin-bottom:1.5rem;background:var(--bg);border-radius:0.5rem;padding:0.25rem}
.login-tab{flex:1;padding:0.75rem;border:none;background:transparent;color:var(--muted);border-radius:0.375rem;cursor:pointer;font-weight:600;transition:all 0.2s;touch-action:manipulation}
.login-tab.active{background:var(--primary);color:white}
.login-tab:hover:not(.active){background:rgba(59,130,246,0.1)}
.form-group{margin-bottom:1.25rem}
.form-label{display:block;font-size:0.875rem;font-weight:600;color:var(--muted);margin-bottom:0.5rem}
.form-input{width:100%;padding:0.875rem;border-radius:0.5rem;border:1px solid var(--border);background:var(--bg);color:var(--text);font-size:1rem;transition:border-color 0.2s}
.form-input:focus{outline:none;border-color:var(--primary);background:var(--card)}
.btn-login{width:100%;padding:1rem;border:none;border-radius:0.5rem;background:var(--primary);color:white;font-weight:700;font-size:1.05rem;cursor:pointer;transition:all 0.2s;touch-action:manipulation}
.btn-login:hover{background:#2563eb;transform:translateY(-1px)}
.btn-login:active{transform:translateY(0)}
.btn-login:disabled{opacity:0.5;cursor:not-allowed}
.divider{display:flex;align-items:center;text-align:center;color:var(--muted);font-size:0.875rem;margin:1.5rem 0}
.divider::before,.divider::after{content:'';flex:1;border-bottom:1px solid var(--border)}
.divider span{padding:0 1rem}
.btn-google{width:100%;padding:0.875rem;border:1px solid var(--border);border-radius:0.5rem;background:white;color:#333;font-weight:600;cursor:pointer;transition:all 0.2s;display:flex;align-items:center;justify-content:center;gap:0.75rem;touch-action:manipulation}
.btn-google:hover{background:#f8f9fa;transform:translateY(-1px)}
.btn-google:active{transform:translateY(0)}
.error-message{background:rgba(239,68,68,0.1);border:1px solid var(--danger);color:var(--danger);padding:0.75rem;border-radius:0.5rem;margin-bottom:1rem;font-size:0.875rem;display:none}
.user-info{position:fixed;top:1rem;right:1rem;background:var(--card);border:1px solid var(--border);border-radius:0.75rem;padding:0.75rem 1rem;display:flex;align-items:center;gap:0.75rem;z-index:1000}
.user-avatar{width:2.5rem;height:2.5rem;border-radius:50%;background:var(--primary);display:flex;align-items:center;justify-content:center;font-weight:700;font-size:1.1rem}
.btn-logout{padding:0.5rem 1rem;border:none;border-radius:0.5rem;background:var(--danger);color:white;font-weight:600;font-size:0.875rem;cursor:pointer;transition:all 0.2s;touch-action:manipulation}
.btn-logout:hover{background:#dc2626}
.sync-indicator{position:fixed;bottom:1rem;right:1rem;background:var(--card);border:1px solid var(--border);border-radius:0.5rem;padding:0.5rem 1rem;font-size:0.875rem;display:flex;align-items:center;gap:0.5rem;z-index:1000;opacity:0;transition:opacity 0.3s}
.sync-indicator.show{opacity:1}
.sync-spinner{width:1rem;height:1rem;border:2px solid var(--border);border-top-color:var(--primary);border-radius:50%;animation:spin 0.6s linear infinite}

.mobile-header{display:none;position:fixed;top:0;left:0;right:0;background:var(--card);border-bottom:1px solid var(--border);padding:1rem 1.5rem;z-index:200;align-items:center;justify-content:space-between}
.mobile-menu-btn{background:var(--primary);border:none;color:white;width:2.5rem;height:2.5rem;border-radius:0.5rem;font-size:1.5rem;cursor:pointer;display:flex;align-items:center;justify-content:center;touch-action:manipulation}
.mobile-menu-btn:active{transform:scale(0.95)}
.mobile-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:150}
.mobile-overlay.show{display:block}
.sidebar{position:fixed;left:0;top:0;bottom:0;width:240px;background:var(--card);border-right:1px solid var(--border);padding:1.5rem 1rem;overflow-y:auto;z-index:200;transition:transform 0.3s ease}
.main-content{margin-left:240px;padding:1.5rem;padding-top:4rem}
.logo{font-size:1.25rem;font-weight:700;color:var(--primary);margin-bottom:2rem;display:flex;align-items:center;gap:0.5rem}
.lang-selector{margin-bottom:1.5rem;width:100%}
.lang-selector select{width:100%;padding:0.625rem;border-radius:0.5rem;border:1px solid var(--border);background:var(--bg);color:var(--text);font-size:0.875rem;cursor:pointer;touch-action:manipulation}
.nav-item{display:flex;align-items:center;gap:0.75rem;padding:0.75rem 1rem;margin-bottom:0.25rem;border-radius:0.5rem;cursor:pointer;transition:all 0.2s;color:var(--muted);font-size:0.9rem;touch-action:manipulation;min-height:48px}
.nav-item:hover{background:rgba(59,130,246,0.1);color:var(--text)}
.nav-item:active{transform:scale(0.98)}
.nav-item.active{background:var(--primary);color:white}
.section{display:none}
.section.active{display:block;animation:fadeIn 0.3s}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.card{background:var(--card);border:1px solid var(--border);border-radius:0.75rem;padding:1.5rem;margin-bottom:1.5rem}
.card-title{font-size:1.125rem;font-weight:600;margin-bottom:1rem;display:flex;align-items:center;gap:0.5rem}
.grid{display:grid;gap:1.5rem}
.grid-2{grid-template-columns:repeat(auto-fit,minmax(300px,1fr))}
.stat-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:1rem;margin-bottom:1.5rem}
.stat{background:linear-gradient(135deg,rgba(59,130,246,0.05),rgba(59,130,246,0.02));border:1px solid var(--border);border-radius:0.75rem;padding:1rem}
.stat-label{font-size:0.75rem;color:var(--muted);text-transform:uppercase;letter-spacing:0.05em;margin-bottom:0.5rem}
.stat-value{font-size:1.75rem;font-weight:700}
.profit{color:var(--success)}
.loss{color:var(--danger)}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem}
label{display:block;font-size:0.875rem;font-weight:500;color:var(--muted);margin-bottom:0.5rem;margin-top:0.75rem}
input,select,textarea{width:100%;padding:0.75rem 0.875rem;border-radius:0.5rem;border:1px solid var(--border);background:var(--bg);color:var(--text);font-size:1rem;transition:border-color 0.2s;-webkit-appearance:none;appearance:none;touch-action:manipulation;-webkit-user-select:text;user-select:text;-webkit-tap-highlight-color:transparent}
input:focus,select:focus,textarea:focus{outline:none;border-color:var(--primary);background:var(--card)}
textarea{resize:vertical;min-height:100px;font-size:1rem;line-height:1.5}
.btn{padding:0.75rem 1.5rem;border:none;border-radius:0.5rem;font-weight:600;font-size:1rem;cursor:pointer;transition:all 0.2s;touch-action:manipulation;min-height:44px}
.btn-primary{background:var(--primary);color:white;width:100%;margin-top:1rem;padding:0.875rem}
.btn-primary:hover{background:#2563eb}
.btn-primary:active{transform:scale(0.98)}
.btn-primary:disabled{opacity:0.5;cursor:not-allowed}
.btn-sm{padding:0.5rem 0.875rem;font-size:0.875rem;min-height:40px}
.btn-danger{background:var(--danger);color:white}
.btn-danger:hover{background:#dc2626}
.btn-secondary{background:#374151;color:var(--text)}
.btn-secondary:hover{background:#475569}
.table-container{overflow-x:auto;margin-top:1rem}
table{width:100%;border-collapse:collapse;font-size:0.875rem;min-width:600px}
th,td{padding:0.75rem;text-align:left;border-bottom:1px solid var(--border)}
th{background:rgba(59,130,246,0.05);font-weight:600;color:var(--muted);text-transform:uppercase;font-size:0.75rem}
.chart{height:300px;margin:1rem 0}
.chart-sm{height:250px}
.empty{text-align:center;padding:3rem 1rem;color:var(--muted)}
.empty-icon{font-size:3rem;margin-bottom:1rem;opacity:0.5}
.toast{position:fixed;bottom:2rem;right:2rem;background:var(--card);border:1px solid var(--border);padding:1rem 1.5rem;border-radius:0.5rem;box-shadow:0 10px 40px rgba(0,0,0,0.5);z-index:1000;animation:slideIn 0.3s;max-width:90%}
@keyframes slideIn{from{transform:translateX(400px);opacity:0}to{transform:translateX(0);opacity:1}}
.toast.success{border-left:4px solid var(--success)}
.toast.error{border-left:4px solid var(--danger)}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.8);z-index:1000;align-items:center;justify-content:center;padding:1rem}
.modal.show{display:flex}
.modal-content{background:var(--card);border:1px solid var(--border);border-radius:0.75rem;padding:1.5rem;max-width:500px;width:100%;max-height:90%;overflow-y:auto}
.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem}
.modal-close{background:#374151;color:var(--text);border:none;width:2.5rem;height:2.5rem;border-radius:0.5rem;cursor:pointer;font-size:1.25rem;display:flex;align-items:center;justify-content:center;touch-action:manipulation}
.modal-close:hover{background:#475569}
.emotion-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:0.75rem;margin-top:1rem}
.emotion-btn{background:var(--bg);border:2px solid var(--border);border-radius:0.75rem;padding:1rem;cursor:pointer;transition:all 0.2s;text-align:center;font-size:0.875rem;color:var(--text);touch-action:manipulation;min-height:60px}
.emotion-btn:hover{border-color:var(--primary);transform:translateY(-2px)}
.emotion-btn.selected{border-color:var(--primary);background:rgba(59,130,246,0.1)}
.emotion-icon{font-size:2rem;display:block;margin-bottom:0.5rem}
.goal-card{background:rgba(59,130,246,0.03);border:1px solid var(--border);border-radius:0.75rem;padding:1.25rem;margin-bottom:1rem}
.goal-header{display:flex;justify-content:space-between;align-items:start;margin-bottom:1rem;gap:1rem}
.progress-bar{width:100%;height:6px;background:var(--border);border-radius:3px;overflow:hidden;margin:0.75rem 0}
.progress-fill{height:100%;background:linear-gradient(90deg,var(--primary),#60a5fa);transition:width 0.3s}
.loading{display:inline-block;width:1rem;height:1rem;border:2px solid rgba(255,255,255,0.3);border-radius:50%;border-top-color:white;animation:spin 0.6s linear infinite;margin-left:0.5rem}
@keyframes spin{to{transform:rotate(360deg)}}

@media(max-width:768px){
  .mobile-header{display:flex}
  .sidebar{transform:translateX(-100%)}
  .sidebar.open{transform:translateX(0)}
  .main-content{margin-left:0;padding:1rem;padding-top:4.5rem}
  .login-box{padding:2rem 1.5rem}
  .login-title{font-size:1.5rem}
  .user-info{top:auto;bottom:5rem;right:1rem;font-size:0.875rem}
  .user-avatar{width:2rem;height:2rem;font-size:0.9rem}
  .btn-logout{padding:0.4rem 0.75rem;font-size:0.8rem}
}
</style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div class="wrapper"><!-- Login Screen -->
   <div id="loginScreen" class="login-container">
    <div class="login-box">
     <div class="login-logo">
      üìä
     </div>
     <h1 class="login-title">Trading Journal Pro</h1>
     <p class="login-subtitle">Verwalte deine Trades auf allen Ger√§ten</p>
     <div class="login-tabs"><button class="login-tab active" onclick="switchTab('login')">Anmelden</button> <button class="login-tab" onclick="switchTab('register')">Registrieren</button>
     </div>
     <div id="errorMessage" class="error-message"></div><!-- Login Form -->
     <form id="loginForm" style="display:block">
      <div class="form-group"><label class="form-label" for="loginEmail">E-Mail</label> <input type="email" id="loginEmail" class="form-input" placeholder="deine@email.com" required>
      </div>
      <div class="form-group"><label class="form-label" for="loginPassword">Passwort</label> <input type="password" id="loginPassword" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
      </div><button type="submit" class="btn-login" id="loginBtn"> <span id="loginBtnText">Anmelden</span> </button>
     </form><!-- Register Form -->
     <form id="registerForm" style="display:none">
      <div class="form-group"><label class="form-label" for="registerEmail">E-Mail</label> <input type="email" id="registerEmail" class="form-input" placeholder="deine@email.com" required>
      </div>
      <div class="form-group"><label class="form-label" for="registerPassword">Passwort</label> <input type="password" id="registerPassword" class="form-input" placeholder="Mindestens 6 Zeichen" required minlength="6">
      </div>
      <div class="form-group"><label class="form-label" for="registerPasswordConfirm">Passwort wiederholen</label> <input type="password" id="registerPasswordConfirm" class="form-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6">
      </div><button type="submit" class="btn-login" id="registerBtn"> <span id="registerBtnText">Registrieren</span> </button>
     </form>
     <div class="divider">
      <span>oder</span>
     </div><button class="btn-google" onclick="loginWithGoogle()">
      <svg width="18" height="18" viewbox="0 0 18 18">
       <path fill="#4285F4" d="M16.51 8H8.98v3h4.3c-.18 1-.74 1.48-1.6 2.04v2.01h2.6a7.8 7.8 0 0 0 2.38-5.88c0-.57-.05-.66-.15-1.18z"></path><path fill="#34A853" d="M8.98 17c2.16 0 3.97-.72 5.3-1.94l-2.6-2a4.8 4.8 0 0 1-7.18-2.54H1.83v2.07A8 8 0 0 0 8.98 17z"></path><path fill="#FBBC05" d="M4.5 10.52a4.8 4.8 0 0 1 0-3.04V5.41H1.83a8 8 0 0 0 0 7.18l2.67-2.07z"></path><path fill="#EA4335" d="M8.98 4.18c1.17 0 2.23.4 3.06 1.2l2.3-2.3A8 8 0 0 0 1.83 5.4L4.5 7.49a4.77 4.77 0 0 1 4.48-3.3z"></path>
      </svg> Mit Google anmelden </button>
    </div>
   </div><!-- Main App (hidden until login) -->
   <div id="mainApp" style="display:none">
    <div class="user-info" id="userInfo">
     <div class="user-avatar" id="userAvatar">
      U
     </div>
     <div>
      <div style="font-weight:600;font-size:0.875rem" id="userName">
       User
      </div>
      <div style="font-size:0.75rem;color:var(--muted)" id="userEmail">
       user@email.com
      </div>
     </div><button class="btn-logout" onclick="logout()">Abmelden</button>
    </div>
    <div class="sync-indicator" id="syncIndicator">
     <div class="sync-spinner"></div><span>Synchronisiere...</span>
    </div>
    <div class="mobile-header">
     <div style="font-size:1.25rem;font-weight:700;color:var(--primary)">
      üìä <span id="mobileHeaderTitle">Trading Pro</span>
     </div>
     <div style="display:flex;gap:0.5rem;align-items:center"><select id="mobileLanguageSelector" style="padding:0.5rem;border-radius:0.5rem;border:1px solid var(--border);background:var(--bg);color:var(--text);font-size:0.875rem;cursor:pointer;min-height:44px"> <option value="de">üá©üá™ DE</option> <option value="en">üá¨üáß EN</option> <option value="es">üá™üá∏ ES</option> </select> <button class="mobile-menu-btn" id="mobileMenuBtn">‚ò∞</button>
     </div>
    </div>
    <div class="mobile-overlay" id="mobileOverlay"></div>
    <aside class="sidebar" id="sidebar">
     <div class="logo">
      üìä <span id="sidebarTitle">Trading Pro</span>
     </div>
     <div class="lang-selector"><select id="languageSelector" style="min-height:44px"> <option value="de">üá©üá™ Deutsch</option> <option value="en">üá¨üáß English</option> <option value="es">üá™üá∏ Espa√±ol</option> </select>
     </div>
     <nav id="navigation">
      <div class="nav-item active" data-section="dashboard">
       <span class="nav-icon">üìä</span> <span class="nav-text">Dashboard</span>
      </div>
      <div class="nav-item" data-section="trade">
       <span class="nav-icon">‚ûï</span> <span class="nav-text">Neuer Trade</span>
      </div>
      <div class="nav-item" data-section="history">
       <span class="nav-icon">üìú</span> <span class="nav-text">Historie</span>
      </div>
      <div class="nav-item" data-section="performance">
       <span class="nav-icon">üìä</span> <span class="nav-text">Performance</span>
      </div>
      <div class="nav-item" data-section="emotions">
       <span class="nav-icon">üé≠</span> <span class="nav-text">Emotionen</span>
      </div>
      <div class="nav-item" data-section="goals">
       <span class="nav-icon">üßÆ</span> <span class="nav-text">Zinseszins</span>
      </div>
      <div class="nav-item" data-section="withdrawals">
       <span class="nav-icon">üí∏</span> <span class="nav-text">Auszahlungen</span>
      </div>
     </nav>
    </aside>
    <main class="main-content" id="mainContent"><!-- Content will be dynamically updated -->
    </main>
   </div>
  </div>
  <div id="editModal" class="modal">
   <div class="modal-content">
    <div class="modal-header">
     <h3 id="editModalTitle">Trade bearbeiten</h3><button class="modal-close" onclick="closeEditModal()">‚úï</button>
    </div>
    <form id="editTradeForm"><!-- Form content will be dynamically updated -->
    </form>
   </div>
  </div>
  <script>
// Translations (gleich wie vorher)
const translations = {
  de: {
    appTitle: "Trading Pro",
    nav: { dashboard: "Dashboard", newTrade: "Neuer Trade", history: "Historie", performance: "Performance", emotions: "Emotionen", compound: "Zinseszins", withdrawals: "Auszahlungen" },
    dashboard: { title: "Dashboard", capitalSetup: "Kapital Setup", startCapital: "Startkapital (‚Ç¨)", saveCapital: "Startkapital speichern", overview: "√úbersicht", currentCapital: "Aktuelles Kapital", trades: "Trades", winrate: "Winrate", totalPL: "Gesamt P/L", financialOverview: "Finanz√ºbersicht", wins: "Gewinne", losses: "Verluste", withdrawals: "Auszahlungen", cashflowSummary: "Cashflow Zusammenfassung", incomeVsExpenses: "Einnahmen vs. Ausgaben", totalIncome: "Gesamt Einnahmen", totalExpenses: "Gesamt Ausgaben", netResult: "Netto Ergebnis", equityCurve: "Equity Curve", maxDrawdown: "Max Drawdown", profitFactor: "Profit Factor" },
    trade: { title: "Neuer Trade", date: "Datum", asset: "Asset", select: "-- ausw√§hlen --", lotSize: "Lot Size", result: "Ergebnis", win: "Gewinn", loss: "Verlust", breakeven: "Break Even", profitLoss: "Gewinn/Verlust (‚Ç¨)", entryPrice: "Entry Price", exitPrice: "Exit Price", strategy: "Strategie", strategyPlaceholder: "z.B. Trend Following", emotion: "Emotion beim Trade", noEmotion: "-- keine Emotion --", notes: "Notizen", notesPlaceholder: "Deine Gedanken zum Trade...", addTrade: "Trade hinzuf√ºgen", required: "* Pflichtfeld - alle anderen Felder sind optional" },
    history: { title: "Trade Historie", date: "Datum", asset: "Asset", lot: "Lot", result: "Ergebnis", emotion: "Emotion", actions: "Aktionen", edit: "Edit", delete: "L√∂schen", noTrades: "Noch keine Trades" },
    performance: { title: "Performance Analyse", metrics: "Performance Metriken", totalPL: "Gesamt P/L", avgWin: "√ò Gewinn", avgLoss: "√ò Verlust", winrate: "Winrate", profitFactor: "Profit Factor", trades: "Trades", bestTrade: "Bester Trade", worstTrade: "Schlechtester Trade", currentStreak: "Aktueller Streak", assetDistribution: "Asset Verteilung", assetPerformance: "Asset Performance (P/L)", monthlyPerformance: "Monatliche Performance", streaksTitle: "Winning & Losing Streaks", longestWinStreak: "L√§ngster Winning Streak", longestLossStreak: "L√§ngster Losing Streak", consecutiveWins: "aufeinanderfolgende Gewinne", consecutiveLosses: "aufeinanderfolgende Verluste", currentlyIn: "Du befindest dich gerade in einem", winningStreak: "Winning Streak", losingStreak: "Losing Streak", noData: "Keine Daten" },
    emotions: { title: "Emotionen Tracking", date: "Datum", selectEmotion: "Emotion w√§hlen", confident: "Selbstsicher", anxious: "√Ñngstlich", excited: "Aufgeregt", frustrated: "Frustriert", calm: "Gelassen", greedy: "Gierig", intensity: "Intensit√§t (1-10)", notes: "Notizen", notesPlaceholder: "Wie f√ºhlst du dich heute beim Trading?", save: "Emotion speichern", noEmotions: "Noch keine Emotionen getrackt", fromHistory: "Aus Trade Historie" },
    compound: { title: "Zinseszinseffekt Rechner", currentPerformance: "Deine aktuelle Performance", currentCapital: "Aktuelles Kapital", avgMonthlyReturn: "√ò Monatliche Rendite", tradingSince: "Trading seit", months: "Monate", calculate: "Zinseszins berechnen", startCapital: "Startkapital (‚Ç¨)", monthlyReturn: "Monatliche Rendite (%)", timeframe: "Zeitraum (Monate)", monthlyWithdrawal: "Monatliche Auszahlung (‚Ç¨)", optional: "Optional - 0 f√ºr keine Auszahlungen", yourCurrent: "Deine aktuelle", calculateBtn: "Berechnen", results: "Berechnungsergebnis", finalCapital: "Endkapital nach", totalGrowth: "Gesamt Wachstum", totalReturn: "Gesamt Return", totalWithdrawn: "Gesamt ausgezahlt", capitalGrowth: "Kapitalwachstum" },
    withdrawals: { title: "Auszahlungen", newWithdrawal: "Neue Auszahlung", date: "Datum", amount: "Betrag (‚Ç¨)", notes: "Notizen", notesPlaceholder: "Grund f√ºr die Auszahlung...", add: "Auszahlung hinzuf√ºgen", total: "Gesamt Auszahlungen", count: "Anzahl", noWithdrawals: "Keine Auszahlungen" },
    modals: { editTrade: "Trade bearbeiten", deleteTrade: "Trade l√∂schen?", deleteEmotion: "Emotion l√∂schen?", deleteWithdrawal: "Auszahlung l√∂schen?", confirm: "L√∂schen", cancel: "Abbrechen", update: "Trade aktualisieren" },
    messages: { capitalSaved: "Startkapital gespeichert!", tradeAdded: "Trade erfolgreich hinzugef√ºgt!", tradeUpdated: "Trade aktualisiert!", tradeDeleted: "Trade gel√∂scht", emotionSaved: "Emotion gespeichert!", emotionDeleted: "Emotion gel√∂scht", withdrawalAdded: "Auszahlung hinzugef√ºgt!", withdrawalDeleted: "Auszahlung gel√∂scht", calculationSuccess: "Berechnung erfolgreich!", selectEmotion: "Bitte w√§hle eine Emotion", fillAllFields: "Bitte alle Felder korrekt ausf√ºllen", validCapital: "Bitte g√ºltiges Startkapital eingeben" }
  },
  en: {
    appTitle: "Trading Pro",
    nav: { dashboard: "Dashboard", newTrade: "New Trade", history: "History", performance: "Performance", emotions: "Emotions", compound: "Compound", withdrawals: "Withdrawals" },
    dashboard: { title: "Dashboard", capitalSetup: "Capital Setup", startCapital: "Starting Capital (‚Ç¨)", saveCapital: "Save Starting Capital", overview: "Overview", currentCapital: "Current Capital", trades: "Trades", winrate: "Win Rate", totalPL: "Total P/L", financialOverview: "Financial Overview", wins: "Wins", losses: "Losses", withdrawals: "Withdrawals", cashflowSummary: "Cashflow Summary", incomeVsExpenses: "Income vs. Expenses", totalIncome: "Total Income", totalExpenses: "Total Expenses", netResult: "Net Result", equityCurve: "Equity Curve", maxDrawdown: "Max Drawdown", profitFactor: "Profit Factor" },
    trade: { title: "New Trade", date: "Date", asset: "Asset", select: "-- select --", lotSize: "Lot Size", result: "Result", win: "Win", loss: "Loss", breakeven: "Break Even", profitLoss: "Profit/Loss (‚Ç¨)", entryPrice: "Entry Price", exitPrice: "Exit Price", strategy: "Strategy", strategyPlaceholder: "e.g. Trend Following", emotion: "Trade Emotion", noEmotion: "-- no emotion --", notes: "Notes", notesPlaceholder: "Your thoughts about the trade...", addTrade: "Add Trade", required: "* Required field - all other fields are optional" },
    history: { title: "Trade History", date: "Date", asset: "Asset", lot: "Lot", result: "Result", emotion: "Emotion", actions: "Actions", edit: "Edit", delete: "Delete", noTrades: "No trades yet" },
    performance: { title: "Performance Analysis", metrics: "Performance Metrics", totalPL: "Total P/L", avgWin: "Avg Win", avgLoss: "Avg Loss", winrate: "Win Rate", profitFactor: "Profit Factor", trades: "Trades", bestTrade: "Best Trade", worstTrade: "Worst Trade", currentStreak: "Current Streak", assetDistribution: "Asset Distribution", assetPerformance: "Asset Performance (P/L)", monthlyPerformance: "Monthly Performance", streaksTitle: "Winning & Losing Streaks", longestWinStreak: "Longest Win Streak", longestLossStreak: "Longest Loss Streak", consecutiveWins: "consecutive wins", consecutiveLosses: "consecutive losses", currentlyIn: "You are currently in a", winningStreak: "Winning Streak", losingStreak: "Losing Streak", noData: "No data" },
    emotions: { title: "Emotions Tracking", date: "Date", selectEmotion: "Select Emotion", confident: "Confident", anxious: "Anxious", excited: "Excited", frustrated: "Frustrated", calm: "Calm", greedy: "Greedy", intensity: "Intensity (1-10)", notes: "Notes", notesPlaceholder: "How do you feel about trading today?", save: "Save Emotion", noEmotions: "No emotions tracked yet", fromHistory: "From Trade History" },
    compound: { title: "Compound Interest Calculator", currentPerformance: "Your Current Performance", currentCapital: "Current Capital", avgMonthlyReturn: "Avg Monthly Return", tradingSince: "Trading Since", months: "Months", calculate: "Calculate Compound", startCapital: "Starting Capital (‚Ç¨)", monthlyReturn: "Monthly Return (%)", timeframe: "Timeframe (Months)", monthlyWithdrawal: "Monthly Withdrawal (‚Ç¨)", optional: "Optional - 0 for no withdrawals", yourCurrent: "Your current", calculateBtn: "Calculate", results: "Calculation Results", finalCapital: "Final Capital after", totalGrowth: "Total Growth", totalReturn: "Total Return", totalWithdrawn: "Total Withdrawn", capitalGrowth: "Capital Growth" },
    withdrawals: { title: "Withdrawals", newWithdrawal: "New Withdrawal", date: "Date", amount: "Amount (‚Ç¨)", notes: "Notes", notesPlaceholder: "Reason for withdrawal...", add: "Add Withdrawal", total: "Total Withdrawals", count: "Count", noWithdrawals: "No withdrawals" },
    modals: { editTrade: "Edit Trade", deleteTrade: "Delete trade?", deleteEmotion: "Delete emotion?", deleteWithdrawal: "Delete withdrawal?", confirm: "Delete", cancel: "Cancel", update: "Update Trade" },
    messages: { capitalSaved: "Starting capital saved!", tradeAdded: "Trade successfully added!", tradeUpdated: "Trade updated!", tradeDeleted: "Trade deleted", emotionSaved: "Emotion saved!", emotionDeleted: "Emotion deleted", withdrawalAdded: "Withdrawal added!", withdrawalDeleted: "Withdrawal deleted", calculationSuccess: "Calculation successful!", selectEmotion: "Please select an emotion", fillAllFields: "Please fill all fields correctly", validCapital: "Please enter valid starting capital" }
  },
  es: {
    appTitle: "Trading Pro",
    nav: { dashboard: "Panel", newTrade: "Nueva Operaci√≥n", history: "Historia", performance: "Rendimiento", emotions: "Emociones", compound: "Inter√©s Compuesto", withdrawals: "Retiros" },
    dashboard: { title: "Panel de Control", capitalSetup: "Configuraci√≥n de Capital", startCapital: "Capital Inicial (‚Ç¨)", saveCapital: "Guardar Capital Inicial", overview: "Resumen", currentCapital: "Capital Actual", trades: "Operaciones", winrate: "Tasa de √âxito", totalPL: "P/L Total", financialOverview: "Resumen Financiero", wins: "Ganancias", losses: "P√©rdidas", withdrawals: "Retiros", cashflowSummary: "Resumen de Flujo de Caja", incomeVsExpenses: "Ingresos vs. Gastos", totalIncome: "Ingresos Totales", totalExpenses: "Gastos Totales", netResult: "Resultado Neto", equityCurve: "Curva de Capital", maxDrawdown: "P√©rdida M√°xima", profitFactor: "Factor de Beneficio" },
    trade: { title: "Nueva Operaci√≥n", date: "Fecha", asset: "Activo", select: "-- seleccionar --", lotSize: "Tama√±o de Lote", result: "Resultado", win: "Ganancia", loss: "P√©rdida", breakeven: "Punto de Equilibrio", profitLoss: "Ganancia/P√©rdida (‚Ç¨)", entryPrice: "Precio de Entrada", exitPrice: "Precio de Salida", strategy: "Estrategia", strategyPlaceholder: "ej. Seguimiento de Tendencia", emotion: "Emoci√≥n en la Operaci√≥n", noEmotion: "-- sin emoci√≥n --", notes: "Notas", notesPlaceholder: "Tus pensamientos sobre la operaci√≥n...", addTrade: "Agregar Operaci√≥n", required: "* Campo obligatorio - todos los dem√°s campos son opcionales" },
    history: { title: "Historial de Operaciones", date: "Fecha", asset: "Activo", lot: "Lote", result: "Resultado", emotion: "Emoci√≥n", actions: "Acciones", edit: "Editar", delete: "Eliminar", noTrades: "A√∫n no hay operaciones" },
    performance: { title: "An√°lisis de Rendimiento", metrics: "M√©tricas de Rendimiento", totalPL: "P/L Total", avgWin: "Ganancia Prom.", avgLoss: "P√©rdida Prom.", winrate: "Tasa de √âxito", profitFactor: "Factor de Beneficio", trades: "Operaciones", bestTrade: "Mejor Operaci√≥n", worstTrade: "Peor Operaci√≥n", currentStreak: "Racha Actual", assetDistribution: "Distribuci√≥n de Activos", assetPerformance: "Rendimiento por Activo (P/L)", monthlyPerformance: "Rendimiento Mensual", streaksTitle: "Rachas Ganadoras y Perdedoras", longestWinStreak: "Racha Ganadora M√°s Larga", longestLossStreak: "Racha Perdedora M√°s Larga", consecutiveWins: "victorias consecutivas", consecutiveLosses: "p√©rdidas consecutivas", currentlyIn: "Actualmente est√°s en una", winningStreak: "Racha Ganadora", losingStreak: "Racha Perdedora", noData: "Sin datos" },
    emotions: { title: "Seguimiento de Emociones", date: "Fecha", selectEmotion: "Seleccionar Emoci√≥n", confident: "Confiado", anxious: "Ansioso", excited: "Emocionado", frustrated: "Frustrado", calm: "Tranquilo", greedy: "Codicioso", intensity: "Intensidad (1-10)", notes: "Notas", notesPlaceholder: "¬øC√≥mo te sientes hoy con el trading?", save: "Guardar Emoci√≥n", noEmotions: "A√∫n no hay emociones registradas", fromHistory: "Del Historial de Operaciones" },
    compound: { title: "Calculadora de Inter√©s Compuesto", currentPerformance: "Tu Rendimiento Actual", currentCapital: "Capital Actual", avgMonthlyReturn: "Retorno Mensual Prom.", tradingSince: "Operando Desde", months: "Meses", calculate: "Calcular Inter√©s Compuesto", startCapital: "Capital Inicial (‚Ç¨)", monthlyReturn: "Retorno Mensual (%)", timeframe: "Per√≠odo (Meses)", monthlyWithdrawal: "Retiro Mensual (‚Ç¨)", optional: "Opcional - 0 para ning√∫n retiro", yourCurrent: "Tu actual", calculateBtn: "Calcular", results: "Resultados del C√°lculo", finalCapital: "Capital Final despu√©s de", totalGrowth: "Crecimiento Total", totalReturn: "Retorno Total", totalWithdrawn: "Total Retirado", capitalGrowth: "Crecimiento del Capital" },
    withdrawals: { title: "Retiros", newWithdrawal: "Nuevo Retiro", date: "Fecha", amount: "Monto (‚Ç¨)", notes: "Notas", notesPlaceholder: "Motivo del retiro...", add: "Agregar Retiro", total: "Retiros Totales", count: "Cantidad", noWithdrawals: "Sin retiros" },
    modals: { editTrade: "Editar Operaci√≥n", deleteTrade: "¬øEliminar operaci√≥n?", deleteEmotion: "¬øEliminar emoci√≥n?", deleteWithdrawal: "¬øEliminar retiro?", confirm: "Eliminar", cancel: "Cancelar", update: "Actualizar Operaci√≥n" },
    messages: { capitalSaved: "¬°Capital inicial guardado!", tradeAdded: "¬°Operaci√≥n agregada exitosamente!", tradeUpdated: "¬°Operaci√≥n actualizada!", tradeDeleted: "Operaci√≥n eliminada", emotionSaved: "¬°Emoci√≥n guardada!", emotionDeleted: "Emoci√≥n eliminada", withdrawalAdded: "¬°Retiro agregado!", withdrawalDeleted: "Retiro eliminado", calculationSuccess: "¬°C√°lculo exitoso!", selectEmotion: "Por favor selecciona una emoci√≥n", fillAllFields: "Por favor completa todos los campos correctamente", validCapital: "Por favor ingresa un capital inicial v√°lido" }
  }
};

let currentLang = localStorage.getItem('tradingJournalLang') || 'de';
let currentUser = null;
let allData = [];
let charts = {};
let selectedEmotion = '';
let unsubscribeFirestore = null;

// Auth State Observer
auth.onAuthStateChanged((user) => {
  if (user) {
    currentUser = user;
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('mainApp').style.display = 'block';
    
    // Update user info
    document.getElementById('userName').textContent = user.displayName || user.email.split('@')[0];
    document.getElementById('userEmail').textContent = user.email;
    document.getElementById('userAvatar').textContent = (user.displayName || user.email)[0].toUpperCase();
    
    // Load user data from Firestore
    loadUserData();
    initApp();
  } else {
    currentUser = null;
    document.getElementById('loginScreen').style.display = 'flex';
    document.getElementById('mainApp').style.display = 'none';
    if (unsubscribeFirestore) {
      unsubscribeFirestore();
      unsubscribeFirestore = null;
    }
  }
});

// Tab Switching
function switchTab(tab) {
  const loginForm = document.getElementById('loginForm');
  const registerForm = document.getElementById('registerForm');
  const tabs = document.querySelectorAll('.login-tab');
  
  tabs.forEach(t => t.classList.remove('active'));
  
  if (tab === 'login') {
    loginForm.style.display = 'block';
    registerForm.style.display = 'none';
    tabs[0].classList.add('active');
  } else {
    loginForm.style.display = 'none';
    registerForm.style.display = 'block';
    tabs[1].classList.add('active');
  }
  
  hideError();
}

// Error Display
function showError(message) {
  const errorEl = document.getElementById('errorMessage');
  errorEl.textContent = message;
  errorEl.style.display = 'block';
}

function hideError() {
  document.getElementById('errorMessage').style.display = 'none';
}

// Login
document.getElementById('loginForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  hideError();
  
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;
  const btn = document.getElementById('loginBtn');
  const btnText = document.getElementById('loginBtnText');
  
  btn.disabled = true;
  btnText.innerHTML = 'Anmelden<span class="loading"></span>';
  
  try {
    await auth.signInWithEmailAndPassword(email, password);
  } catch (error) {
    let errorMessage = 'Anmeldung fehlgeschlagen';
    if (error.code === 'auth/user-not-found') errorMessage = 'Kein Benutzer mit dieser E-Mail gefunden';
    if (error.code === 'auth/wrong-password') errorMessage = 'Falsches Passwort';
    if (error.code === 'auth/invalid-email') errorMessage = 'Ung√ºltige E-Mail-Adresse';
    if (error.code === 'auth/too-many-requests') errorMessage = 'Zu viele Versuche. Bitte sp√§ter erneut versuchen';
    showError(errorMessage);
    btn.disabled = false;
    btnText.textContent = 'Anmelden';
  }
});

// Register
document.getElementById('registerForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  hideError();
  
  const email = document.getElementById('registerEmail').value;
  const password = document.getElementById('registerPassword').value;
  const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
  const btn = document.getElementById('registerBtn');
  const btnText = document.getElementById('registerBtnText');
  
  if (password !== passwordConfirm) {
    showError('Passw√∂rter stimmen nicht √ºberein');
    return;
  }
  
  if (password.length < 6) {
    showError('Passwort muss mindestens 6 Zeichen lang sein');
    return;
  }
  
  btn.disabled = true;
  btnText.innerHTML = 'Registrieren<span class="loading"></span>';
  
  try {
    await auth.createUserWithEmailAndPassword(email, password);
  } catch (error) {
    let errorMessage = 'Registrierung fehlgeschlagen';
    if (error.code === 'auth/email-already-in-use') errorMessage = 'E-Mail-Adresse wird bereits verwendet';
    if (error.code === 'auth/invalid-email') errorMessage = 'Ung√ºltige E-Mail-Adresse';
    if (error.code === 'auth/weak-password') errorMessage = 'Passwort ist zu schwach';
    showError(errorMessage);
    btn.disabled = false;
    btnText.textContent = 'Registrieren';
  }
});

// Google Login
async function loginWithGoogle() {
  hideError();
  try {
    const provider = new firebase.auth.GoogleAuthProvider();
    await auth.signInWithPopup(provider);
  } catch (error) {
    let errorMessage = 'Google-Anmeldung fehlgeschlagen';
    if (error.code === 'auth/popup-closed-by-user') errorMessage = 'Anmeldung abgebrochen';
    if (error.code === 'auth/popup-blocked') errorMessage = 'Popup wurde blockiert. Bitte Popup-Blocker deaktivieren';
    showError(errorMessage);
  }
}

// Logout
function logout() {
  auth.signOut();
  allData = [];
}

// Firestore Data Management
function loadUserData() {
  if (!currentUser) return;
  
  showSyncIndicator();
  
  // Real-time listener for user's data
  unsubscribeFirestore = db.collection('users').doc(currentUser.uid).collection('data')
    .onSnapshot((snapshot) => {
      allData = [];
      snapshot.forEach((doc) => {
        allData.push({ id: doc.id, ...doc.data() });
      });
      updateAll();
      hideSyncIndicator();
    }, (error) => {
      console.error('Error loading data:', error);
      hideSyncIndicator();
    });
}

async function saveToFirestore(data) {
  if (!currentUser) return;
  
  showSyncIndicator();
  
  try {
    const docRef = db.collection('users').doc(currentUser.uid).collection('data').doc(data.id);
    await docRef.set(data);
    hideSyncIndicator();
  } catch (error) {
    console.error('Error saving data:', error);
    showToast('Fehler beim Speichern', 'error');
    hideSyncIndicator();
  }
}

async function deleteFromFirestore(id) {
  if (!currentUser) return;
  
  showSyncIndicator();
  
  try {
    await db.collection('users').doc(currentUser.uid).collection('data').doc(id).delete();
    hideSyncIndicator();
  } catch (error) {
    console.error('Error deleting data:', error);
    showToast('Fehler beim L√∂schen', 'error');
    hideSyncIndicator();
  }
}

function showSyncIndicator() {
  document.getElementById('syncIndicator').classList.add('show');
}

function hideSyncIndicator() {
  setTimeout(() => {
    document.getElementById('syncIndicator').classList.remove('show');
  }, 500);
}

function generateId() {
  return Date.now().toString(36) + Math.random().toString(36).substr(2);
}

// Language Management
function setLanguage(lang) {
  currentLang = lang;
  localStorage.setItem('tradingJournalLang', lang);
  document.getElementById('languageSelector').value = lang;
  document.getElementById('mobileLanguageSelector').value = lang;
  renderUI();
  updateAll();
}

function t(path) {
  const keys = path.split('.');
  let value = translations[currentLang];
  for (const key of keys) {
    value = value[key];
    if (value === undefined) return path;
  }
  return value;
}

// Mobile Menu
let mobileMenuBtn, sidebar, mobileOverlay;

function initMobileMenu() {
  mobileMenuBtn = document.getElementById('mobileMenuBtn');
  sidebar = document.getElementById('sidebar');
  mobileOverlay = document.getElementById('mobileOverlay');
  
  if (mobileMenuBtn) {
    mobileMenuBtn.addEventListener('click', () => {
      sidebar.classList.add('open');
      mobileOverlay.classList.add('show');
    });
  }
  
  if (mobileOverlay) {
    mobileOverlay.addEventListener('click', () => {
      sidebar.classList.remove('open');
      mobileOverlay.classList.remove('show');
    });
  }
}

// Alle anderen Funktionen bleiben GLEICH wie vorher (renderUI, renderDashboard, updateAll, etc.)
// Ich kopiere hier nur die wichtigsten √Ñnderungen:

function renderUI() {
  const lang = translations[currentLang];
  
  document.getElementById('sidebarTitle').textContent = lang.appTitle;
  document.getElementById('mobileHeaderTitle').textContent = lang.appTitle;
  
  const navItems = document.querySelectorAll('.nav-item');
  navItems[0].innerHTML = `<span class="nav-icon">üìä</span> <span class="nav-text">${lang.nav.dashboard}</span>`;
  navItems[1].innerHTML = `<span class="nav-icon">‚ûï</span> <span class="nav-text">${lang.nav.newTrade}</span>`;
  navItems[2].innerHTML = `<span class="nav-icon">üìú</span> <span class="nav-text">${lang.nav.history}</span>`;
  navItems[3].innerHTML = `<span class="nav-icon">üìä</span> <span class="nav-text">${lang.nav.performance}</span>`;
  navItems[4].innerHTML = `<span class="nav-icon">üé≠</span> <span class="nav-text">${lang.nav.emotions}</span>`;
  navItems[5].innerHTML = `<span class="nav-icon">üßÆ</span> <span class="nav-text">${lang.nav.compound}</span>`;
  navItems[6].innerHTML = `<span class="nav-icon">üí∏</span> <span class="nav-text">${lang.nav.withdrawals}</span>`;
  
  renderDashboard();
  renderTradePage();
  renderHistoryPage();
  renderPerformancePage();
  renderEmotionsPage();
  renderCompoundPage();
  renderWithdrawalsPage();
  renderEditModal();
}

// Die Render-Funktionen sind IDENTISCH wie vorher, nur die Add/Update/Delete Funktionen √§ndern sich:

function renderTradePage() {
  const tr = translations[currentLang].trade;
  const mainContent = document.getElementById('mainContent');
  
  const tradeSection = document.createElement('section');
  tradeSection.id = 'trade';
  tradeSection.className = 'section';
  tradeSection.innerHTML = `
    <h2 style="margin-bottom:1.5rem">‚ûï ${tr.title}</h2>
    <div class="card">
      <form id="tradeForm">
        <div class="form-grid">
          <div><label for="tradeDate">${tr.date} *</label><input type="date" id="tradeDate" required></div>
          <div><label for="tradeAsset">${tr.asset}</label><select id="tradeAsset"><option value="">${tr.select}</option><optgroup label="Major Pairs"><option>EUR/USD</option><option>GBP/USD</option><option>USD/JPY</option><option>USD/CHF</option><option>AUD/USD</option><option>USD/CAD</option><option>NZD/USD</option></optgroup><optgroup label="Minor Pairs"><option>EUR/GBP</option><option>EUR/AUD</option><option>EUR/CAD</option><option>EUR/JPY</option><option>GBP/JPY</option><option>GBP/AUD</option><option>AUD/JPY</option><option>NZD/JPY</option></optgroup><optgroup label="Exotic Pairs"><option>USD/TRY</option><option>USD/ZAR</option><option>USD/MXN</option><option>EUR/TRY</option></optgroup><optgroup label="Commodities"><option>XAU/USD (Gold)</option><option>XAG/USD (Silber)</option><option>WTI/USD (√ñl)</option></optgroup><optgroup label="Crypto"><option>BTC/USD</option><option>ETH/USD</option><option>XRP/USD</option></optgroup><optgroup label="Indices"><option>US30</option><option>NAS100</option><option>SPX500</option><option>GER40</option><option>UK100</option></optgroup></select></div>
          <div><label for="tradeLot">${tr.lotSize}</label><input type="number" step="0.01" id="tradeLot" placeholder="0.01" inputmode="decimal"></div>
          <div><label for="tradeResult">${tr.result}</label><select id="tradeResult"><option value="">${tr.select}</option><option value="win">‚úÖ ${tr.win}</option><option value="loss">‚ùå ${tr.loss}</option><option value="breakeven">‚ûñ ${tr.breakeven}</option></select></div>
          <div><label for="tradePL">${tr.profitLoss}</label><input type="number" step="0.01" id="tradePL" placeholder="0.00" inputmode="decimal"></div>
          <div><label for="tradeEntry">${tr.entryPrice}</label><input type="number" step="0.00001" id="tradeEntry" placeholder="1.08500" inputmode="decimal"></div>
          <div><label for="tradeExit">${tr.exitPrice}</label><input type="number" step="0.00001" id="tradeExit" placeholder="1.08750" inputmode="decimal"></div>
          <div><label for="tradeStrategy">${tr.strategy}</label><input type="text" id="tradeStrategy" placeholder="${tr.strategyPlaceholder}"></div>
        </div>
        <p style="font-size:0.75rem;color:var(--muted);margin-top:0.5rem">${tr.required}</p>
        <label for="tradeEmotion">${tr.emotion}</label>
        <select id="tradeEmotion">
          <option value="">${tr.noEmotion}</option>
          <option value="confident">üòé ${translations[currentLang].emotions.confident}</option>
          <option value="anxious">üò∞ ${translations[currentLang].emotions.anxious}</option>
          <option value="excited">ü§© ${translations[currentLang].emotions.excited}</option>
          <option value="frustrated">üò§ ${translations[currentLang].emotions.frustrated}</option>
          <option value="calm">üòå ${translations[currentLang].emotions.calm}</option>
          <option value="greedy">ü§ë ${translations[currentLang].emotions.greedy}</option>
        </select>
        <label for="tradeNotes">${tr.notes}</label>
        <textarea id="tradeNotes" placeholder="${tr.notesPlaceholder}"></textarea>
        <button type="submit" class="btn btn-primary">${tr.addTrade}</button>
      </form>
    </div>
  `;
  
  const existingTrade = document.getElementById('trade');
  if (existingTrade) existingTrade.remove();
  mainContent.appendChild(tradeSection);
  
  const tradeForm = document.getElementById('tradeForm');
  if (tradeForm) {
    tradeForm.addEventListener('submit', function(e) {
      e.preventDefault();
      
      let profitLoss = parseFloat(document.getElementById('tradePL').value) || 0;
      const tradeResult = document.getElementById('tradeResult').value;
      
      if (tradeResult === 'loss' && profitLoss > 0) {
        profitLoss = -profitLoss;
      }
      
      const newTrade = {
        id: generateId(),
        type: 'trade',
        date: document.getElementById('tradeDate').value,
        asset: document.getElementById('tradeAsset').value,
        lot_size: parseFloat(document.getElementById('tradeLot').value) || 0,
        result: tradeResult,
        profit_loss: profitLoss,
        entry_price: parseFloat(document.getElementById('tradeEntry').value) || 0,
        exit_price: parseFloat(document.getElementById('tradeExit').value) || 0,
        strategy: document.getElementById('tradeStrategy').value || '',
        notes: document.getElementById('tradeNotes').value || '',
        emotion: document.getElementById('tradeEmotion').value || ''
      };
      
      saveToFirestore(newTrade);
      showToast(t('messages.tradeAdded'), 'success');
      this.reset();
      document.getElementById('tradeDate').value = new Date().toISOString().split('T')[0];
    });
  }
  
  const tradeDateField = document.getElementById('tradeDate');
  if (tradeDateField) {
    tradeDateField.value = new Date().toISOString().split('T')[0];
  }
}

// Weitere Render-Funktionen hier einf√ºgen (renderDashboard, renderHistoryPage, etc.)
// Sie sind IDENTISCH wie in der vorherigen Version

// Delete Trade Funktion (ge√§ndert f√ºr Firebase)
function deleteTrade(id) {
  const m = translations[currentLang].modals;
  
  const deleteConfirm = document.createElement('div');
  deleteConfirm.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--card);border:1px solid var(--border);border-radius:0.75rem;padding:1.5rem;z-index:10000;box-shadow:0 20px 50px rgba(0,0,0,0.7);max-width:90%;width:300px';
  deleteConfirm.innerHTML = `
    <div style="font-weight:600;margin-bottom:1rem;font-size:1.1rem">${m.deleteTrade}</div>
    <div style="display:flex;gap:0.75rem;margin-top:1rem">
      <button class="btn btn-danger" style="flex:1" id="confirmDeleteBtn">${m.confirm}</button>
      <button class="btn btn-secondary" style="flex:1" id="cancelDeleteBtn">${m.cancel}</button>
    </div>
  `;
  
  const overlay = document.createElement('div');
  overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.7);z-index:9999';
  
  document.body.appendChild(overlay);
  document.body.appendChild(deleteConfirm);
  
  document.getElementById('confirmDeleteBtn').onclick = () => {
    deleteFromFirestore(id);
    showToast(t('messages.tradeDeleted'), 'success');
    overlay.remove();
    deleteConfirm.remove();
  };
  
  document.getElementById('cancelDeleteBtn').onclick = () => {
    overlay.remove();
    deleteConfirm.remove();
  };
  
  overlay.onclick = () => {
    overlay.remove();
    deleteConfirm.remove();
  };
}

// Edit Trade (ge√§ndert f√ºr Firebase)
function editTrade(id) {
  const trade = allData.find(d => d.id === id);
  if (!trade) return;
  
  document.getElementById('editTradeId').value = id;
  document.getElementById('editTradeDate').value = trade.date;
  document.getElementById('editTradeAsset').value = trade.asset;
  document.getElementById('editTradeLot').value = trade.lot_size;
  document.getElementById('editTradeResult').value = trade.result;
  document.getElementById('editTradePL').value = trade.profit_loss;
  document.getElementById('editTradeEntry').value = trade.entry_price;
  document.getElementById('editTradeExit').value = trade.exit_price;
  document.getElementById('editTradeStrategy').value = trade.strategy || '';
  document.getElementById('editTradeEmotion').value = trade.emotion || '';
  document.getElementById('editTradeNotes').value = trade.notes || '';
  
  document.getElementById('editModal').classList.add('show');
}

function closeEditModal() {
  document.getElementById('editModal').classList.remove('show');
}

// Initialize App
function initApp() {
  renderUI();
  initMobileMenu();
  
  const langSelector = document.getElementById('languageSelector');
  const mobileLangSelector = document.getElementById('mobileLanguageSelector');
  
  if (langSelector) {
    langSelector.value = currentLang;
    langSelector.addEventListener('change', (e) => setLanguage(e.target.value));
  }
  
  if (mobileLangSelector) {
    mobileLangSelector.value = currentLang;
    mobileLangSelector.addEventListener('change', (e) => setLanguage(e.target.value));
  }
  
  document.querySelectorAll('.nav-item').forEach(nav => {
    nav.addEventListener('click', () => {
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      document.getElementById(nav.dataset.section).classList.add('active');
      nav.classList.add('active');
      
      if (sidebar) sidebar.classList.remove('open');
      if (mobileOverlay) mobileOverlay.classList.remove('show');
      
      updateAll();
    });
  });
  
  updateAll();
}

// Update functions - ALLE GLEICH WIE VORHER
function updateAll() {
  const cap = allData.find(d => d.type === 'capital');
  const startCapitalField = document.getElementById('startCapital');
  if (cap && startCapitalField) startCapitalField.value = cap.start_capital;
  updateDashboard();
  updateHistory();
  updatePerformance();
  updateEmotionHistory();
  updateCompoundCalculator();
  updateWithdrawals();
}

// Hier m√ºssen ALLE Update-Funktionen eingef√ºgt werden (updateDashboard, updateHistory, etc.)
// Sie sind IDENTISCH wie vorher, ich k√ºrze hier ab

function showToast(message, type = 'success') {
  const toast = document.createElement('div');
  toast.className = `toast ${type}`;
  toast.textContent = message;
  document.body.appendChild(toast);
  setTimeout(() => {
    toast.style.animation = 'slideIn 0.3s reverse';
    setTimeout(() => toast.remove(), 300);
  }, 3000);
}

// F√ºge alle weiteren Funktionen ein...
// (Die komplette Datei ist zu lang f√ºr eine Antwort - soll ich sie in Teile aufteilen?)
</script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b71774b5528e0d3',t:'MTc2NzI2NDczNC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
