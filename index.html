<!doctype html>
<html lang="de" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trading Journal Pro</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script>
        // Firebase Konfiguration (Demo - Bitte durch deine eigene Config ersetzen)
        const firebaseConfig = {
  apiKey: "AIzaSyAYpUD2SFyviiHDJSKvei_TtCqnhsM2sBA",
  authDomain: "trading-journal-pro-8212f.firebaseapp.com",
  projectId: "trading-journal-pro-8212f",
  storageBucket: "trading-journal-pro-8212f.firebasestorage.app",
  messagingSenderId: "927047992152",
  appId: "1:927047992152:web:2269467aa95689e0955b2d",
  measurementId: "G-36WT75DLEL"
};
        
        // Firebase initialisieren (nur wenn echte Config vorhanden)
        if (firebaseConfig.apiKey !== "DEMO-API-KEY") {
            firebase.initializeApp(firebaseConfig);
        }
    </script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        :root {
            --bg-primary: #0a0e27;
            --bg-secondary: #1a1f3a;
            --bg-card: rgba(26, 31, 58, 0.85);
            --text-primary: #ffffff;
            --text-secondary: #9ca3af;
            --border-color: rgba(255, 255, 255, 0.1);
            --accent-purple: #8b5cf6;
            --accent-blue: #3b82f6;
        }
        
        [data-theme="light"] {
            --bg-primary: #f1f5f9;
            --bg-secondary: #e2e8f0;
            --bg-card: rgba(255, 255, 255, 0.95);
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --border-color: rgba(15, 23, 42, 0.15);
            --accent-purple: #7c3aed;
            --accent-blue: #2563eb;
        }
        
        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            transition: background 0.3s, color 0.3s;
        }
        
        .glass-card {
            background: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            transition: all 0.3s;
        }
        
        [data-theme="light"] .glass-card {
            box-shadow: 0 4px 16px rgba(15, 23, 42, 0.15);
            border: 1px solid rgba(15, 23, 42, 0.12);
        }
        
        .modal-overlay {
            background: rgba(10, 14, 39, 0.95);
            backdrop-filter: blur(10px);
        }
        
        [data-theme="light"] .modal-overlay {
            background: rgba(248, 250, 252, 0.95);
        }
        
        .mobile-nav-bottom {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 40;
            background: var(--bg-secondary);
            border-top: 1px solid var(--border-color);
        }
        
        @media (min-width: 768px) {
            .mobile-nav-bottom {
                display: none;
            }
        }
        
        .desktop-sidebar {
            display: none;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
        }
        
        @media (min-width: 768px) {
            .desktop-sidebar {
                display: flex;
            }
        }
        
        .nav-btn-active {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            color: white !important;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
            color: white;
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 16px rgba(139, 92, 246, 0.3);
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
        }
        
        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
        }
        
        .calendar-day:hover {
            background: var(--accent-purple);
            color: white;
        }
        
        .calendar-day.has-trade {
            background: rgba(139, 92, 246, 0.3);
            font-weight: bold;
        }
        
        .calendar-day.has-event {
            border: 2px solid var(--accent-blue);
        }
        
        input, select, textarea {
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--accent-purple);
            outline: none;
        }
        
        [data-theme="light"] input,
        [data-theme="light"] select,
        [data-theme="light"] textarea {
            background: white;
            border-color: rgba(15, 23, 42, 0.2);
            color: #0f172a;
        }
        
        [data-theme="light"] input:focus,
        [data-theme="light"] select:focus,
        [data-theme="light"] textarea:focus {
            border-color: var(--accent-purple);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }
        
        .toast {
            position: fixed;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            z-index: 10000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.3s ease;
        }
        
        [data-theme="light"] .toast {
            background: rgba(15, 23, 42, 0.95);
            color: white;
        }
        
        @keyframes slideUp {
            from { transform: translate(-50%, 20px); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
        
        .stat-card {
            padding: 1rem;
        }
        
        @media (min-width: 640px) {
            .stat-card {
                padding: 1.5rem;
            }
        }
        
        .scrollbar-thin::-webkit-scrollbar {
            width: 6px;
        }
        
        .scrollbar-thin::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }
        
        .scrollbar-thin::-webkit-scrollbar-thumb {
            background: var(--accent-purple);
            border-radius: 3px;
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full">
  <div class="min-h-full w-full flex flex-col overflow-auto" id="app"><!-- Login Screen -->
   <div id="loginScreen" class="fixed inset-0 flex items-center justify-center p-4" style="background: linear-gradient(135deg, #0a0e27 0%, #1e1b4b 50%, #312e81 100%);">
    <div class="glass-card rounded-2xl p-6 sm:p-8 max-w-md w-full">
     <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold flex items-center gap-2"><span class="text-3xl">ğŸ’</span> <span id="loginTitle" data-i18n="trading_journal_pro">Trading Journal Pro</span></h1>
      <div class="flex gap-2"><button id="themeToggleLogin" class="p-2 rounded-lg hover:bg-white hover:bg-opacity-10 transition"> <span class="text-xl">ğŸŒ™</span> </button> <select id="langSelectorLogin" class="px-3 py-1 rounded-lg text-sm"> <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option> <option value="en">ğŸ‡¬ğŸ‡§ English</option> <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option> </select>
      </div>
     </div>
     <form id="loginForm" class="space-y-4">
      <div><label class="block text-sm font-bold mb-2" id="emailLabel" data-i18n="email">E-Mail</label> <input type="email" id="loginEmail" class="w-full px-4 py-3 rounded-xl" placeholder="beispiel@email.com" required>
      </div>
      <div><label class="block text-sm font-bold mb-2" id="passwordLabel" data-i18n="password">Passwort</label> <input type="password" id="loginPassword" class="w-full px-4 py-3 rounded-xl" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required>
      </div><button type="submit" class="w-full py-3 rounded-xl font-bold btn-primary"> <span id="loginBtn" data-i18n="login">Anmelden</span> </button> <button type="button" id="registerToggle" class="w-full py-3 rounded-xl font-bold bg-gray-700 hover:bg-gray-600 transition"> <span id="registerBtn" data-i18n="register">Noch kein Konto? Registrieren</span> </button>
     </form>
     <div class="mt-4 text-center text-xs opacity-70" id="demoNote" data-i18n="demo_note">
      Demo-Modus: Beliebige E-Mail verwenden
     </div>
    </div>
   </div><!-- Main App -->
   <div id="mainApp" class="hidden flex-1 flex flex-col"><!-- Header -->
    <header class="bg-gradient-to-r from-purple-600 to-blue-600 shadow-2xl w-full sticky top-0 z-30">
     <div class="px-4 py-3">
      <div class="flex items-center justify-between">
       <h1 class="text-lg font-bold text-white flex items-center gap-2"><span class="text-2xl">ğŸ’</span> <span class="hidden sm:inline" id="headerTitle">Trading Journal Pro</span> <span class="sm:hidden">TJ Pro</span></h1>
       <div class="flex items-center gap-2"><button id="themeToggle" class="p-2 hover:bg-white hover:bg-opacity-10 rounded-lg transition"> <span class="text-xl" id="themeIcon">ğŸŒ™</span> </button> <select id="langSelector" class="px-3 py-1 rounded-lg text-sm bg-white bg-opacity-20 border-none text-white"> <option value="de">ğŸ‡©ğŸ‡ª</option> <option value="en">ğŸ‡¬ğŸ‡§</option> <option value="es">ğŸ‡ªğŸ‡¸</option> </select>
        <div class="bg-white bg-opacity-10 px-3 py-1 rounded-lg">
         <div class="text-xs text-purple-100" id="capitalLabel">
          Kapital
         </div>
         <div class="text-sm font-bold" id="headerCapital">
          â‚¬0.00
         </div>
        </div><button id="menuBtn" class="p-2 hover:bg-white hover:bg-opacity-10 rounded-lg transition md:hidden">
         <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
         </svg></button>
       </div>
      </div>
     </div>
    </header><!-- Mobile Menu -->
    <div id="menuOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>
    <div id="mobileMenu" class="fixed top-14 right-0 w-64 shadow-2xl z-50 rounded-bl-2xl hidden glass-card">
     <div class="p-4 space-y-2"><button class="mobile-menu-item w-full text-left px-4 py-3 rounded-lg hover:bg-purple-600 hover:bg-opacity-20 flex items-center gap-3" data-action="logout"> <span class="text-xl">ğŸšª</span> <span class="font-semibold" id="logoutBtn">Abmelden</span> </button>
     </div>
    </div>
    <div class="flex flex-1 overflow-hidden w-full relative"><!-- Desktop Sidebar -->
     <aside class="desktop-sidebar w-64 overflow-y-auto flex-shrink-0 scrollbar-thin">
      <nav class="p-4 space-y-2" id="desktopNav"></nav>
     </aside><!-- Main Content -->
     <main class="flex-1 overflow-auto w-full pb-20 md:pb-6 scrollbar-thin">
      <div class="max-w-7xl mx-auto px-3 py-4 sm:px-6 sm:py-6"><!-- Dashboard Tab -->
       <div id="dashboardTab" class="tab-content"><!-- FinanzÃ¼bersicht -->
        <div class="glass-card rounded-2xl p-4 mb-4">
         <h2 class="text-xl font-bold mb-4 flex items-center gap-2"><span>ğŸ’¼</span> <span data-i18n="financial_overview">FinanzÃ¼bersicht</span></h2>
         <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
          <div><label class="block text-sm font-bold mb-2" data-i18n="start_capital">Startkapital (â‚¬)</label> <input type="number" id="startCapitalInput" step="0.01" class="w-full px-4 py-3 rounded-xl" placeholder="10000">
          </div>
          <div class="flex items-end"><button id="saveStartCapital" class="w-full py-3 rounded-xl font-bold btn-primary"> <span data-i18n="save">ğŸ’¾ Speichern</span> </button>
          </div>
         </div>
         <div class="grid grid-cols-2 lg:grid-cols-4 gap-3">
          <div class="glass-card rounded-xl stat-card text-center">
           <div class="text-2xl mb-2">
            ğŸ’°
           </div>
           <div class="text-xs mb-1" data-i18n="current_capital">
            Aktuelles Kapital
           </div>
           <div class="text-lg sm:text-xl font-bold text-purple-400" id="currentCapital">
            â‚¬0.00
           </div>
          </div>
          <div class="glass-card rounded-xl stat-card text-center">
           <div class="text-2xl mb-2">
            ğŸ“Š
           </div>
           <div class="text-xs mb-1" data-i18n="total_pl">
            Gesamt P/L
           </div>
           <div class="text-lg sm:text-xl font-bold" id="totalPL">
            â‚¬0.00
           </div>
          </div>
          <div class="glass-card rounded-xl stat-card text-center">
           <div class="text-2xl mb-2">
            ğŸ¯
           </div>
           <div class="text-xs mb-1" data-i18n="winrate">
            Winrate
           </div>
           <div class="text-lg sm:text-xl font-bold" id="winRate">
            0%
           </div>
          </div>
          <div class="glass-card rounded-xl stat-card text-center">
           <div class="text-2xl mb-2">
            ğŸ“
           </div>
           <div class="text-xs mb-1" data-i18n="trades">
            Trades
           </div>
           <div class="text-lg sm:text-xl font-bold" id="totalTrades">
            0
           </div>
          </div>
         </div>
        </div><!-- Equity Curve -->
        <div class="glass-card rounded-2xl p-4 mb-4">
         <h3 class="text-lg font-bold mb-4 flex items-center gap-2"><span>ğŸ“ˆ</span> <span data-i18n="equity_curve">Equity Curve</span></h3>
         <div class="h-64">
          <canvas id="equityChart"></canvas>
         </div>
        </div><!-- Aktuelle Performance -->
        <div class="glass-card rounded-2xl p-4">
         <h3 class="text-lg font-bold mb-4 flex items-center gap-2"><span>ğŸ†</span> <span data-i18n="current_performance">Deine aktuelle Performance</span></h3>
         <div class="grid grid-cols-2 gap-3">
          <div class="text-center">
           <div class="text-xs mb-1" data-i18n="best_trade">
            Bester Trade
           </div>
           <div class="text-xl font-bold text-green-400" id="dashBestTrade">
            â‚¬0.00
           </div>
          </div>
          <div class="text-center">
           <div class="text-xs mb-1" data-i18n="worst_trade">
            Schlechtester Trade
           </div>
           <div class="text-xl font-bold text-red-400" id="dashWorstTrade">
            â‚¬0.00
           </div>
          </div>
         </div>
        </div>
       </div><!-- Neuer Trade Tab -->
       <div id="newtradeTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-4">
         <h2 class="text-xl font-bold mb-4 flex items-center gap-2"><span>â•</span> <span data-i18n="new_trade">Neuer Trade</span></h2>
         <form id="newTradeForm" class="space-y-4">
          <div><label class="block text-sm font-bold mb-2"> <span data-i18n="date">Datum</span> * </label> <input type="date" id="tradeDate" class="w-full px-4 py-3 rounded-xl" required>
          </div>
          <div><label class="block text-sm font-bold mb-2" data-i18n="asset">Asset</label> <select id="tradeAsset" class="w-full px-4 py-3 rounded-xl"> <option value="">-- Bitte wÃ¤hlen --</option> <optgroup label="ğŸ“Š Forex Majors"> <option value="EUR/USD">EUR/USD</option> <option value="GBP/USD">GBP/USD</option> <option value="USD/JPY">USD/JPY</option> <option value="USD/CHF">USD/CHF</option> <option value="AUD/USD">AUD/USD</option> <option value="USD/CAD">USD/CAD</option> <option value="NZD/USD">NZD/USD</option> </optgroup> <optgroup label="ğŸ“Š Forex Minors"> <option value="EUR/GBP">EUR/GBP</option> <option value="EUR/JPY">EUR/JPY</option> <option value="EUR/AUD">EUR/AUD</option> <option value="EUR/CAD">EUR/CAD</option> <option value="EUR/CHF">EUR/CHF</option> <option value="GBP/JPY">GBP/JPY</option> <option value="GBP/AUD">GBP/AUD</option> <option value="GBP/CAD">GBP/CAD</option> <option value="GBP/CHF">GBP/CHF</option> <option value="AUD/JPY">AUD/JPY</option> <option value="AUD/CAD">AUD/CAD</option> <option value="AUD/CHF">AUD/CHF</option> <option value="CAD/JPY">CAD/JPY</option> <option value="CAD/CHF">CAD/CHF</option> <option value="CHF/JPY">CHF/JPY</option> <option value="NZD/JPY">NZD/JPY</option> <option value="NZD/CAD">NZD/CAD</option> </optgroup> <optgroup label="ğŸ¥‡ Commodities"> <option value="XAU/USD">Gold (XAU/USD)</option> <option value="XAG/USD">Silver (XAG/USD)</option> <option value="Oil">Oil</option> </optgroup> <optgroup label="â‚¿ Crypto"> <option value="BTC/USD">Bitcoin</option> <option value="ETH/USD">Ethereum</option> </optgroup> </select>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
           <div><label class="block text-sm font-bold mb-2" data-i18n="result">Ergebnis</label> <select id="tradeResult" class="w-full px-4 py-3 rounded-xl"> <option value="win">âœ… Win</option> <option value="loss">âŒ Loss</option> <option value="breakeven">âš–ï¸ Break Even</option> </select>
           </div>
           <div><label class="block text-sm font-bold mb-2" data-i18n="position">Position</label> <select id="tradePosition" class="w-full px-4 py-3 rounded-xl"> <option value="Long">Long</option> <option value="Short">Short</option> </select>
           </div>
          </div>
          <div><label class="block text-sm font-bold mb-2" data-i18n="profit_loss">Profit/Loss (â‚¬)</label> <input type="number" id="tradeProfitLoss" step="0.01" class="w-full px-4 py-3 rounded-xl" placeholder="0.00">
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
           <div><label class="block text-sm font-bold mb-2" data-i18n="entry_price">Einstiegspreis</label> <input type="number" id="tradeEntry" step="0.00001" class="w-full px-4 py-3 rounded-xl" placeholder="1.08500">
           </div>
           <div><label class="block text-sm font-bold mb-2" data-i18n="exit_price">Ausstiegspreis</label> <input type="number" id="tradeExit" step="0.00001" class="w-full px-4 py-3 rounded-xl" placeholder="1.09000">
           </div>
          </div>
          <div><label class="block text-sm font-bold mb-2" data-i18n="strategy">Strategie</label> <input type="text" id="tradeStrategy" class="w-full px-4 py-3 rounded-xl" placeholder="z.B. Breakout, Scalping">
          </div>
          <div><label class="block text-sm font-bold mb-2" data-i18n="emotion">Emotion</label> <select id="tradeEmotion" class="w-full px-4 py-3 rounded-xl"> <option value="">-- Optional --</option> <option value="confident">ğŸ˜ Confident / Zuversichtlich</option> <option value="calm">ğŸ˜Œ Calm / Ruhig</option> <option value="excited">ğŸ¤© Excited / Aufgeregt</option> <option value="anxious">ğŸ˜° Anxious / Ã„ngstlich</option> <option value="frustrated">ğŸ˜¤ Frustrated / Frustriert</option> <option value="greedy">ğŸ¤‘ Greedy / Gierig</option> <option value="fearful">ğŸ˜¨ Fearful / Ã„ngstlich</option> <option value="euphoric">ğŸ¥³ Euphoric / Euphorisch</option> <option value="disciplined">ğŸ§˜ Disciplined / Diszipliniert</option> <option value="revenge">ğŸ˜¡ Revenge Trading</option> </select>
          </div>
          <div><label class="block text-sm font-bold mb-2" data-i18n="notes">Notizen</label> <textarea id="tradeNotes" rows="4" class="w-full px-4 py-3 rounded-xl" placeholder="Details zum Trade..."></textarea>
          </div><button type="submit" class="w-full py-4 rounded-xl font-bold text-lg btn-primary"> <span data-i18n="save_trade">ğŸ’¾ Trade speichern</span> </button>
         </form>
        </div>
       </div><!-- Historie Tab -->
       <div id="historyTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-4">
         <h2 class="text-xl font-bold mb-4 flex items-center gap-2"><span>ğŸ“œ</span> <span data-i18n="history">Historie</span></h2>
         <div class="mb-4 flex gap-2"><select id="filterResult" class="flex-1 px-3 py-2 rounded-lg text-sm"> <option value="all" data-i18n="all_results">Alle Ergebnisse</option> <option value="win">âœ… Wins</option> <option value="loss">âŒ Loss</option> <option value="breakeven">âš–ï¸ Break Even</option> </select>
         </div>
         <div id="tradeHistoryList" class="space-y-3"></div>
        </div>
       </div><!-- Performance Tab -->
       <div id="performanceTab" class="tab-content hidden">
        <div class="grid grid-cols-2 gap-3 mb-4">
         <div class="glass-card rounded-xl stat-card text-center">
          <div class="text-2xl mb-2">
           ğŸ†
          </div>
          <div class="text-xs mb-1" data-i18n="best_trade">
           Bester Trade
          </div>
          <div class="text-lg font-bold text-green-400" id="perfBestTrade">
           â‚¬0.00
          </div>
         </div>
         <div class="glass-card rounded-xl stat-card text-center">
          <div class="text-2xl mb-2">
           ğŸ’”
          </div>
          <div class="text-xs mb-1" data-i18n="worst_trade">
           Schlechtester
          </div>
          <div class="text-lg font-bold text-red-400" id="perfWorstTrade">
           â‚¬0.00
          </div>
         </div>
         <div class="glass-card rounded-xl stat-card text-center">
          <div class="text-2xl mb-2">
           ğŸ”¥
          </div>
          <div class="text-xs mb-1" data-i18n="win_streak">
           Win Streak
          </div>
          <div class="text-lg font-bold text-green-400" id="perfWinStreak">
           0
          </div>
         </div>
         <div class="glass-card rounded-xl stat-card text-center">
          <div class="text-2xl mb-2">
           â„ï¸
          </div>
          <div class="text-xs mb-1" data-i18n="loss_streak">
           Loss Streak
          </div>
          <div class="text-lg font-bold text-red-400" id="perfLossStreak">
           0
          </div>
         </div>
         <div class="glass-card rounded-xl stat-card text-center">
          <div class="text-2xl mb-2">
           ğŸ“ˆ
          </div>
          <div class="text-xs mb-1" data-i18n="avg_win">
           Ã˜ Gewinn
          </div>
          <div class="text-lg font-bold text-green-400" id="perfAvgWin">
           â‚¬0.00
          </div>
         </div>
         <div class="glass-card rounded-xl stat-card text-center">
          <div class="text-2xl mb-2">
           ğŸ“‰
          </div>
          <div class="text-xs mb-1" data-i18n="avg_loss">
           Ã˜ Verlust
          </div>
          <div class="text-lg font-bold text-red-400" id="perfAvgLoss">
           â‚¬0.00
          </div>
         </div>
        </div>
        <div class="glass-card rounded-2xl p-4 mb-4">
         <h3 class="text-lg font-bold mb-4">ğŸ“Š Long vs Short Performance</h3>
         <div class="grid grid-cols-2 gap-3 mb-4">
          <div class="glass-card rounded-xl p-4 text-center" style="background: rgba(59, 130, 246, 0.1);">
           <div class="text-2xl mb-2">
            ğŸ“ˆ
           </div>
           <div class="text-sm font-bold mb-2">
            Long Trades
           </div>
           <div class="text-xs mb-1">
            Anzahl: <span class="font-bold" id="longCount">0</span>
           </div>
           <div class="text-lg font-bold" id="longPL">
            â‚¬0.00
           </div>
           <div class="text-xs mt-1" id="longWinrate">
            0% Winrate
           </div>
          </div>
          <div class="glass-card rounded-xl p-4 text-center" style="background: rgba(249, 115, 22, 0.1);">
           <div class="text-2xl mb-2">
            ğŸ“‰
           </div>
           <div class="text-sm font-bold mb-2">
            Short Trades
           </div>
           <div class="text-xs mb-1">
            Anzahl: <span class="font-bold" id="shortCount">0</span>
           </div>
           <div class="text-lg font-bold" id="shortPL">
            â‚¬0.00
           </div>
           <div class="text-xs mt-1" id="shortWinrate">
            0% Winrate
           </div>
          </div>
         </div>
         <div class="h-64 mb-3">
          <canvas id="longShortChart"></canvas>
         </div>
         <div class="text-center p-3 rounded-lg glass-card">
          <div class="text-xs mb-1">
           Du performst besser bei:
          </div>
          <div class="text-lg font-bold text-purple-400" id="betterPosition">
           --
          </div>
         </div>
        </div>
        <div class="glass-card rounded-2xl p-4 mb-4">
         <h3 class="text-lg font-bold mb-4" data-i18n="streak_overview">Gewinn/Verlust StrÃ¤hnen Ãœbersicht</h3>
         <div class="h-64">
          <canvas id="streakChart"></canvas>
         </div>
        </div>
        <div class="glass-card rounded-2xl p-4 mb-4">
         <h3 class="text-lg font-bold mb-4" data-i18n="distribution">Gewinn/Verlust Verteilung</h3>
         <div class="h-64">
          <canvas id="distributionChart"></canvas>
         </div>
        </div>
        <div class="glass-card rounded-2xl p-4 mb-4">
         <h3 class="text-lg font-bold mb-4" data-i18n="perf_by_strategy">Performance nach Strategie</h3>
         <div class="h-64">
          <canvas id="strategyChart"></canvas>
         </div>
        </div>
        <div class="glass-card rounded-2xl p-4 mb-4">
         <h3 class="text-lg font-bold mb-4" data-i18n="monthly_perf">Monatliche Performance</h3>
         <div class="h-64">
          <canvas id="monthlyChart"></canvas>
         </div>
        </div>
        <div class="glass-card rounded-2xl p-4">
         <h3 class="text-lg font-bold mb-4" data-i18n="perf_by_asset">Performance nach Asset</h3>
         <div class="h-64">
          <canvas id="assetChart"></canvas>
         </div>
        </div>
       </div><!-- Emotionen Tab -->
       <div id="emotionsTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-4 mb-4">
         <h2 class="text-xl font-bold mb-4 flex items-center gap-2"><span>ğŸ˜Š</span> <span data-i18n="emotion_analysis">Emotionsanalyse</span></h2>
         <div class="h-64 mb-4">
          <canvas id="emotionChart"></canvas>
         </div>
        </div>
        <div class="glass-card rounded-2xl p-4">
         <h3 class="text-lg font-bold mb-4" data-i18n="emotion_performance">Performance nach Emotion</h3>
         <div class="h-64">
          <canvas id="emotionPerfChart"></canvas>
         </div>
        </div>
       </div><!-- Zinseszins Tab -->
       <div id="compoundTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-4 sm:p-6 mb-4">
         <h2 class="text-2xl font-bold mb-6 flex items-center gap-2"><span>ğŸ§®</span> <span data-i18n="compound_calculator">Zinseszinsrechner</span></h2>
         <form id="compoundForm" class="space-y-4 mb-6">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
           <div><label class="block text-sm font-bold mb-2" data-i18n="target_amount">Ziel Summe (â‚¬)</label> <input type="number" id="targetAmount" step="0.01" class="w-full px-4 py-3 rounded-xl text-lg font-bold" placeholder="100000" required>
           </div>
           <div><label class="block text-sm font-bold mb-2" data-i18n="monthly_return">Monatliche Rendite (%)</label> <input type="number" id="monthlyReturn" step="0.1" class="w-full px-4 py-3 rounded-xl text-lg font-bold" placeholder="5.0" required>
           </div>
          </div><button type="submit" class="w-full py-4 rounded-xl font-bold text-lg btn-primary"> <span data-i18n="calculate">ğŸ§® Berechnen</span> </button>
         </form>
         <div id="compoundResult" class="hidden"><!-- Performance Overview -->
          <div class="mb-6 p-4 sm:p-6 rounded-2xl" style="background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(59, 130, 246, 0.2));">
           <div class="text-center mb-4">
            <div class="text-sm opacity-80 mb-2" data-i18n="your_pace">
             Dein Tempo
            </div>
            <div class="text-5xl font-bold mb-2" id="paceStatusEmoji">
             ğŸš€
            </div>
            <div class="text-2xl font-bold" id="paceStatus">
             --
            </div>
           </div>
           <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
            <div class="text-center p-3 rounded-xl glass-card">
             <div class="text-xs opacity-70 mb-1" data-i18n="target_reached_in">
              Ziel erreicht in
             </div>
             <div class="text-3xl font-bold text-purple-400" id="monthsToGoal">
              0
             </div>
             <div class="text-xs mt-1" data-i18n="months">
              Monaten
             </div>
            </div>
            <div class="text-center p-3 rounded-xl glass-card">
             <div class="text-xs opacity-70 mb-1" data-i18n="performance_diff">
              Differenz
             </div>
             <div class="text-2xl font-bold" id="performanceDiff">
              â‚¬0.00
             </div>
             <div class="text-xs mt-1 opacity-70">
              zum Plan
             </div>
            </div>
            <div class="text-center p-3 rounded-xl glass-card">
             <div class="text-xs opacity-70 mb-1" data-i18n="vs_plan">
              vs. Plan
             </div>
             <div class="text-2xl font-bold" id="performancePercent">
              0%
             </div>
             <div class="text-xs mt-1 opacity-70">
              Abweichung
             </div>
            </div>
           </div>
          </div><!-- Capital Status -->
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 mb-6">
           <div class="glass-card rounded-xl p-4 text-center">
            <div class="text-xs opacity-70 mb-2">
             Startkapital
            </div>
            <div class="text-xl font-bold" id="compoundStartCapital">
             â‚¬0.00
            </div>
           </div>
           <div class="glass-card rounded-xl p-4 text-center">
            <div class="text-xs opacity-70 mb-2">
             Aktuell
            </div>
            <div class="text-xl font-bold text-blue-400" id="compoundCurrentCapital">
             â‚¬0.00
            </div>
           </div>
           <div class="glass-card rounded-xl p-4 text-center">
            <div class="text-xs opacity-70 mb-2">
             Ziel
            </div>
            <div class="text-xl font-bold text-purple-400" id="compoundTargetCapital">
             â‚¬0.00
            </div>
           </div>
          </div><!-- Chart -->
          <div class="glass-card rounded-xl p-4">
           <h3 class="text-lg font-bold mb-4 flex items-center gap-2"><span>ğŸ“Š</span> <span>Projektion vs. TatsÃ¤chlich</span></h3>
           <div class="h-80">
            <canvas id="compoundChart"></canvas>
           </div>
           <div class="mt-4 flex flex-wrap gap-4 justify-center text-sm">
            <div class="flex items-center gap-2">
             <div class="w-4 h-4 rounded" style="background: #8b5cf6;"></div><span>Projektion (Plan)</span>
            </div>
            <div class="flex items-center gap-2">
             <div class="w-4 h-4 rounded" style="background: #22c55e;"></div><span>TatsÃ¤chlich (Deine Performance)</span>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div><!-- Auszahlungen Tab -->
       <div id="withdrawalsTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-4 mb-4">
         <h2 class="text-xl font-bold mb-4 flex items-center gap-2"><span>ğŸ’¸</span> <span data-i18n="withdrawals">Auszahlungen</span></h2>
         <form id="withdrawalForm" class="space-y-4">
          <div><label class="block text-sm font-bold mb-2" data-i18n="date">Datum</label> <input type="date" id="withdrawalDate" class="w-full px-4 py-3 rounded-xl" required>
          </div>
          <div><label class="block text-sm font-bold mb-2" data-i18n="amount">Betrag (â‚¬)</label> <input type="number" id="withdrawalAmount" step="0.01" class="w-full px-4 py-3 rounded-xl" placeholder="1000" required>
          </div>
          <div><label class="block text-sm font-bold mb-2" data-i18n="notes">Notizen</label> <textarea id="withdrawalNotes" rows="2" class="w-full px-4 py-3 rounded-xl" placeholder="Optional..."></textarea>
          </div><button type="submit" class="w-full py-4 rounded-xl font-bold btn-primary"> <span data-i18n="add_withdrawal">ğŸ’¸ Auszahlung hinzufÃ¼gen</span> </button>
         </form>
        </div>
        <div class="glass-card rounded-2xl p-4">
         <h3 class="text-lg font-bold mb-4" data-i18n="withdrawal_history">Auszahlungshistorie</h3>
         <div id="withdrawalsList" class="space-y-3"></div>
        </div>
       </div><!-- Einzahlungen Tab -->
       <div id="depositsTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-4 mb-4">
         <h2 class="text-xl font-bold mb-4 flex items-center gap-2"><span>ğŸ’°</span> <span data-i18n="deposits">Einzahlungen</span></h2>
         <form id="depositForm" class="space-y-4">
          <div><label class="block text-sm font-bold mb-2" data-i18n="date">Datum</label> <input type="date" id="depositDate" class="w-full px-4 py-3 rounded-xl" required>
          </div>
          <div><label class="block text-sm font-bold mb-2" data-i18n="amount">Betrag (â‚¬)</label> <input type="number" id="depositAmount" step="0.01" class="w-full px-4 py-3 rounded-xl" placeholder="5000" required>
          </div>
          <div><label class="block text-sm font-bold mb-2" data-i18n="notes">Notizen</label> <textarea id="depositNotes" rows="2" class="w-full px-4 py-3 rounded-xl" placeholder="Optional..."></textarea>
          </div><button type="submit" class="w-full py-4 rounded-xl font-bold btn-primary"> <span data-i18n="add_deposit">ğŸ’° Einzahlung hinzufÃ¼gen</span> </button>
         </form>
        </div>
        <div class="glass-card rounded-2xl p-4">
         <h3 class="text-lg font-bold mb-4" data-i18n="deposit_history">Einzahlungshistorie</h3>
         <div id="depositsList" class="space-y-3"></div>
        </div>
       </div><!-- Kalender Tab -->
       <div id="calendarTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-4 mb-4">
         <div class="flex justify-between items-center mb-4">
          <h2 class="text-xl font-bold flex items-center gap-2"><span>ğŸ“…</span> <span id="calendarMonthYear">Januar 2024</span></h2>
          <div class="flex gap-2"><button id="prevMonth" class="p-2 rounded-lg hover:bg-purple-600 hover:bg-opacity-20 transition">â¬…ï¸</button> <button id="nextMonth" class="p-2 rounded-lg hover:bg-purple-600 hover:bg-opacity-20 transition">â¡ï¸</button>
          </div>
         </div>
         <div class="calendar-grid mb-4">
          <div class="text-center font-bold text-xs">
           Mo
          </div>
          <div class="text-center font-bold text-xs">
           Di
          </div>
          <div class="text-center font-bold text-xs">
           Mi
          </div>
          <div class="text-center font-bold text-xs">
           Do
          </div>
          <div class="text-center font-bold text-xs">
           Fr
          </div>
          <div class="text-center font-bold text-xs">
           Sa
          </div>
          <div class="text-center font-bold text-xs">
           So
          </div>
         </div>
         <div class="calendar-grid" id="calendarDays"></div>
        </div>
        <div class="glass-card rounded-2xl p-4">
         <h3 class="text-lg font-bold mb-4" data-i18n="add_event">Termin hinzufÃ¼gen</h3>
         <form id="eventForm" class="space-y-4">
          <div><label class="block text-sm font-bold mb-2" data-i18n="date">Datum</label> <input type="date" id="eventDate" class="w-full px-4 py-3 rounded-xl" required>
          </div>
          <div><label class="block text-sm font-bold mb-2" data-i18n="title">Titel</label> <input type="text" id="eventTitle" class="w-full px-4 py-3 rounded-xl" placeholder="z.B. NFP Daten" required>
          </div>
          <div><label class="block text-sm font-bold mb-2" data-i18n="notes">Notizen</label> <textarea id="eventNotes" rows="2" class="w-full px-4 py-3 rounded-xl"></textarea>
          </div><button type="submit" class="w-full py-4 rounded-xl font-bold btn-primary"> <span data-i18n="add_event">ğŸ“… Termin hinzufÃ¼gen</span> </button>
         </form>
        </div>
       </div><!-- Rechner Tab -->
       <div id="calculatorTab" class="tab-content hidden">
        <div class="glass-card rounded-2xl p-4 mb-4">
         <h3 class="text-lg font-bold mb-4 flex items-center gap-2"><span>ğŸ“</span> <span data-i18n="position_size_calc">PositionsgrÃ¶ÃŸen-Rechner</span></h3>
         <form id="positionSizeForm" class="space-y-4">
          <div><label class="block text-sm font-bold mb-2" data-i18n="account_balance">Kontostand (â‚¬)</label> <input type="number" id="psBalance" step="0.01" class="w-full px-4 py-3 rounded-xl">
          </div>
          <div><label class="block text-sm font-bold mb-2" data-i18n="risk_per_trade">Risiko pro Trade (%)</label> <input type="number" id="psRisk" step="0.1" class="w-full px-4 py-3 rounded-xl" placeholder="1">
          </div>
          <div><label class="block text-sm font-bold mb-2" data-i18n="stop_loss_pips">Stop Loss (Pips)</label> <input type="number" id="psStopLoss" step="0.1" class="w-full px-4 py-3 rounded-xl" placeholder="50">
          </div>
          <div><label class="block text-sm font-bold mb-2" data-i18n="pip_value">Pip-Wert (â‚¬)</label> <input type="number" id="psPipValue" step="0.01" class="w-full px-4 py-3 rounded-xl" placeholder="10">
          </div><button type="submit" class="w-full py-4 rounded-xl font-bold btn-primary"> <span data-i18n="calculate">ğŸ§® Berechnen</span> </button>
          <div id="positionSizeResult" class="mt-6 p-6 rounded-xl hidden glass-card">
           <div class="text-sm mb-2" data-i18n="recommended_position">
            Empfohlene PositionsgrÃ¶ÃŸe
           </div>
           <div class="text-3xl font-bold text-purple-400" id="positionSizeValue">
            0
           </div>
           <div class="text-sm mt-2">
            Lots
           </div>
          </div>
         </form>
        </div>
        <div class="glass-card rounded-2xl p-4">
         <h3 class="text-lg font-bold mb-4 flex items-center gap-2"><span>ğŸ’¹</span> <span data-i18n="pip_calculator">Pip-Rechner</span></h3>
         <form id="pipCalcForm" class="space-y-4">
          <div><label class="block text-sm font-bold mb-2" data-i18n="entry_price">Einstiegspreis</label> <input type="number" id="pipEntry" step="0.00001" class="w-full px-4 py-3 rounded-xl" placeholder="1.08500">
          </div>
          <div><label class="block text-sm font-bold mb-2" data-i18n="exit_price">Ausstiegspreis</label> <input type="number" id="pipExit" step="0.00001" class="w-full px-4 py-3 rounded-xl" placeholder="1.09000">
          </div>
          <div><label class="block text-sm font-bold mb-2" data-i18n="lot_size">Lot GrÃ¶ÃŸe</label> <input type="number" id="pipLotSize" step="0.01" class="w-full px-4 py-3 rounded-xl" placeholder="1">
          </div>
          <div><label class="block text-sm font-bold mb-2" data-i18n="pip_value">Pip-Wert (â‚¬)</label> <input type="number" id="pipValue" step="0.01" class="w-full px-4 py-3 rounded-xl" placeholder="10">
          </div><button type="submit" class="w-full py-4 rounded-xl font-bold btn-primary"> <span data-i18n="calculate">ğŸ§® Berechnen</span> </button>
          <div id="pipCalcResult" class="mt-6 space-y-3 hidden">
           <div class="p-4 rounded-xl glass-card">
            <div class="text-sm mb-2" data-i18n="pips">
             Pips
            </div>
            <div class="text-2xl font-bold text-purple-400" id="pipResultPips">
             0
            </div>
           </div>
           <div class="p-4 rounded-xl glass-card">
            <div class="text-sm mb-2" data-i18n="profit_loss">
             Profit/Loss (â‚¬)
            </div>
            <div class="text-2xl font-bold" id="pipResultPL">
             â‚¬0.00
            </div>
           </div>
          </div>
         </form>
        </div>
       </div>
      </div>
     </main>
    </div><!-- Mobile Bottom Navigation -->
    <nav class="mobile-nav-bottom">
     <div id="mobileNav" class="overflow-x-auto scrollbar-thin">
      <div class="flex py-2 px-2 gap-1 min-w-max"></div>
     </div>
    </nav>
   </div>
  </div><!-- Edit Modal -->
  <div id="editModal" class="fixed inset-0 z-50 hidden items-center justify-center modal-overlay p-4">
   <div class="glass-card rounded-2xl p-4 sm:p-6 max-w-2xl w-full max-h-[90%] overflow-y-auto scrollbar-thin">
    <h3 class="text-xl font-bold mb-4" data-i18n="edit_trade">Trade bearbeiten</h3>
    <form id="editTradeForm" class="space-y-4"><input type="hidden" id="editTradeId">
     <div><label class="block text-sm font-bold mb-2" data-i18n="date">Datum</label> <input type="date" id="editDate" class="w-full px-4 py-3 rounded-xl" required>
     </div>
     <div><label class="block text-sm font-bold mb-2" data-i18n="asset">Asset</label> <select id="editAsset" class="w-full px-4 py-3 rounded-xl"> <option value="">-- Bitte wÃ¤hlen --</option> <option value="EUR/USD">EUR/USD</option> <option value="GBP/USD">GBP/USD</option> <option value="USD/JPY">USD/JPY</option> </select>
     </div>
     <div class="grid grid-cols-2 gap-3">
      <div><label class="block text-sm font-bold mb-2" data-i18n="result">Ergebnis</label> <select id="editResult" class="w-full px-4 py-3 rounded-xl"> <option value="win">âœ… Win</option> <option value="loss">âŒ Loss</option> <option value="breakeven">âš–ï¸ Break Even</option> </select>
      </div>
      <div><label class="block text-sm font-bold mb-2" data-i18n="position">Position</label> <select id="editPosition" class="w-full px-4 py-3 rounded-xl"> <option value="Long">Long</option> <option value="Short">Short</option> </select>
      </div>
     </div>
     <div><label class="block text-sm font-bold mb-2" data-i18n="profit_loss">P/L (â‚¬)</label> <input type="number" id="editProfitLoss" step="0.01" class="w-full px-4 py-3 rounded-xl">
     </div>
     <div class="grid grid-cols-2 gap-3">
      <div><label class="block text-sm font-bold mb-2" data-i18n="entry_price">Einstiegspreis</label> <input type="number" id="editEntry" step="0.00001" class="w-full px-4 py-3 rounded-xl">
      </div>
      <div><label class="block text-sm font-bold mb-2" data-i18n="exit_price">Ausstiegspreis</label> <input type="number" id="editExit" step="0.00001" class="w-full px-4 py-3 rounded-xl">
      </div>
     </div>
     <div><label class="block text-sm font-bold mb-2" data-i18n="strategy">Strategie</label> <input type="text" id="editStrategy" class="w-full px-4 py-3 rounded-xl">
     </div>
     <div><label class="block text-sm font-bold mb-2" data-i18n="emotion">Emotion</label> <select id="editEmotion" class="w-full px-4 py-3 rounded-xl"> <option value="">-- Optional --</option> <option value="confident">ğŸ˜ Confident</option> <option value="calm">ğŸ˜Œ Calm</option> <option value="excited">ğŸ¤© Excited</option> <option value="anxious">ğŸ˜° Anxious</option> <option value="frustrated">ğŸ˜¤ Frustrated</option> <option value="greedy">ğŸ¤‘ Greedy</option> <option value="fearful">ğŸ˜¨ Fearful</option> <option value="euphoric">ğŸ¥³ Euphoric</option> <option value="disciplined">ğŸ§˜ Disciplined</option> <option value="revenge">ğŸ˜¡ Revenge Trading</option> </select>
     </div>
     <div><label class="block text-sm font-bold mb-2" data-i18n="notes">Notizen</label> <textarea id="editNotes" rows="3" class="w-full px-4 py-3 rounded-xl"></textarea>
     </div>
     <div class="flex gap-3"><button type="submit" class="flex-1 py-3 rounded-xl font-bold btn-primary"> <span data-i18n="save">ğŸ’¾ Speichern</span> </button> <button type="button" id="cancelEdit" class="flex-1 py-3 rounded-xl font-bold hover:bg-opacity-70 transition" style="background: var(--bg-secondary);"> <span data-i18n="cancel">âŒ Abbrechen</span> </button>
     </div>
    </form>
   </div>
  </div>
  <script>
        // Translations
        const translations = {
            de: {
                trading_journal_pro: 'Trading Journal Pro',
                email: 'E-Mail',
                password: 'Passwort',
                login: 'Anmelden',
                register: 'Noch kein Konto? Registrieren',
                demo_note: 'Demo-Modus: Beliebige E-Mail verwenden',
                logout: 'Abmelden',
                capital: 'Kapital',
                dashboard: 'Dashboard',
                new_trade: 'Neuer Trade',
                history: 'Historie',
                performance: 'Performance',
                emotions: 'Emotionen',
                compound: 'Zinseszins',
                withdrawals: 'Auszahlungen',
                deposits: 'Einzahlungen',
                calendar: 'Kalender',
                calculator: 'Rechner',
                financial_overview: 'FinanzÃ¼bersicht',
                start_capital: 'Startkapital',
                current_capital: 'Aktuelles Kapital',
                total_pl: 'Gesamt P/L',
                winrate: 'Winrate',
                trades: 'Trades',
                equity_curve: 'Equity Curve',
                current_performance: 'Deine aktuelle Performance',
                best_trade: 'Bester Trade',
                worst_trade: 'Schlechtester Trade',
                date: 'Datum',
                asset: 'Asset',
                result: 'Ergebnis',
                position: 'Position',
                profit_loss: 'Profit/Loss',
                entry_price: 'Einstiegspreis',
                exit_price: 'Ausstiegspreis',
                strategy: 'Strategie',
                emotion: 'Emotion',
                notes: 'Notizen',
                save_trade: 'ğŸ’¾ Trade speichern',
                save: 'ğŸ’¾ Speichern',
                all_results: 'Alle Ergebnisse',
                win_streak: 'Win Streak',
                loss_streak: 'Loss Streak',
                avg_win: 'Ã˜ Gewinn',
                avg_loss: 'Ã˜ Verlust',
                streak_overview: 'Gewinn/Verlust StrÃ¤hnen Ãœbersicht',
                distribution: 'Gewinn/Verlust Verteilung',
                perf_by_strategy: 'Performance nach Strategie',
                monthly_perf: 'Monatliche Performance',
                perf_by_asset: 'Performance nach Asset',
                emotion_analysis: 'Emotionsanalyse',
                emotion_performance: 'Performance nach Emotion',
                compound_calculator: 'Zinseszinsrechner',
                target_amount: 'Ziel Summe',
                monthly_return: 'Monatliche Rendite',
                calculate: 'ğŸ§® Berechnen',
                target_reached_in: 'Ziel erreicht in',
                months: 'Monaten',
                your_pace: 'Dein Tempo',
                performance_diff: 'Differenz',
                vs_plan: 'vs. Plan',
                add_withdrawal: 'ğŸ’¸ Auszahlung hinzufÃ¼gen',
                withdrawal_history: 'Auszahlungshistorie',
                add_deposit: 'ğŸ’° Einzahlung hinzufÃ¼gen',
                deposit_history: 'Einzahlungshistorie',
                amount: 'Betrag',
                add_event: 'ğŸ“… Termin hinzufÃ¼gen',
                title: 'Titel',
                position_size_calc: 'PositionsgrÃ¶ÃŸen-Rechner',
                account_balance: 'Kontostand',
                risk_per_trade: 'Risiko pro Trade',
                stop_loss_pips: 'Stop Loss (Pips)',
                pip_value: 'Pip-Wert',
                recommended_position: 'Empfohlene PositionsgrÃ¶ÃŸe',
                pip_calculator: 'Pip-Rechner',
                lot_size: 'Lot GrÃ¶ÃŸe',
                pips: 'Pips',
                edit_trade: 'Trade bearbeiten',
                cancel: 'âŒ Abbrechen',
                faster: 'ğŸš€ Schneller',
                slower: 'ğŸŒ Langsamer',
                on_track: 'âœ… Im Plan'
            },
            en: {
                trading_journal_pro: 'Trading Journal Pro',
                email: 'Email',
                password: 'Password',
                login: 'Login',
                register: 'No account? Register',
                demo_note: 'Demo Mode: Use any email',
                logout: 'Logout',
                capital: 'Capital',
                dashboard: 'Dashboard',
                new_trade: 'New Trade',
                history: 'History',
                performance: 'Performance',
                emotions: 'Emotions',
                compound: 'Compound',
                withdrawals: 'Withdrawals',
                deposits: 'Deposits',
                calendar: 'Calendar',
                calculator: 'Calculator',
                financial_overview: 'Financial Overview',
                start_capital: 'Start Capital',
                current_capital: 'Current Capital',
                total_pl: 'Total P/L',
                winrate: 'Winrate',
                trades: 'Trades',
                equity_curve: 'Equity Curve',
                current_performance: 'Your Current Performance',
                best_trade: 'Best Trade',
                worst_trade: 'Worst Trade',
                date: 'Date',
                asset: 'Asset',
                result: 'Result',
                position: 'Position',
                profit_loss: 'Profit/Loss',
                entry_price: 'Entry Price',
                exit_price: 'Exit Price',
                strategy: 'Strategy',
                emotion: 'Emotion',
                notes: 'Notes',
                save_trade: 'ğŸ’¾ Save Trade',
                save: 'ğŸ’¾ Save',
                all_results: 'All Results',
                win_streak: 'Win Streak',
                loss_streak: 'Loss Streak',
                avg_win: 'Avg Win',
                avg_loss: 'Avg Loss',
                streak_overview: 'Win/Loss Streak Overview',
                distribution: 'Win/Loss Distribution',
                perf_by_strategy: 'Performance by Strategy',
                monthly_perf: 'Monthly Performance',
                perf_by_asset: 'Performance by Asset',
                emotion_analysis: 'Emotion Analysis',
                emotion_performance: 'Performance by Emotion',
                compound_calculator: 'Compound Calculator',
                target_amount: 'Target Amount',
                monthly_return: 'Monthly Return',
                calculate: 'ğŸ§® Calculate',
                target_reached_in: 'Target reached in',
                months: 'Months',
                your_pace: 'Your Pace',
                performance_diff: 'Difference',
                vs_plan: 'vs. Plan',
                add_withdrawal: 'ğŸ’¸ Add Withdrawal',
                withdrawal_history: 'Withdrawal History',
                add_deposit: 'ğŸ’° Add Deposit',
                deposit_history: 'Deposit History',
                amount: 'Amount',
                add_event: 'ğŸ“… Add Event',
                title: 'Title',
                position_size_calc: 'Position Size Calculator',
                account_balance: 'Account Balance',
                risk_per_trade: 'Risk per Trade',
                stop_loss_pips: 'Stop Loss (Pips)',
                pip_value: 'Pip Value',
                recommended_position: 'Recommended Position Size',
                pip_calculator: 'Pip Calculator',
                lot_size: 'Lot Size',
                pips: 'Pips',
                edit_trade: 'Edit Trade',
                cancel: 'âŒ Cancel',
                faster: 'ğŸš€ Faster',
                slower: 'ğŸŒ Slower',
                on_track: 'âœ… On Track'
            },
            es: {
                trading_journal_pro: 'Diario de Trading Pro',
                email: 'Correo electrÃ³nico',
                password: 'ContraseÃ±a',
                login: 'Iniciar sesiÃ³n',
                register: 'Â¿No tienes cuenta? RegÃ­strate',
                demo_note: 'Modo Demo: Usa cualquier correo',
                logout: 'Cerrar sesiÃ³n',
                capital: 'Capital',
                dashboard: 'Panel',
                new_trade: 'Nueva OperaciÃ³n',
                history: 'Historial',
                performance: 'Rendimiento',
                emotions: 'Emociones',
                compound: 'InterÃ©s Compuesto',
                withdrawals: 'Retiros',
                deposits: 'DepÃ³sitos',
                calendar: 'Calendario',
                calculator: 'Calculadora',
                financial_overview: 'Resumen Financiero',
                start_capital: 'Capital Inicial',
                current_capital: 'Capital Actual',
                total_pl: 'P/L Total',
                winrate: 'Tasa de Ã‰xito',
                trades: 'Operaciones',
                equity_curve: 'Curva de Capital',
                current_performance: 'Tu Rendimiento Actual',
                best_trade: 'Mejor OperaciÃ³n',
                worst_trade: 'Peor OperaciÃ³n',
                date: 'Fecha',
                asset: 'Activo',
                result: 'Resultado',
                position: 'PosiciÃ³n',
                profit_loss: 'Ganancia/PÃ©rdida',
                entry_price: 'Precio de Entrada',
                exit_price: 'Precio de Salida',
                strategy: 'Estrategia',
                emotion: 'EmociÃ³n',
                notes: 'Notas',
                save_trade: 'ğŸ’¾ Guardar OperaciÃ³n',
                save: 'ğŸ’¾ Guardar',
                all_results: 'Todos los Resultados',
                win_streak: 'Racha de Ganancias',
                loss_streak: 'Racha de PÃ©rdidas',
                avg_win: 'Ganancia Promedio',
                avg_loss: 'PÃ©rdida Promedio',
                streak_overview: 'Resumen de Rachas',
                distribution: 'DistribuciÃ³n de Ganancias/PÃ©rdidas',
                perf_by_strategy: 'Rendimiento por Estrategia',
                monthly_perf: 'Rendimiento Mensual',
                perf_by_asset: 'Rendimiento por Activo',
                emotion_analysis: 'AnÃ¡lisis de Emociones',
                emotion_performance: 'Rendimiento por EmociÃ³n',
                compound_calculator: 'Calculadora de InterÃ©s Compuesto',
                target_amount: 'Cantidad Objetivo',
                monthly_return: 'Rendimiento Mensual',
                calculate: 'ğŸ§® Calcular',
                target_reached_in: 'Objetivo alcanzado en',
                months: 'Meses',
                your_pace: 'Tu Ritmo',
                performance_diff: 'Diferencia',
                vs_plan: 'vs. Plan',
                add_withdrawal: 'ğŸ’¸ Agregar Retiro',
                withdrawal_history: 'Historial de Retiros',
                add_deposit: 'ğŸ’° Agregar DepÃ³sito',
                deposit_history: 'Historial de DepÃ³sitos',
                amount: 'Cantidad',
                add_event: 'ğŸ“… Agregar Evento',
                title: 'TÃ­tulo',
                position_size_calc: 'Calculadora de TamaÃ±o de PosiciÃ³n',
                account_balance: 'Saldo de Cuenta',
                risk_per_trade: 'Riesgo por OperaciÃ³n',
                stop_loss_pips: 'Stop Loss (Pips)',
                pip_value: 'Valor del Pip',
                recommended_position: 'TamaÃ±o de PosiciÃ³n Recomendado',
                pip_calculator: 'Calculadora de Pips',
                lot_size: 'TamaÃ±o de Lote',
                pips: 'Pips',
                edit_trade: 'Editar OperaciÃ³n',
                cancel: 'âŒ Cancelar',
                faster: 'ğŸš€ MÃ¡s RÃ¡pido',
                slower: 'ğŸŒ MÃ¡s Lento',
                on_track: 'âœ… En Camino'
            }
        };

        let currentLang = 'de';
        
        function updateLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
            localStorage.setItem('tradingJournalLang', lang);
        }

        // Data Storage
        let trades = JSON.parse(localStorage.getItem('tradingJournalTrades') || '[]');
        let startCapital = parseFloat(localStorage.getItem('tradingJournalStartCapital') || '0');
        let withdrawals = JSON.parse(localStorage.getItem('tradingJournalWithdrawals') || '[]');
        let deposits = JSON.parse(localStorage.getItem('tradingJournalDeposits') || '[]');
        let events = JSON.parse(localStorage.getItem('tradingJournalEvents') || '[]');
        let currentUser = null;
        let currentTheme = localStorage.getItem('tradingJournalTheme') || 'dark';
        let currentCalendarDate = new Date();
        
        const charts = {};
        const menuItems = [
            { id: 'dashboard', icon: 'ğŸ“Š', label: 'dashboard' },
            { id: 'newtrade', icon: 'â•', label: 'new_trade' },
            { id: 'history', icon: 'ğŸ“œ', label: 'history' },
            { id: 'performance', icon: 'ğŸ“ˆ', label: 'performance' },
            { id: 'emotions', icon: 'ğŸ˜Š', label: 'emotions' },
            { id: 'compound', icon: 'ğŸ§®', label: 'compound' },
            { id: 'withdrawals', icon: 'ğŸ’¸', label: 'withdrawals' },
            { id: 'deposits', icon: 'ğŸ’°', label: 'deposits' },
            { id: 'calendar', icon: 'ğŸ“…', label: 'calendar' },
            { id: 'calculator', icon: 'ğŸ”¢', label: 'calculator' }
        ];

        // Helper Functions
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function formatCurrency(value) {
            return 'â‚¬' + value.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString(currentLang === 'de' ? 'de-DE' : currentLang === 'es' ? 'es-ES' : 'en-US', { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric' 
            });
        }

        function saveTrades() {
            localStorage.setItem('tradingJournalTrades', JSON.stringify(trades));
        }

        function saveStartCapital() {
            localStorage.setItem('tradingJournalStartCapital', startCapital.toString());
        }

        function saveWithdrawals() {
            localStorage.setItem('tradingJournalWithdrawals', JSON.stringify(withdrawals));
        }

        function saveDeposits() {
            localStorage.setItem('tradingJournalDeposits', JSON.stringify(deposits));
        }

        function saveEvents() {
            localStorage.setItem('tradingJournalEvents', JSON.stringify(events));
        }

        function calculateCurrentCapital() {
            let capital = startCapital;
            
            // Add deposits
            deposits.forEach(d => {
                capital += d.amount;
            });
            
            // Add trade P/L
            trades.forEach(t => {
                capital += t.profitLoss;
            });
            
            // Subtract withdrawals
            withdrawals.forEach(w => {
                capital -= w.amount;
            });
            
            return capital;
        }

        // Theme Toggle
        function toggleTheme() {
            currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', currentTheme);
            localStorage.setItem('tradingJournalTheme', currentTheme);
            document.getElementById('themeIcon').textContent = currentTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
            if (document.getElementById('themeToggleLogin')) {
                document.querySelector('#themeToggleLogin span').textContent = currentTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
            }
            
            // Recreate charts with new theme
            Object.keys(charts).forEach(key => {
                if (charts[key]) charts[key].destroy();
            });
            updateDashboard();
            if (document.getElementById('performanceTab').classList.contains('hidden') === false) {
                renderPerformance();
            }
            if (document.getElementById('emotionsTab').classList.contains('hidden') === false) {
                renderEmotions();
            }
        }

        // Navigation
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.getElementById(tabName + 'Tab').classList.remove('hidden');
            
            // Update desktop nav
            document.querySelectorAll('.nav-button').forEach(btn => {
                btn.classList.remove('nav-btn-active');
            });
            const activeBtn = document.querySelector(`.nav-button[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('nav-btn-active');
            }
            
            // Update mobile nav
            document.querySelectorAll('.mobile-nav-btn').forEach(btn => {
                btn.classList.remove('nav-btn-active');
            });
            const activeMobileBtn = document.querySelector(`.mobile-nav-btn[data-tab="${tabName}"]`);
            if (activeMobileBtn) {
                activeMobileBtn.classList.add('nav-btn-active');
            }

            // Update content based on tab
            if (tabName === 'performance') {
                setTimeout(() => renderPerformance(), 100);
            } else if (tabName === 'emotions') {
                setTimeout(() => renderEmotions(), 100);
            } else if (tabName === 'calendar') {
                setTimeout(() => renderCalendar(), 100);
            } else if (tabName === 'withdrawals') {
                renderWithdrawals();
            } else if (tabName === 'deposits') {
                renderDeposits();
            }
        }

        function renderNavigation() {
            const desktopNav = document.getElementById('desktopNav');
            const mobileNavContainer = document.querySelector('#mobileNav > div');
            
            desktopNav.innerHTML = '';
            mobileNavContainer.innerHTML = '';
            
            menuItems.forEach((item, index) => {
                // Desktop
                const desktopBtn = document.createElement('button');
                desktopBtn.className = `nav-button w-full text-left px-4 py-3 rounded-xl font-bold transition text-sm flex items-center gap-3 ${index === 0 ? 'nav-btn-active' : ''}`;
                desktopBtn.setAttribute('data-tab', item.id);
                desktopBtn.innerHTML = `<span class="text-xl">${item.icon}</span><span data-i18n="${item.label}">${translations[currentLang][item.label]}</span>`;
                desktopBtn.addEventListener('click', () => switchTab(item.id));
                desktopNav.appendChild(desktopBtn);
                
                // Mobile
                const mobileBtn = document.createElement('button');
                mobileBtn.className = `mobile-nav-btn flex flex-col items-center gap-1 p-2 px-3 rounded-lg transition ${index === 0 ? 'nav-btn-active' : ''}`;
                mobileBtn.setAttribute('data-tab', item.id);
                mobileBtn.innerHTML = `<span class="text-xl">${item.icon}</span><span class="text-xs font-semibold whitespace-nowrap" data-i18n="${item.label}">${translations[currentLang][item.label]}</span>`;
                mobileBtn.addEventListener('click', () => switchTab(item.id));
                mobileNavContainer.appendChild(mobileBtn);
            });
        }

        // Login/Auth (Demo Mode)
        document.getElementById('loginForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            currentUser = { email };
            
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            
            renderNavigation();
            updateDashboard();
            showToast('âœ… ' + (currentLang === 'de' ? 'Angemeldet' : currentLang === 'es' ? 'SesiÃ³n iniciada' : 'Logged in'));
        });

        document.getElementById('registerToggle').addEventListener('click', () => {
            showToast('â„¹ï¸ ' + (currentLang === 'de' ? 'Demo-Modus aktiv' : currentLang === 'es' ? 'Modo demo activo' : 'Demo mode active'));
        });

        // Menu
        const menuBtn = document.getElementById('menuBtn');
        const menuOverlay = document.getElementById('menuOverlay');
        const mobileMenu = document.getElementById('mobileMenu');

        menuBtn.addEventListener('click', () => {
            const isHidden = mobileMenu.classList.contains('hidden');
            if (isHidden) {
                mobileMenu.classList.remove('hidden');
                menuOverlay.classList.remove('hidden');
            } else {
                mobileMenu.classList.add('hidden');
                menuOverlay.classList.add('hidden');
            }
        });

        menuOverlay.addEventListener('click', () => {
            mobileMenu.classList.add('hidden');
            menuOverlay.classList.add('hidden');
        });

        document.querySelectorAll('.mobile-menu-item').forEach(item => {
            item.addEventListener('click', () => {
                const action = item.dataset.action;
                mobileMenu.classList.add('hidden');
                menuOverlay.classList.add('hidden');
                
                if (action === 'logout') {
                    currentUser = null;
                    document.getElementById('mainApp').classList.add('hidden');
                    document.getElementById('loginScreen').classList.remove('hidden');
                    showToast('ğŸ‘‹ ' + translations[currentLang].logout);
                }
            });
        });

        // Theme Toggle
        document.getElementById('themeToggle').addEventListener('click', toggleTheme);
        if (document.getElementById('themeToggleLogin')) {
            document.getElementById('themeToggleLogin').addEventListener('click', toggleTheme);
        }

        // Language
        document.getElementById('langSelector').addEventListener('change', (e) => {
            updateLanguage(e.target.value);
            renderNavigation();
            updateDashboard();
            renderHistory();
        });

        document.getElementById('langSelectorLogin').addEventListener('change', (e) => {
            updateLanguage(e.target.value);
        });

        // Start Capital
        document.getElementById('saveStartCapital').addEventListener('click', () => {
            const value = parseFloat(document.getElementById('startCapitalInput').value);
            if (value > 0) {
                startCapital = value;
                saveStartCapital();
                updateDashboard();
                showToast('âœ… ' + translations[currentLang].save);
            }
        });

        // New Trade Form
        document.getElementById('newTradeForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const profitLoss = parseFloat(document.getElementById('tradeProfitLoss').value) || 0;
            const result = document.getElementById('tradeResult').value;
            
            // If result is loss and profit is positive, make it negative
            let finalPL = profitLoss;
            if (result === 'loss' && profitLoss > 0) {
                finalPL = -Math.abs(profitLoss);
            } else if (result === 'loss' && profitLoss >= 0) {
                finalPL = -Math.abs(profitLoss);
            }
            
            const trade = {
                id: Date.now().toString(),
                date: document.getElementById('tradeDate').value,
                asset: document.getElementById('tradeAsset').value,
                result: result,
                profitLoss: finalPL,
                position: document.getElementById('tradePosition').value,
                entryPrice: parseFloat(document.getElementById('tradeEntry').value) || null,
                exitPrice: parseFloat(document.getElementById('tradeExit').value) || null,
                strategy: document.getElementById('tradeStrategy').value,
                emotion: document.getElementById('tradeEmotion').value,
                notes: document.getElementById('tradeNotes').value
            };

            trades.unshift(trade);
            saveTrades();
            updateDashboard();
            renderHistory();
            
            document.getElementById('newTradeForm').reset();
            document.getElementById('tradeDate').value = new Date().toISOString().split('T')[0];
            
            showToast('âœ… ' + translations[currentLang].save_trade);
        });

        // Filter
        document.getElementById('filterResult').addEventListener('change', renderHistory);

        // Edit & Delete
        window.editTrade = function(id) {
            const trade = trades.find(t => t.id === id);
            if (!trade) return;

            document.getElementById('editTradeId').value = trade.id;
            document.getElementById('editDate').value = trade.date;
            document.getElementById('editAsset').value = trade.asset;
            document.getElementById('editResult').value = trade.result;
            document.getElementById('editProfitLoss').value = trade.profitLoss;
            document.getElementById('editPosition').value = trade.position;
            document.getElementById('editEntry').value = trade.entryPrice || '';
            document.getElementById('editExit').value = trade.exitPrice || '';
            document.getElementById('editStrategy').value = trade.strategy || '';
            document.getElementById('editEmotion').value = trade.emotion || '';
            document.getElementById('editNotes').value = trade.notes || '';

            document.getElementById('editModal').classList.remove('hidden');
            document.getElementById('editModal').style.display = 'flex';
        };

        window.deleteTrade = function(id) {
            const confirmMsg = currentLang === 'de' ? 'Trade wirklich lÃ¶schen?' : currentLang === 'es' ? 'Â¿Eliminar operaciÃ³n?' : 'Delete trade?';
            const toast = document.createElement('div');
            toast.className = 'glass-card rounded-xl p-4 fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-[10001] w-80';
            toast.innerHTML = `
                <p class="mb-4 text-center font-bold">${confirmMsg}</p>
                <div class="flex gap-3">
                    <button class="flex-1 py-2 rounded-lg bg-red-500 hover:bg-red-600 font-bold" onclick="confirmDeleteTrade('${id}')">âœ“</button>
                    <button class="flex-1 py-2 rounded-lg hover:bg-opacity-70 font-bold" style="background: var(--bg-secondary);" onclick="this.closest('.glass-card').remove(); document.getElementById('deleteOverlay').remove();">âœ—</button>
                </div>
            `;
            
            const overlay = document.createElement('div');
            overlay.id = 'deleteOverlay';
            overlay.className = 'fixed inset-0 bg-black bg-opacity-50 z-[10000]';
            overlay.onclick = () => {
                overlay.remove();
                toast.remove();
            };
            
            document.body.appendChild(overlay);
            document.body.appendChild(toast);
        };

        window.confirmDeleteTrade = function(id) {
            trades = trades.filter(t => t.id !== id);
            saveTrades();
            updateDashboard();
            renderHistory();
            document.getElementById('deleteOverlay').remove();
            document.querySelectorAll('.glass-card').forEach(el => {
                if (el.textContent.includes('âœ“') && el.textContent.includes('âœ—')) {
                    el.remove();
                }
            });
            showToast('ğŸ—‘ï¸ ' + (currentLang === 'de' ? 'GelÃ¶scht' : currentLang === 'es' ? 'Eliminado' : 'Deleted'));
        };

        document.getElementById('editTradeForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const id = document.getElementById('editTradeId').value;
            const tradeIndex = trades.findIndex(t => t.id === id);
            
            if (tradeIndex !== -1) {
                const profitLoss = parseFloat(document.getElementById('editProfitLoss').value) || 0;
                const result = document.getElementById('editResult').value;
                
                let finalPL = profitLoss;
                if (result === 'loss' && profitLoss > 0) {
                    finalPL = -Math.abs(profitLoss);
                }
                
                trades[tradeIndex] = {
                    ...trades[tradeIndex],
                    date: document.getElementById('editDate').value,
                    asset: document.getElementById('editAsset').value,
                    result: result,
                    profitLoss: finalPL,
                    position: document.getElementById('editPosition').value,
                    entryPrice: parseFloat(document.getElementById('editEntry').value) || null,
                    exitPrice: parseFloat(document.getElementById('editExit').value) || null,
                    strategy: document.getElementById('editStrategy').value,
                    emotion: document.getElementById('editEmotion').value,
                    notes: document.getElementById('editNotes').value
                };

                saveTrades();
                updateDashboard();
                renderHistory();
                
                document.getElementById('editModal').classList.add('hidden');
                document.getElementById('editModal').style.display = 'none';
                
                showToast('âœ… ' + translations[currentLang].save);
            }
        });

        document.getElementById('cancelEdit').addEventListener('click', () => {
            document.getElementById('editModal').classList.add('hidden');
            document.getElementById('editModal').style.display = 'none';
        });

        // Calculators
        document.getElementById('positionSizeForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const balance = parseFloat(document.getElementById('psBalance').value) || 0;
            const risk = parseFloat(document.getElementById('psRisk').value) || 0;
            const stopLoss = parseFloat(document.getElementById('psStopLoss').value) || 0;
            const pipValue = parseFloat(document.getElementById('psPipValue').value) || 0;

            if (balance > 0 && risk > 0 && stopLoss > 0 && pipValue > 0) {
                const riskAmount = balance * (risk / 100);
                const positionSize = riskAmount / (stopLoss * pipValue);
                
                document.getElementById('positionSizeResult').classList.remove('hidden');
                document.getElementById('positionSizeValue').textContent = positionSize.toFixed(2);
            }
        });

        document.getElementById('pipCalcForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const entry = parseFloat(document.getElementById('pipEntry').value) || 0;
            const exit = parseFloat(document.getElementById('pipExit').value) || 0;
            const lotSize = parseFloat(document.getElementById('pipLotSize').value) || 0;
            const pipValue = parseFloat(document.getElementById('pipValue').value) || 0;

            if (entry > 0 && exit > 0 && lotSize > 0 && pipValue > 0) {
                const pips = Math.abs(exit - entry) * 10000;
                const pl = pips * pipValue * lotSize * (exit > entry ? 1 : -1);
                
                document.getElementById('pipCalcResult').classList.remove('hidden');
                document.getElementById('pipResultPips').textContent = pips.toFixed(1);
                document.getElementById('pipResultPL').textContent = formatCurrency(pl);
                document.getElementById('pipResultPL').className = pl >= 0 ? 'text-2xl font-bold text-green-400' : 'text-2xl font-bold text-red-400';
            }
        });

        // Compound Calculator
        document.getElementById('compoundForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const target = parseFloat(document.getElementById('targetAmount').value);
            const monthlyReturn = parseFloat(document.getElementById('monthlyReturn').value) / 100;
            const currentCapital = calculateCurrentCapital();
            
            if (target > currentCapital && monthlyReturn > 0) {
                let months = 0;
                let capital = currentCapital;
                const projectedData = [capital];
                
                while (capital < target && months < 240) {
                    capital = capital * (1 + monthlyReturn);
                    projectedData.push(capital);
                    months++;
                }
                
                // Calculate actual performance with all transactions
                const sortedTrades = [...trades].sort((a, b) => new Date(a.date) - new Date(b.date));
                
                // Build complete transaction timeline
                const allTransactions = [
                    ...deposits.map(d => ({ date: d.date, amount: d.amount, type: 'deposit' })),
                    ...sortedTrades.map(t => ({ date: t.date, amount: t.profitLoss, type: 'trade' })),
                    ...withdrawals.map(w => ({ date: w.date, amount: -w.amount, type: 'withdrawal' }))
                ].sort((a, b) => new Date(a.date) - new Date(b.date));
                
                // Calculate actual capital progression month by month
                const actualData = [startCapital];
                
                // Get start date
                const startDate = allTransactions.length > 0 ? new Date(allTransactions[0].date) : new Date();
                const today = new Date();
                
                // Calculate months elapsed
                const monthsElapsed = allTransactions.length > 0 ? 
                    Math.max(1, Math.floor((today - startDate) / (1000 * 60 * 60 * 24 * 30))) : 0;
                
                // Build actual data for each month
                for (let i = 0; i < Math.min(monthsElapsed + 1, months + 10); i++) {
                    const monthDate = new Date(startDate);
                    monthDate.setMonth(monthDate.getMonth() + i);
                    
                    // Add all transactions up to this month
                    const transactionsUpToMonth = allTransactions.filter(t => {
                        const transDate = new Date(t.date);
                        return transDate <= monthDate;
                    });
                    
                    let monthCapital = startCapital;
                    transactionsUpToMonth.forEach(t => {
                        monthCapital += t.amount;
                    });
                    
                    actualData.push(monthCapital);
                }
                
                // Current performance metrics
                const expectedCapital = startCapital * Math.pow(1 + monthlyReturn, monthsElapsed);
                const actualCapital = currentCapital;
                const performanceDiff = actualCapital - expectedCapital;
                const performancePercent = expectedCapital > 0 ? ((actualCapital / expectedCapital - 1) * 100) : 0;
                
                let performance, performanceEmoji;
                if (actualCapital >= expectedCapital * 1.05) {
                    performance = 'faster';
                    performanceEmoji = 'ğŸš€';
                } else if (actualCapital >= expectedCapital * 0.95) {
                    performance = 'on_track';
                    performanceEmoji = 'âœ…';
                } else {
                    performance = 'slower';
                    performanceEmoji = 'ğŸŒ';
                }
                
                // Update UI
                document.getElementById('compoundResult').classList.remove('hidden');
                document.getElementById('monthsToGoal').textContent = months;
                document.getElementById('paceStatus').textContent = translations[currentLang][performance];
                document.getElementById('paceStatusEmoji').textContent = performanceEmoji;
                
                document.getElementById('paceStatus').className = performance === 'faster' ? 'text-2xl font-bold text-green-400' : 
                    performance === 'on_track' ? 'text-2xl font-bold text-blue-400' : 'text-2xl font-bold text-yellow-400';
                
                // Capital status
                document.getElementById('compoundStartCapital').textContent = formatCurrency(startCapital);
                document.getElementById('compoundCurrentCapital').textContent = formatCurrency(currentCapital);
                document.getElementById('compoundTargetCapital').textContent = formatCurrency(target);
                
                // Performance difference display
                document.getElementById('performanceDiff').textContent = formatCurrency(Math.abs(performanceDiff));
                document.getElementById('performanceDiff').className = performanceDiff >= 0 ? 'text-2xl font-bold text-green-400' : 'text-2xl font-bold text-red-400';
                document.getElementById('performancePercent').textContent = (performanceDiff >= 0 ? '+' : '') + performancePercent.toFixed(1) + '%';
                document.getElementById('performancePercent').className = performanceDiff >= 0 ? 'text-2xl font-bold text-green-400' : 'text-2xl font-bold text-red-400';
                
                // Chart
                if (charts.compound) charts.compound.destroy();
                const ctx = document.getElementById('compoundChart').getContext('2d');
                
                const maxMonths = Math.min(months + 1, 60);
                const labels = Array.from({length: maxMonths}, (_, i) => i);
                const textColor = currentTheme === 'dark' ? '#ffffff' : '#0f172a';
                const gridColor = currentTheme === 'dark' ? 'rgba(255, 255, 255, 0.1)' : 'rgba(15, 23, 42, 0.15)';
                
                // Pad actual data with nulls if needed
                const paddedActualData = [...actualData];
                while (paddedActualData.length < maxMonths) {
                    paddedActualData.push(null);
                }
                
                charts.compound = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Projektion',
                                data: projectedData.slice(0, maxMonths),
                                borderColor: '#8b5cf6',
                                backgroundColor: 'rgba(139, 92, 246, 0.1)',
                                borderWidth: 2,
                                fill: true
                            },
                            {
                                label: 'TatsÃ¤chlich',
                                data: paddedActualData,
                                borderColor: '#22c55e',
                                backgroundColor: 'rgba(34, 197, 94, 0.1)',
                                borderWidth: 3,
                                fill: true,
                                spanGaps: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { 
                                labels: { 
                                    color: textColor,
                                    font: { size: 14, weight: 'bold' }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        return context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                    }
                                }
                            }
                        },
                        scales: {
                            x: { 
                                title: { display: true, text: 'Monate', color: textColor, font: { size: 14, weight: 'bold' } },
                                ticks: { color: textColor }, 
                                grid: { color: gridColor } 
                            },
                            y: { 
                                ticks: { 
                                    color: textColor, 
                                    callback: (v) => 'â‚¬' + v.toFixed(0),
                                    font: { size: 12 }
                                }, 
                                grid: { color: gridColor } 
                            }
                        }
                    }
                });
            }
        });

        // Withdrawals
        document.getElementById('withdrawalForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const withdrawal = {
                id: Date.now().toString(),
                date: document.getElementById('withdrawalDate').value,
                amount: parseFloat(document.getElementById('withdrawalAmount').value),
                notes: document.getElementById('withdrawalNotes').value
            };
            
            withdrawals.unshift(withdrawal);
            saveWithdrawals();
            updateDashboard();
            renderWithdrawals();
            
            document.getElementById('withdrawalForm').reset();
            document.getElementById('withdrawalDate').value = new Date().toISOString().split('T')[0];
            
            showToast('ğŸ’¸ ' + translations[currentLang].add_withdrawal);
        });

        function renderWithdrawals() {
            const container = document.getElementById('withdrawalsList');
            if (withdrawals.length === 0) {
                container.innerHTML = `<div class="text-center py-8 opacity-50">${translations[currentLang].withdrawal_history}</div>`;
                return;
            }
            
            let html = '';
            withdrawals.forEach(w => {
                html += `
                    <div class="glass-card rounded-xl p-3">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-bold text-red-400">${formatCurrency(w.amount)}</div>
                                <div class="text-xs opacity-70">${formatDate(w.date)}</div>
                                ${w.notes ? `<div class="text-xs mt-1">${w.notes}</div>` : ''}
                            </div>
                            <button onclick="deleteWithdrawal('${w.id}')" class="p-2 hover:bg-red-500 hover:bg-opacity-20 rounded-lg">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        window.deleteWithdrawal = function(id) {
            withdrawals = withdrawals.filter(w => w.id !== id);
            saveWithdrawals();
            updateDashboard();
            renderWithdrawals();
            showToast('ğŸ—‘ï¸');
        };

        // Deposits
        document.getElementById('depositForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const deposit = {
                id: Date.now().toString(),
                date: document.getElementById('depositDate').value,
                amount: parseFloat(document.getElementById('depositAmount').value),
                notes: document.getElementById('depositNotes').value
            };
            
            deposits.unshift(deposit);
            saveDeposits();
            updateDashboard();
            renderDeposits();
            
            document.getElementById('depositForm').reset();
            document.getElementById('depositDate').value = new Date().toISOString().split('T')[0];
            
            showToast('âœ… ' + translations[currentLang].add_deposit);
        });

        function renderDeposits() {
            const container = document.getElementById('depositsList');
            if (deposits.length === 0) {
                container.innerHTML = `<div class="text-center py-8 opacity-50">${translations[currentLang].deposit_history}</div>`;
                return;
            }
            
            let html = '';
            deposits.forEach(d => {
                html += `
                    <div class="glass-card rounded-xl p-3">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-bold text-green-400">${formatCurrency(d.amount)}</div>
                                <div class="text-xs opacity-70">${formatDate(d.date)}</div>
                                ${d.notes ? `<div class="text-xs mt-1">${d.notes}</div>` : ''}
                            </div>
                            <button onclick="deleteDeposit('${d.id}')" class="p-2 hover:bg-red-500 hover:bg-opacity-20 rounded-lg">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        window.deleteDeposit = function(id) {
            deposits = deposits.filter(d => d.id !== id);
            saveDeposits();
            updateDashboard();
            renderDeposits();
            showToast('ğŸ—‘ï¸');
        };

        // Calendar
        function renderCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            
            const monthNames = currentLang === 'de' ? 
                ['Januar', 'Februar', 'MÃ¤rz', 'April', 'Mai', 'Juni', 'Juli', 'August', 'September', 'Oktober', 'November', 'Dezember'] :
                currentLang === 'es' ?
                ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'] :
                ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            
            document.getElementById('calendarMonthYear').textContent = `${monthNames[month]} ${year}`;
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay() === 0 ? 6 : firstDay.getDay() - 1;
            
            const container = document.getElementById('calendarDays');
            container.innerHTML = '';
            
            for (let i = 0; i < startingDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day opacity-30';
                container.appendChild(emptyDay);
            }
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayTrades = trades.filter(t => t.date === dateStr);
                const hasEvent = events.some(e => e.date === dateStr);
                
                const dayPL = dayTrades.reduce((sum, t) => sum + t.profitLoss, 0);
                const hasTrade = dayTrades.length > 0;
                
                const dayEl = document.createElement('div');
                dayEl.className = `calendar-day ${hasTrade ? 'has-trade' : ''} ${hasEvent ? 'has-event' : ''}`;
                dayEl.style.flexDirection = 'column';
                dayEl.style.padding = '0.25rem';
                dayEl.style.gap = '0.125rem';
                
                const dayNumber = document.createElement('div');
                dayNumber.textContent = day;
                dayNumber.style.fontSize = '0.75rem';
                dayNumber.style.fontWeight = 'bold';
                dayEl.appendChild(dayNumber);
                
                if (hasTrade) {
                    const plDisplay = document.createElement('div');
                    plDisplay.textContent = dayPL >= 0 ? `+${dayPL.toFixed(0)}` : dayPL.toFixed(0);
                    plDisplay.style.fontSize = '0.6rem';
                    plDisplay.style.fontWeight = 'bold';
                    plDisplay.style.color = dayPL > 0 ? '#22c55e' : dayPL < 0 ? '#ef4444' : '#eab308';
                    dayEl.appendChild(plDisplay);
                }
                
                dayEl.onclick = () => showDayDetails(dateStr);
                container.appendChild(dayEl);
            }
        }

        function showDayDetails(date) {
            const dayTrades = trades.filter(t => t.date === date);
            const dayEvents = events.filter(e => e.date === date);
            
            if (dayTrades.length === 0 && dayEvents.length === 0) return;
            
            let content = `<div class="text-center mb-4 font-bold">${formatDate(date)}</div>`;
            
            if (dayTrades.length > 0) {
                content += `<div class="mb-3"><strong>Trades:</strong></div>`;
                dayTrades.forEach(t => {
                    content += `<div class="mb-2 p-2 rounded glass-card">${t.asset} - ${formatCurrency(t.profitLoss)}</div>`;
                });
            }
            
            if (dayEvents.length > 0) {
                content += `<div class="mb-3 mt-4"><strong>${translations[currentLang].add_event}:</strong></div>`;
                dayEvents.forEach(e => {
                    content += `<div class="mb-2 p-2 rounded glass-card">${e.title}</div>`;
                });
            }
            
            const modal = document.createElement('div');
            modal.className = 'glass-card rounded-xl p-4 fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-[10001] w-80 max-h-96 overflow-y-auto';
            modal.innerHTML = content + `<button onclick="this.closest('.glass-card').remove(); document.getElementById('dayOverlay').remove();" class="w-full mt-4 py-2 rounded-lg btn-primary">OK</button>`;
            
            const overlay = document.createElement('div');
            overlay.id = 'dayOverlay';
            overlay.className = 'fixed inset-0 bg-black bg-opacity-50 z-[10000]';
            overlay.onclick = () => {
                overlay.remove();
                modal.remove();
            };
            
            document.body.appendChild(overlay);
            document.body.appendChild(modal);
        }

        document.getElementById('prevMonth').addEventListener('click', () => {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() - 1);
            renderCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + 1);
            renderCalendar();
        });

        document.getElementById('eventForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const event = {
                id: Date.now().toString(),
                date: document.getElementById('eventDate').value,
                title: document.getElementById('eventTitle').value,
                notes: document.getElementById('eventNotes').value
            };
            
            events.push(event);
            saveEvents();
            renderCalendar();
            
            document.getElementById('eventForm').reset();
            document.getElementById('eventDate').value = new Date().toISOString().split('T')[0];
            
            showToast('âœ… ' + translations[currentLang].add_event);
        });

        // Update Dashboard
        function updateDashboard() {
            const currentCapital = calculateCurrentCapital();
            const totalPL = trades.reduce((sum, t) => sum + t.profitLoss, 0);
            const wins = trades.filter(t => t.result === 'win').length;
            const winRate = trades.length > 0 ? (wins / trades.length * 100) : 0;

            document.getElementById('headerCapital').textContent = formatCurrency(currentCapital);
            document.getElementById('currentCapital').textContent = formatCurrency(currentCapital);
            document.getElementById('totalPL').textContent = formatCurrency(totalPL);
            document.getElementById('totalPL').className = totalPL >= 0 ? 'text-lg sm:text-xl font-bold text-green-400' : 'text-lg sm:text-xl font-bold text-red-400';
            document.getElementById('winRate').textContent = winRate.toFixed(1) + '%';
            document.getElementById('totalTrades').textContent = trades.length;

            if (startCapital > 0) {
                document.getElementById('startCapitalInput').value = startCapital;
            }

            const profitLosses = trades.map(t => t.profitLoss);
            const best = profitLosses.length > 0 ? Math.max(...profitLosses) : 0;
            const worst = profitLosses.length > 0 ? Math.min(...profitLosses) : 0;
            
            document.getElementById('dashBestTrade').textContent = formatCurrency(best);
            document.getElementById('dashWorstTrade').textContent = formatCurrency(worst);

            document.getElementById('psBalance').value = currentCapital.toFixed(2);

            // Equity Chart
            const canvas = document.getElementById('equityChart');
            if (canvas) {
                const sortedTrades = [...trades].sort((a, b) => new Date(a.date) - new Date(b.date));
                const equityData = [startCapital];
                const labels = ['Start'];

                let runningCapital = startCapital;
                
                // Add deposits chronologically
                const allTransactions = [
                    ...deposits.map(d => ({ date: d.date, amount: d.amount, type: 'deposit' })),
                    ...sortedTrades.map(t => ({ date: t.date, amount: t.profitLoss, type: 'trade' })),
                    ...withdrawals.map(w => ({ date: w.date, amount: -w.amount, type: 'withdrawal' }))
                ].sort((a, b) => new Date(a.date) - new Date(b.date));
                
                allTransactions.forEach(trans => {
                    runningCapital += trans.amount;
                    equityData.push(runningCapital);
                    labels.push(formatDate(trans.date));
                });

                if (charts.equity) {
                    charts.equity.destroy();
                }

                const ctx = canvas.getContext('2d');
                const textColor = currentTheme === 'dark' ? '#ffffff' : '#0f172a';
                const gridColor = currentTheme === 'dark' ? 'rgba(255, 255, 255, 0.1)' : 'rgba(15, 23, 42, 0.15)';
                
                charts.equity = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Kapital',
                            data: equityData,
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { labels: { color: textColor } }
                        },
                        scales: {
                            x: { ticks: { color: textColor }, grid: { color: gridColor } },
                            y: { ticks: { color: textColor, callback: (v) => 'â‚¬' + v.toFixed(0) }, grid: { color: gridColor } }
                        }
                    }
                });
            }
        }

        // Render History
        function renderHistory() {
            const resultFilter = document.getElementById('filterResult') ? document.getElementById('filterResult').value : 'all';
            let filtered = [...trades];

            if (resultFilter && resultFilter !== 'all') {
                filtered = filtered.filter(t => t.result === resultFilter);
            }

            const container = document.getElementById('tradeHistoryList');
            if (!container) return;
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-5xl mb-3">ğŸ“œ</div>
                        <p class="opacity-50">${trades.length === 0 ? (currentLang === 'de' ? 'Noch keine Trades' : currentLang === 'es' ? 'Sin operaciones' : 'No trades yet') : (currentLang === 'de' ? 'Keine Trades mit diesem Filter' : currentLang === 'es' ? 'Sin operaciones con este filtro' : 'No trades with this filter')}</p>
                    </div>
                `;
                return;
            }

            let html = '';
            filtered.forEach(trade => {
                const plValue = trade.profitLoss;
                const plColor = plValue > 0 ? 'text-green-400' : plValue < 0 ? 'text-red-400' : 'text-yellow-400';
                const resultBadge = trade.result === 'win' ? 'bg-green-500' : trade.result === 'loss' ? 'bg-red-500' : 'bg-yellow-500';

                html += `
                    <div class="glass-card rounded-xl p-3 hover:scale-[1.01] transition">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1 flex-wrap">
                                    <span class="text-lg font-bold">${trade.asset || 'N/A'}</span>
                                    <span class="text-xs font-bold px-2 py-1 rounded-full ${resultBadge}">${trade.result?.toUpperCase()}</span>
                                    <span class="text-xs font-bold px-2 py-1 rounded-full ${trade.position === 'Long' ? 'bg-blue-500' : 'bg-orange-500'}">${trade.position}</span>
                                    ${trade.emotion ? `<span class="text-xs">${getEmotionEmoji(trade.emotion)}</span>` : ''}
                                </div>
                                <div class="text-xs opacity-70">${formatDate(trade.date)}</div>
                                ${trade.strategy ? `<div class="text-xs mt-1">ğŸ“Š ${trade.strategy}</div>` : ''}
                                ${trade.entryPrice && trade.exitPrice ? `<div class="text-xs mt-1">Entry: ${trade.entryPrice} | Exit: ${trade.exitPrice}</div>` : ''}
                            </div>
                            <div class="text-xl font-bold ${plColor}">
                                ${formatCurrency(plValue)}
                            </div>
                        </div>
                        ${trade.notes ? `<div class="text-xs mt-2 p-2 rounded-lg" style="background: var(--bg-secondary);">${trade.notes}</div>` : ''}
                        <div class="flex gap-2 mt-3">
                            <button onclick="editTrade('${trade.id}')" class="flex-1 bg-blue-500 hover:bg-blue-600 px-3 py-2 rounded-lg text-xs font-bold transition">
                                âœï¸ ${translations[currentLang].edit_trade}
                            </button>
                            <button onclick="deleteTrade('${trade.id}')" class="flex-1 bg-red-500 hover:bg-red-600 px-3 py-2 rounded-lg text-xs font-bold transition">
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function getEmotionEmoji(emotion) {
            const emotions = {
                confident: 'ğŸ˜',
                calm: 'ğŸ˜Œ',
                excited: 'ğŸ¤©',
                anxious: 'ğŸ˜°',
                frustrated: 'ğŸ˜¤',
                greedy: 'ğŸ¤‘',
                fearful: 'ğŸ˜¨',
                euphoric: 'ğŸ¥³',
                disciplined: 'ğŸ§˜',
                revenge: 'ğŸ˜¡'
            };
            return emotions[emotion] || '';
        }

        // Render Performance
        function renderPerformance() {
            const profitLosses = trades.map(t => t.profitLoss);
            const best = profitLosses.length > 0 ? Math.max(...profitLosses) : 0;
            const worst = profitLosses.length > 0 ? Math.min(...profitLosses) : 0;

            const winTrades = trades.filter(t => t.profitLoss > 0);
            const lossTrades = trades.filter(t => t.profitLoss < 0);
            
            const avgWin = winTrades.length > 0 ? winTrades.reduce((sum, t) => sum + t.profitLoss, 0) / winTrades.length : 0;
            const avgLoss = lossTrades.length > 0 ? Math.abs(lossTrades.reduce((sum, t) => sum + t.profitLoss, 0) / lossTrades.length) : 0;

            // Long vs Short Analysis
            const longTrades = trades.filter(t => t.position === 'Long');
            const shortTrades = trades.filter(t => t.position === 'Short');
            
            const longPL = longTrades.reduce((sum, t) => sum + t.profitLoss, 0);
            const shortPL = shortTrades.reduce((sum, t) => sum + t.profitLoss, 0);
            
            const longWins = longTrades.filter(t => t.profitLoss > 0).length;
            const shortWins = shortTrades.filter(t => t.profitLoss > 0).length;
            
            const longWinrate = longTrades.length > 0 ? (longWins / longTrades.length * 100) : 0;
            const shortWinrate = shortTrades.length > 0 ? (shortWins / shortTrades.length * 100) : 0;
            
            document.getElementById('longCount').textContent = longTrades.length;
            document.getElementById('shortCount').textContent = shortTrades.length;
            document.getElementById('longPL').textContent = formatCurrency(longPL);
            document.getElementById('longPL').className = longPL >= 0 ? 'text-lg font-bold text-green-400' : 'text-lg font-bold text-red-400';
            document.getElementById('shortPL').textContent = formatCurrency(shortPL);
            document.getElementById('shortPL').className = shortPL >= 0 ? 'text-lg font-bold text-green-400' : 'text-lg font-bold text-red-400';
            document.getElementById('longWinrate').textContent = longWinrate.toFixed(1) + '% Winrate';
            document.getElementById('shortWinrate').textContent = shortWinrate.toFixed(1) + '% Winrate';
            
            // Determine better position
            let betterPos = '--';
            if (longTrades.length > 0 && shortTrades.length > 0) {
                if (longPL > shortPL) {
                    betterPos = 'ğŸ“ˆ Long Trades';
                } else if (shortPL > longPL) {
                    betterPos = 'ğŸ“‰ Short Trades';
                } else {
                    betterPos = 'âš–ï¸ Ausgeglichen';
                }
            } else if (longTrades.length > 0) {
                betterPos = 'ğŸ“ˆ Long Trades (nur Long)';
            } else if (shortTrades.length > 0) {
                betterPos = 'ğŸ“‰ Short Trades (nur Short)';
            }
            document.getElementById('betterPosition').textContent = betterPos;

            // Calculate streaks
            let currentWinStreak = 0;
            let currentLossStreak = 0;
            let maxWinStreak = 0;
            let maxLossStreak = 0;
            
            const sortedTrades = [...trades].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            sortedTrades.forEach(trade => {
                if (trade.profitLoss > 0) {
                    currentWinStreak++;
                    currentLossStreak = 0;
                    maxWinStreak = Math.max(maxWinStreak, currentWinStreak);
                } else if (trade.profitLoss < 0) {
                    currentLossStreak++;
                    currentWinStreak = 0;
                    maxLossStreak = Math.max(maxLossStreak, currentLossStreak);
                }
            });

            document.getElementById('perfBestTrade').textContent = formatCurrency(best);
            document.getElementById('perfWorstTrade').textContent = formatCurrency(worst);
            document.getElementById('perfWinStreak').textContent = maxWinStreak;
            document.getElementById('perfLossStreak').textContent = maxLossStreak;
            document.getElementById('perfAvgWin').textContent = formatCurrency(avgWin);
            document.getElementById('perfAvgLoss').textContent = formatCurrency(avgLoss);

            const textColor = currentTheme === 'dark' ? '#ffffff' : '#0f172a';
            const gridColor = currentTheme === 'dark' ? 'rgba(255, 255, 255, 0.1)' : 'rgba(15, 23, 42, 0.15)';

            // Long vs Short Chart
            if (charts.longShort) charts.longShort.destroy();
            const longShortCanvas = document.getElementById('longShortChart');
            if (longShortCanvas) {
                charts.longShort = new Chart(longShortCanvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: ['Long', 'Short'],
                        datasets: [{
                            label: 'Gesamt P/L',
                            data: [longPL, shortPL],
                            backgroundColor: ['rgba(59, 130, 246, 0.8)', 'rgba(249, 115, 22, 0.8)'],
                            borderColor: ['rgba(59, 130, 246, 1)', 'rgba(249, 115, 22, 1)'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: textColor } } },
                        scales: {
                            x: { ticks: { color: textColor }, grid: { color: gridColor } },
                            y: { ticks: { color: textColor, callback: (v) => 'â‚¬' + v.toFixed(0) }, grid: { color: gridColor } }
                        }
                    }
                });
            }

            // Streak Chart
            if (charts.streak) charts.streak.destroy();
            const streakCanvas = document.getElementById('streakChart');
            if (streakCanvas) {
                const streakData = [];
                let streak = 0;
                
                sortedTrades.forEach((trade, i) => {
                    if (trade.profitLoss > 0) {
                        streak = streak <= 0 ? 1 : streak + 1;
                    } else if (trade.profitLoss < 0) {
                        streak = streak >= 0 ? -1 : streak - 1;
                    } else {
                        streak = 0;
                    }
                    streakData.push(streak);
                });

                charts.streak = new Chart(streakCanvas.getContext('2d'), {
                    type: 'line',
                    data: {
                        labels: sortedTrades.map((_, i) => i + 1),
                        datasets: [{
                            label: 'Streak',
                            data: streakData,
                            borderColor: '#8b5cf6',
                            backgroundColor: 'rgba(139, 92, 246, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: textColor } } },
                        scales: {
                            x: { ticks: { color: textColor }, grid: { color: gridColor } },
                            y: { ticks: { color: textColor }, grid: { color: gridColor } }
                        }
                    }
                });
            }

            // Distribution Chart
            if (charts.distribution) charts.distribution.destroy();
            const distCanvas = document.getElementById('distributionChart');
            if (distCanvas) {
                const winCount = trades.filter(t => t.profitLoss > 0).length;
                const lossCount = trades.filter(t => t.profitLoss < 0).length;
                const beCount = trades.filter(t => t.profitLoss === 0).length;

                charts.distribution = new Chart(distCanvas.getContext('2d'), {
                    type: 'pie',
                    data: {
                        labels: ['Wins', 'Losses', 'Break Even'],
                        datasets: [{
                            data: [winCount, lossCount, beCount],
                            backgroundColor: ['rgba(34, 197, 94, 0.8)', 'rgba(239, 68, 68, 0.8)', 'rgba(234, 179, 8, 0.8)']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: textColor } } }
                    }
                });
            }

            // Strategy Chart
            if (charts.strategy) charts.strategy.destroy();
            const strategyCanvas = document.getElementById('strategyChart');
            if (strategyCanvas) {
                const strategyPerf = {};
                trades.forEach(t => {
                    const strategy = t.strategy || 'N/A';
                    if (!strategyPerf[strategy]) strategyPerf[strategy] = 0;
                    strategyPerf[strategy] += t.profitLoss;
                });

                charts.strategy = new Chart(strategyCanvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(strategyPerf),
                        datasets: [{
                            label: 'P/L',
                            data: Object.values(strategyPerf),
                            backgroundColor: Object.values(strategyPerf).map(v => v >= 0 ? 'rgba(139, 92, 246, 0.8)' : 'rgba(239, 68, 68, 0.8)')
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: textColor } } },
                        scales: {
                            x: { ticks: { color: textColor }, grid: { color: gridColor } },
                            y: { ticks: { color: textColor, callback: (v) => 'â‚¬' + v.toFixed(0) }, grid: { color: gridColor } }
                        }
                    }
                });
            }

            // Monthly Chart
            if (charts.monthly) charts.monthly.destroy();
            const monthlyCanvas = document.getElementById('monthlyChart');
            if (monthlyCanvas) {
                const monthlyPerf = {};
                trades.forEach(t => {
                    const date = new Date(t.date);
                    const key = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                    if (!monthlyPerf[key]) monthlyPerf[key] = 0;
                    monthlyPerf[key] += t.profitLoss;
                });

                const sortedMonths = Object.keys(monthlyPerf).sort();

                charts.monthly = new Chart(monthlyCanvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: sortedMonths,
                        datasets: [{
                            label: 'Monatlich',
                            data: sortedMonths.map(m => monthlyPerf[m]),
                            backgroundColor: sortedMonths.map(m => monthlyPerf[m] >= 0 ? 'rgba(34, 197, 94, 0.8)' : 'rgba(239, 68, 68, 0.8)')
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: textColor } } },
                        scales: {
                            x: { ticks: { color: textColor }, grid: { color: gridColor } },
                            y: { ticks: { color: textColor, callback: (v) => 'â‚¬' + v.toFixed(0) }, grid: { color: gridColor } }
                        }
                    }
                });
            }

            // Asset Chart
            if (charts.asset) charts.asset.destroy();
            const assetCanvas = document.getElementById('assetChart');
            if (assetCanvas) {
                const assetPerf = {};
                trades.forEach(t => {
                    const asset = t.asset || 'N/A';
                    if (!assetPerf[asset]) assetPerf[asset] = 0;
                    assetPerf[asset] += t.profitLoss;
                });

                charts.asset = new Chart(assetCanvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(assetPerf),
                        datasets: [{
                            label: 'P/L',
                            data: Object.values(assetPerf),
                            backgroundColor: Object.values(assetPerf).map(v => v >= 0 ? 'rgba(139, 92, 246, 0.8)' : 'rgba(239, 68, 68, 0.8)')
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: textColor } } },
                        scales: {
                            x: { ticks: { color: textColor }, grid: { color: gridColor } },
                            y: { ticks: { color: textColor, callback: (v) => 'â‚¬' + v.toFixed(0) }, grid: { color: gridColor } }
                        }
                    }
                });
            }
        }

        // Render Emotions
        function renderEmotions() {
            const emotionCounts = {};
            const emotionPerf = {};
            
            trades.forEach(t => {
                if (t.emotion) {
                    emotionCounts[t.emotion] = (emotionCounts[t.emotion] || 0) + 1;
                    emotionPerf[t.emotion] = (emotionPerf[t.emotion] || 0) + t.profitLoss;
                }
            });

            const textColor = currentTheme === 'dark' ? '#ffffff' : '#0f172a';
            const gridColor = currentTheme === 'dark' ? 'rgba(255, 255, 255, 0.1)' : 'rgba(15, 23, 42, 0.15)';

            // Emotion Count Chart
            if (charts.emotion) charts.emotion.destroy();
            const emotionCanvas = document.getElementById('emotionChart');
            if (emotionCanvas) {
                charts.emotion = new Chart(emotionCanvas.getContext('2d'), {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(emotionCounts).map(e => getEmotionEmoji(e) + ' ' + e),
                        datasets: [{
                            data: Object.values(emotionCounts),
                            backgroundColor: [
                                'rgba(139, 92, 246, 0.8)',
                                'rgba(59, 130, 246, 0.8)',
                                'rgba(34, 197, 94, 0.8)',
                                'rgba(234, 179, 8, 0.8)',
                                'rgba(239, 68, 68, 0.8)',
                                'rgba(236, 72, 153, 0.8)',
                                'rgba(168, 85, 247, 0.8)',
                                'rgba(45, 212, 191, 0.8)',
                                'rgba(251, 146, 60, 0.8)',
                                'rgba(248, 113, 113, 0.8)'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: textColor } } }
                    }
                });
            }

            // Emotion Performance Chart
            if (charts.emotionPerf) charts.emotionPerf.destroy();
            const emotionPerfCanvas = document.getElementById('emotionPerfChart');
            if (emotionPerfCanvas) {
                charts.emotionPerf = new Chart(emotionPerfCanvas.getContext('2d'), {
                    type: 'bar',
                    data: {
                        labels: Object.keys(emotionPerf).map(e => getEmotionEmoji(e) + ' ' + e),
                        datasets: [{
                            label: 'P/L',
                            data: Object.values(emotionPerf),
                            backgroundColor: Object.values(emotionPerf).map(v => v >= 0 ? 'rgba(34, 197, 94, 0.8)' : 'rgba(239, 68, 68, 0.8)')
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { labels: { color: textColor } } },
                        scales: {
                            x: { ticks: { color: textColor }, grid: { color: gridColor } },
                            y: { ticks: { color: textColor, callback: (v) => 'â‚¬' + v.toFixed(0) }, grid: { color: gridColor } }
                        }
                    }
                });
            }
        }

        // Initialize
        const savedLang = localStorage.getItem('tradingJournalLang') || 'de';
        currentLang = savedLang;
        document.getElementById('langSelector').value = savedLang;
        document.getElementById('langSelectorLogin').value = savedLang;
        updateLanguage(savedLang);
        
        document.documentElement.setAttribute('data-theme', currentTheme);
        document.getElementById('themeIcon').textContent = currentTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
        if (document.getElementById('themeToggleLogin')) {
            document.querySelector('#themeToggleLogin span').textContent = currentTheme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
        }
        
        document.getElementById('tradeDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('withdrawalDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('depositDate').value = new Date().toISOString().split('T')[0];
        document.getElementById('eventDate').value = new Date().toISOString().split('T')[0];
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b7a5092c3d4e0d3',t:'MTc2NzM1NzUxOS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
